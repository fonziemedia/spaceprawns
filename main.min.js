var vector={_x:1,_y:0,create:function(a,b){var c=Object.create(this);return c.setX(a),c.setY(b),c},setX:function(a){this._x=a},getX:function(){return this._x},setY:function(a){this._y=a},getY:function(){return this._y},setAngle:function(a){var b=this.getLength();this._x=Math.cos(a)*b,this._y=Math.sin(a)*b},getAngle:function(){return Math.atan2(this._y,this._x)},setLength:function(a){var b=this.getAngle();this._x=Math.cos(b)*a,this._y=Math.sin(b)*a},getLength:function(){return Math.sqrt(this._x*this._x+this._y*this._y)},add:function(a){return vector.create(this._x+a.getX(),this._y+a.getY())},subtract:function(a){return vector.create(this._x-a.getX(),this._y-a.getY())},multiply:function(a){return vector.create(this._x*a,this._y*a)},divide:function(a){return vector.create(this._x/a,this._y/a)},addTo:function(a){this._x+=a.getX(),this._y+=a.getY()},subtractFrom:function(a){this._x-=a.getX(),this._y-=a.getY()},multiplyBy:function(a){this._x*=a,this._y*=a},divideBy:function(a){this._x/=a,this._y/=a}},utils={norm:function(a,b,c){return(a-b)/(c-b)},lerp:function(a,b,c){return(c-b)*a+b},map:function(a,b,c,d,e){return utils.lerp(utils.norm(a,b,c),d,e)},clamp:function(a,b,c){return Math.min(Math.max(a,Math.min(b,c)),Math.max(b,c))},distance:function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)},distanceXY:function(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(e*e+f*f)},circleCollision:function(a,b){return utils.distance(a,b)<=a.radius+b.radius},circlePointCollision:function(a,b,c){return utils.distanceXY(a,b,c.x,c.y)<c.radius},pointInRect:function(a,b,c){return utils.inRange(a,c.x,c.x+c.width)&&utils.inRange(b,c.y,c.y+c.height)},inRange:function(a,b,c){return a>=Math.min(b,c)&&a<=Math.max(b,c)},rangeIntersect:function(a,b,c,d){return Math.max(a,b)>=Math.min(c,d)&&Math.min(a,b)<=Math.max(c,d)},rectIntersect:function(a,b){return utils.rangeIntersect(a.x,a.x+a.width,b.x,b.x+b.width)&&utils.rangeIntersect(a.y,a.y+a.height,b.y,b.y+b.height)},degreesToRads:function(a){return a/180*Math.PI},radsToDegrees:function(a){return 180*a/Math.PI},randomRange:function(a,b){return a+Math.random()*(b-a)},randomInt:function(a,b){return Math.floor(a+Math.random()*(b-a+1))},roundToPlaces:function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},roundNearest:function(a,b){return Math.round(a/b)*b},quadraticBezier:function(a,b,c,d,e){return e=e||{},e.x=Math.pow(1-d,2)*a.x+2*(1-d)*d*b.x+d*d*c.x,e.y=Math.pow(1-d,2)*a.y+2*(1-d)*d*b.y+d*d*c.y,e},cubicBezier:function(a,b,c,d,e,f){return f=f||{},f.x=Math.pow(1-e,3)*a.x+3*Math.pow(1-e,2)*e*b.x+3*(1-e)*e*e*c.x+e*e*e*d.x,f.y=Math.pow(1-e,3)*a.y+3*Math.pow(1-e,2)*e*b.y+3*(1-e)*e*e*c.y+e*e*e*d.y,f},multicurve:function(a,b){var c,d,e,f;b.moveTo(a[0].x,a[0].y);for(var g=1;g<a.length-2;g+=1)c=a[g],d=a[g+1],e=(c.x+d.x)/2,f=(c.y+d.y)/2,b.quadraticCurveTo(c.x,c.y,e,f);c=a[a.length-2],d=a[a.length-1],b.quadraticCurveTo(c.x,c.y,d.x,d.y)}},particle=function(a,b,c,d,e){this.x=a,this.y=b,this.vx=Math.cos(d)*c*dt,this.vy=Math.sin(d)*c*dt,this.mass=1,this.radius=0,this.bounce=-1,this.friction=1,this.gravity=e||0,this.springs=[],this.gravitations=[],this.addGravitation=function(a){this.removeGravitation(a),this.gravitations.push(a)},this.removeGravitation=function(a){for(var b=0;b<this.gravitations.length;b+=1)if(a===this.gravitations[b])return void this.gravitations.splice(b,1)},this.addSpring=function(a,b,c){this.removeSpring(a),this.springs.push({point:a,k:b,length:c||0})},this.removeSpring=function(a){for(var b=0;b<this.springs.length;b+=1)if(a===this.springs[b].point)return void this.springs.splice(b,1)},this.getSpeed=function(){return Math.sqrt(this.vx*this.vx+this.vy*this.vy)},this.setSpeed=function(a){var b=this.getHeading();this.vx=Math.cos(b)*a,this.vy=Math.sin(b)*a},this.getHeading=function(){return Math.atan2(this.vy,this.vx)},this.setHeading=function(a){var b=this.getSpeed();this.vx=Math.cos(a)*b,this.vy=Math.sin(a)*b},this.accelerate=function(a,b){this.vx+=a,this.vy+=b},this.update=function(){0===dt&&(this.vx=Math.cos(d)*c*dt,this.vy=Math.sin(d)*c*dt),this.handleSprings(),this.handleGravitations(),this.vx*=this.friction,this.vy*=this.friction,this.vy+=this.gravity,this.x+=this.vx,this.y+=this.vy},this.handleGravitations=function(){for(var a=0;a<this.gravitations.length;a+=1)this.gravitateTo(this.gravitations[a])},this.handleSprings=function(){for(var a=0;a<this.springs.length;a+=1){var b=this.springs[a];this.springTo(b.point,b.k,b.length)}},this.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)},this.distanceTo=function(a){var b=a.x-this.x,c=a.y-this.y;return Math.sqrt(b*b+c*c)},this.gravitateTo=function(a){var b=a.x-this.x,c=a.y-this.y,d=b*b+c*c,e=Math.sqrt(d),f=a.mass/d,g=b/e*f,h=c/e*f;this.vx+=g,this.vy+=h},this.springTo=function(a,b,c){var d=a.x-this.x,e=a.y-this.y,f=Math.sqrt(d*d+e*e),g=(f-c||0)*b;this.vx+=d/f*g,this.vy+=e/f*g}};!function(){$(document).ready(function(){function a(){if(G.attr("height",$(K).height()),H.attr("height",$(K).height()),I.attr("height",$(K).height()),J.attr("height",$(K).height()),$(K).width()<1080)G.attr("width",$(K).width()),H.attr("width",$(K).width()),I.attr("width",$(K).width()),J.attr("width",$(K).width()),F.width=$(K).width();else{var a=9*$(K).height()/16;G.attr("width",a),H.attr("width",a),I.attr("width",a),J.attr("width",a),G.css({left:.5*($(K).width()-a)}),H.css({left:.5*($(K).width()-a)}),I.css({left:.5*($(K).width()-a)}),J.css({left:.5*($(K).width()-a)}),F.width=a}F.height=$(K).height(),dtSize=.001*F.height,F.enemySpeed=X_EnemySpeed*F.height/2500,F.EnBulletSpeed=X_EnBulletSpeed*F.height/1e3,F.fullShootTimer=X_GunSpeed,F.enfullShootTimer=X_EnGunSpeed,F.shootTimer=F.fullShootTimer,F.enshootTimer=F.enfullShootTimer,F.contextText.font="bold "+.08*F.width+"px "+F.font,F.contextText.fillStyle="white",F.contextText.fillText("Loading...",.3*F.width,.47*F.height)}function b(a,c,d){particle.call(this,a),this.direction=Math.PI/2,this.section=d,this.width=F.width,this.height=F.width*(16/9)*4,this.x=0,this.y=0===this.section?-(this.height-F.height):this.y=-this.height,this.image=20+F.level,this.limits=.02*-F.height,this.update=function(){this.vx=Math.cos(this.direction)*a*dt,this.vy=Math.sin(this.direction)*a*dt,this.x+=this.vx,this.y+=this.vy},this.draw=function(){F.contextBackground.drawImage(F.images[this.image],this.x,this.y,this.width,this.height)},this.load=function(){F.background.length<1&&F.background.push(new b(150,this.image,0));for(var a in F.background)F.background[a].y>this.limits&&F.background.length<2&&F.background.push(new b(150,this.image,1)),F.background[a].y>F.height&&F.background.splice(a,1),F.background[a].update(),F.background[a].draw()}}function c(a,b,c,d,e){particle.call(this,a,b,c,d),this.x=a-.2*e,this.y=b-.2*e,this.speed=c,this.size=1.5*e,this.hitTimer=0,this.dead=!1,this.deadTime=60,this.image=3,this.frameWidth=96,this.frameHeight=96,this.startFrame=0,this.endFrame=19,this.frameSpeed=2,this.animationSequence=[],this.currentFrame=0,this.counter=0,this.fpr=Math.floor(F.images[this.image].width/this.frameWidth),this.ctx=F.contextPlayer,this.update=function(){for(this.vx=Math.cos(d)*this.speed*dt,this.vy=Math.sin(d)*this.speed*dt,this.x+=this.vx,this.y+=this.vy,this.FrameNum=this.startFrame;this.FrameNum<=this.endFrame;this.FrameNum++)this.animationSequence.push(this.FrameNum);this.counter==this.frameSpeed-1&&(this.currentFrame=(this.currentFrame+1)%this.animationSequence.length),this.counter=(this.counter+1)%this.frameSpeed,this.spriteRow=Math.floor(this.animationSequence[this.currentFrame]/this.fpr),this.spriteCol=Math.floor(this.animationSequence[this.currentFrame]%this.fpr)},this.draw=function(){this.currentFrame<=19&&this.ctx.drawImage(F.images[this.image],this.spriteCol*this.frameWidth,this.spriteRow*this.frameHeight,this.frameWidth,this.frameHeight,this.x,this.y,this.size,this.size)}}function d(a,b){particle.call(this),this.x=.46*F.width,this.y=.9*F.height,this.speed=0,this.maxSpeed=400,this.direction=-Math.PI/2,this.size=100*dtSize,this.hull=a,this.bulletspeed=X_BulletSpeed*F.height/1e3,this.image=0,this.rendered=!1,this.hit=!1,this.hitTimer=0,this.imune=!1,this.imuneTimer=0,this.dead=!1,this.deadTimer=0,this.bullets=[],this.bulletTimer=1,this.bulletDivision=b,this.laserLevel=1,this.missileLevel=0,this.lives=X_Lives,this.ctx=F.contextPlayer,this.incline=[.004*F.width,.008*F.width,.01*F.width,.012*F.width],this.steering=.08*F.width,this.update=function(){if(!O||F.levelComplete||F.paused||F.gameOver||F.gameWon?O||F.gameOver||(this.image=0,this.rendered=!1):canvasX>.25*this.size&&canvasX<=F.width-.25*this.size&&canvasY>this.size&&canvasY<=F.height-.16*this.size&&(moveRight1=canvasX>moveX&&canvasX<=moveX+this.incline[0]?!0:!1,moveRight2=canvasX>moveX+this.incline[0]&&canvasX<=moveX+this.incline[1]?!0:!1,moveRight3=canvasX>moveX+this.incline[1]&&canvasX<=moveX+this.incline[2]?!0:!1,moveRight4=canvasX>moveX+this.incline[2]&&canvasX<=moveX+this.incline[3]?!0:!1,moveRight5=canvasX>moveX+this.incline[3]?!0:!1,moveLeft1=canvasX<moveX&&canvasX>=moveX-this.incline[0]?!0:!1,moveLeft2=canvasX<moveX-this.incline[0]&&canvasX>=moveX-this.incline[1]?!0:!1,moveLeft3=canvasX<moveX-this.incline[1]&&canvasX>=moveX-this.incline[2]?!0:!1,moveLeft4=canvasX<moveX-this.incline[2]&&canvasX>=moveX-this.incline[3]?!0:!1,moveLeft5=canvasX<moveX-this.incline[3]?!0:!1,(canvasX!=moveX||canvasY!=moveY)&&(distX=moveX-canvasX,distY=moveY-canvasY,distX<this.steering&&distX>-this.steering&&(this.speed=this.maxSpeed,this.x-=distX),distX>=this.steering&&(this.speed=this.maxSpeed,this.x-=this.speed*dt),distX<=-this.steering&&(this.speed=this.maxSpeed,this.x+=this.speed*dt),distY<this.steering&&distY>-this.steering&&(this.speed=this.maxSpeed,this.y-=distY),distY>=this.steering&&(this.speed=this.maxSpeed,this.y-=this.speed*dt),distY<=-this.steering&&(this.speed=this.maxSpeed,this.y+=this.speed*dt)),this.image=moveRight1?4:moveRight2?5:moveRight3?6:moveRight4?7:moveRight5?8:moveLeft1?9:moveLeft2?10:moveLeft3?11:moveLeft4?12:moveLeft5?13:0,this.rendered=!1,moveX=this.x+.5*this.size,moveY=navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?this.y+1.7*this.size:this.y+this.size),(F.keys[37]||F.keys[65]&&!F.gameOver&&!F.gameWon)&&this.x>0&&(this.speed=this.maxSpeed,this.direction=Math.PI,this.image=13,this.rendered=!1,this.x-=this.speed*dt),(F.keys[39]||F.keys[68]&&!F.gameOver&&!F.gameWon)&&this.x<=F.width-this.size&&(this.speed=this.maxSpeed,this.direction=0,this.image=8,this.rendered=!1,this.x+=this.speed*dt),(F.keys[38]||F.keys[87]&&!F.gameOver&&!F.gameWon||F.levelComplete)&&(this.y>0||F.levelComplete)&&(this.speed=this.maxSpeed,this.direction=-Math.PI/2,this.rendered=!1,this.y-=this.speed*dt),F.keys[40]||F.keys[83]&&!F.gameOver&&!F.gameWon?this.y<=F.height-this.size&&(this.speed=this.maxSpeed,this.direction=Math.PI/2,this.rendered=!1,this.y+=this.speed*dt):this.speed=0,!F.keys[32]&&!O||this.dead||F.gameOver)this.bulletTimer=1;else if(this.bulletTimer++,this.bulletTimer%this.bulletDivision===0){switch(this.laserLevel){case 1:F.playerBullets.push(new e(this.x+.5*this.size,this.y-.2*this.size,600,-Math.PI/2,45,1,1,2,48,11)),F.sound&&F.sounds.push(new Audio("_sounds/_sfx/laser.wav"));break;case 2:F.playerBullets.push(new e(this.x+.25*this.size,this.y-.2*this.size,600,-Math.PI/2,45,1,1,2,48,11)),F.playerBullets.push(new e(this.x+.75*this.size,this.y-.2*this.size,600,-Math.PI/2,45,1,1,2,48,11)),F.sound&&F.sounds.push(new Audio("_sounds/_sfx/laser.wav"));break;default:F.playerBullets.push(new e(this.x+.25*this.size,this.y-.2*this.size,600,-Math.PI/2,45,1,1,2,48,11)),F.playerBullets.push(new e(this.x+.5*this.size,this.y-.2*this.size,600,-Math.PI/2,45,1,1,2,48,11)),F.playerBullets.push(new e(this.x+.75*this.size,this.y-.2*this.size,600,-Math.PI/2,45,1,1,2,48,11)),F.sound&&F.sounds.push(new Audio("_sounds/_sfx/laser.wav"))}switch(this.missileLevel){case 0:break;case 1:F.playerBullets.push(new e(this.x+.5*this.size,this.y+this.size,100,-Math.PI/2,45,2,1.03,20,64,2));break;case 2:F.playerBullets.push(new e(this.x,this.y+this.size,100,-Math.PI/2,45,2,1.03,20,64,2)),F.playerBullets.push(new e(this.x+this.size,this.y+this.size,100,-Math.PI/2,45,2,1.03,20,64,2));break;default:F.playerBullets.push(new e(this.x,this.y+this.size,100,-Math.PI/2,45,2,1.03,20,64,2)),F.playerBullets.push(new e(this.x+this.size,this.y+this.size,100,-Math.PI/2,45,2,1.03,20,64,2)),F.playerBullets.push(new e(this.x+.5*this.size,this.y+this.size,100,-Math.PI/2,45,2,1.03,20,64,2))}}this.hull<=0&&!this.dead&&(this.dead=!0,this.lives-=1,F.explosions.push(new c(this.x,this.y,.5*this.speed,this.direction,this.size)),F.sound&&F.sounds.push(new Audio("_sounds/blast.mp3")),gameUI.updateHangar()),this.dead&&this.deadTimer<=100&&F.lives>0&&(this.deadTimer++,this.deadTimer>100&&this.lives>0?(O=0,this.hull=a,this.dead=!1,this.x=.46*F.width,this.y=.9*F.height,this.image=0,this.rendered=!1,this.hit=!1,this.hitTimer=0,this.friction=0,this.laserLevel=1,this.missileLevel=0,gameUI.updateEnergy(),this.deadTimer=0,this.imune=!0,this.imuneTimer=0):this.deadTimer>100&&0===this.lives?(O=0,F.keys[13]=!1,this.deadTimer=0,F.gameOver=!0):(this.x=-F.width,this.y=-F.height)),this.imune&&(this.imuneTimer++,this.imuneTimer>250&&(this.imune=!1,this.imuneTimer=0))},this.draw=function(){this.dead||(!this.imune||F.faded||F.starting||F.levelComplete||(this.ctx.globalAlpha=.8,(this.imuneTimer>=0&&this.imuneTimer<15||this.imuneTimer>=20&&this.imuneTimer<35||this.imuneTimer>=40&&this.imuneTimer<55||this.imuneTimer>=70&&this.imuneTimer<75||this.imuneTimer>=90&&this.imuneTimer<95||this.imuneTimer>=110&&this.imuneTimer<115||this.imuneTimer>=130&&this.imuneTimer<135||this.imuneTimer>=150&&this.imuneTimer<155||this.imuneTimer>=160&&this.imuneTimer<175||this.imuneTimer>180)&&this.ctx.drawImage(F.images[this.image],this.x,this.y,this.size,this.size)),this.imune||(this.ctx.globalAlpha<1&&!F.faded&&!F.levelComplete&&(this.ctx.globalAlpha+=.1),this.ctx.drawImage(F.images[this.image],this.x,this.y,this.size,this.size)),this.hit&&!this.imune&&(navigator.userAgent.match(/(iPhone|Android)/)&&navigator.vibrate(30),this.hit=!1))},this.reset=function(){this.dead=!1,this.x=.46*F.width,this.y=.9*F.height,this.image=0,this.hull=a,this.rendered=!1,this.hit=!1,this.hitTimer=0,this.dead=!1,F.gameOver=!1,this.friction=0,this.bullets=[],this.laserLevel=1,this.missileLevel=0,this.lives=X_Lives}}function e(a,b,c,d,e,f,g,h,i,j){particle.call(this,a,b,c,d),this.size=e*dtSize,this.power=f,this.image=h,this.dead=!1,this.deadTime=60,this.frameWidth=i,this.frameHeight=i,this.startFrame=0,this.endFrame=j,this.frameSpeed=4,this.animationSequence=[],this.currentFrame=0,this.counter=0,this.fpr=Math.floor(F.images[this.image].width/this.frameWidth),this.image=h,this.friction=g,this.dtSet=!1,this.ctx=F.contextEnemies,this.update=function(){for(0===dt||this.dtSet||(this.vx=Math.cos(d)*c*dt,this.vy=Math.sin(d)*c*dt,this.dtSet=!0),this.vx*=this.friction,this.vy*=this.friction,this.x+=this.vx,this.y+=this.vy,this.FrameNum=this.startFrame;this.FrameNum<=this.endFrame;this.FrameNum++)this.animationSequence.push(this.FrameNum);this.counter==this.frameSpeed-1&&(this.currentFrame=(this.currentFrame+1)%this.animationSequence.length),this.counter=(this.counter+1)%this.frameSpeed,this.spriteRow=Math.floor(this.animationSequence[this.currentFrame]/this.fpr),this.spriteCol=Math.floor(this.animationSequence[this.currentFrame]%this.fpr)},this.draw=function(){this.dead||(this.ctx.save(),this.ctx.translate(this.x,this.y),this.ctx.rotate(d-Math.PI/2),this.ctx.drawImage(F.images[this.image],this.spriteCol*this.frameWidth,this.spriteRow*this.frameHeight,this.frameWidth,this.frameHeight,-this.size/2,-this.size/2,this.size,this.size),this.ctx.restore())}}function f(a,b,d,e,f,g,i,j,k){switch(particle.call(this,a,b,d,e),this.type=g,this.type){case"pawn":this.size=65*dtSize;break;case"miniboss":this.size=120*dtSize;break;case"base":this.size=170*dtSize,this.rotation=0}this.hull=f,this.image=i,this.hit=!1,this.hitTimer=0,this.dead=!1,this.bulletTimer=1,this.sheep=k||!1,this.fireRate=60*j,this.bulletDivision=this.sheep?2*this.fireRate-Math.floor(Math.random()*this.fireRate)||99999:this.bulletDivision=this.fireRate||99999,this.ctx=F.contextEnemies,this.inCanvas=!1,this.speed=d,this.direction=e,this.collided=!1,this.update=function(){this.vx=Math.cos(this.direction)*this.speed*dt,this.vy=Math.sin(this.direction)*this.speed*dt,this.x+=this.vx,this.y+=this.vy,this.hit&&this.hull>0&&(F.sound&&F.sounds.push(new Audio("_sounds/_sfx/hit.mp3")),this.hit=!1),this.hull<=0&&(this.dead=!0,F.explosions.push(new c(this.x,this.y,this.speed,this.direction,this.size)),F.sound&&F.sounds.push(new Audio("_sounds/explosion.mp3")),playerShip.crashed||(F.score++,F.levelScore++,gameUI.updateScore())),0!==this.fireRate&&(this.bulletTimer++,this.bulletTimer%this.bulletDivision==1&&(this.bulletTimer=1,bulletX=this.x+.42*this.size,bulletY=this.y+this.size,bulletDirection=this.angleTo(playerShip),F.enemyBullets.push(new h(bulletX,bulletY,50,bulletDirection,1,20)))),"base"!=this.type&&(this.direction-=utils.randomRange(-.05,.05))},this.draw=function(){"base"==this.type?this.dead||(this.rotation+=.01,this.ctx.save(),this.ctx.translate(this.x+.5*this.size,this.y+.5*this.size),this.ctx.rotate(this.rotation),this.ctx.drawImage(F.images[this.image],.5*-this.size,.5*-this.size,this.size,this.size),this.ctx.restore()):this.dead||this.ctx.drawImage(F.images[this.image],this.x,this.y,this.size,this.size)}}function g(a,b,d,e,f,g){particle.call(this,a,b,d,e),this.hull=f,this.image=g,this.size=200*dtSize,this.hit=!1,this.hitTimer=0,this.dead=!1,this.deadTimer=0,this.bulletTimer1=1,this.bulletTimer2=1,this.bulletDivision1=50,this.bulletDivision2=30,this.fireRate=0,this.context=F.contextEnemies,this.update=function(){this.bulletDirection=this.angleTo(playerShip),this.vx=Math.cos(e)*d*dt,this.vy=Math.sin(e)*d*dt,this.x+=this.vx,this.y+=this.vy,this.hit&&this.hull>0&&(F.sound&&F.sounds.push(new Audio("_sounds/_sfx/hit.mp3")),this.hit=!1),!A(playerShip,this)||this.dead||F.gameOver||(playerShip.hull-=this.hull,playerShip.hit=!0,this.hit=!0,this.hull-=playerShip.hull),this.hull<=0&&(F.explosions.push(new c(this.x,this.y,d,e,this.size)),F.sound&&F.sounds.push(new Audio("_sounds/blast.mp3")),F.music&&F.songs.push(new Audio("_sounds/victory.mp3")),playerShip.crashed||(F.score++,F.levelScore++,F.bossDead=!0,this.dead=!0)),this.bulletTimer1++,this.bulletTimer2++,this.bulletTimer1%this.bulletDivision1==1&&(this.bulletTimer1=1,F.enemyBullets.push(new h(this.x,this.y+.6*this.size,50,this.bulletDirection,1,20)),F.enemyBullets.push(new h(this.x+this.size,this.y+.6*this.size,50,this.bulletDirection,1,20))),this.bulletTimer2%this.bulletDivision2==1&&(this.bulletTimer2=1,bulletX=this.x+.48*this.size,bulletY=this.y+this.size,F.enemyBullets.push(new h(bulletX,bulletY,250,Math.PI/2,1.5,2)),F.enemyBullets.push(new h(bulletX,bulletY,250,Math.PI/2,1.5,2))),this.y>.1*F.height&&(d=0,this.x>0&&this.x<=F.width-this.size/4&&(this.x<playerShip.x?this.x+=1:this.x>playerShip.x&&(this.x-=1)))},this.draw=function(){F.contextEnemies.clearRect(this.x-this.vx,this.y-this.vy,this.size,this.size),this.dead||F.contextEnemies.drawImage(F.images[this.image],this.x,this.y,this.size,this.size)}}function h(a,b,c,d,e,f){particle.call(this,a,b,c,d),this.size=30*dtSize,this.power=e,this.image=f,this.dead=!1,this.deadTime=60,this.frameWidth=64,this.frameHeight=64,this.startFrame=0,this.endFrame=2,this.frameSpeed=5,this.animationSequence=[],this.currentFrame=0,this.counter=0,this.fpr=Math.floor(F.images[this.image].width/this.frameWidth),this.image=f,this.friction=1.02,this.dtSet=!1,this.ctx=F.contextEnemies,this.update=function(){for(0===dt||this.dtSet||(this.vx=Math.cos(d)*c*dt,this.vy=Math.sin(d)*c*dt,this.dtSet=!0),this.vx*=this.friction,this.vy*=this.friction,this.x+=this.vx,this.y+=this.vy,this.FrameNum=this.startFrame;this.FrameNum<=this.endFrame;this.FrameNum++)this.animationSequence.push(this.FrameNum);this.counter==this.frameSpeed-1&&(this.currentFrame=(this.currentFrame+1)%this.animationSequence.length),this.counter=(this.counter+1)%this.frameSpeed,this.spriteRow=Math.floor(this.animationSequence[this.currentFrame]/this.fpr),this.spriteCol=Math.floor(this.animationSequence[this.currentFrame]%this.fpr)},this.draw=function(){this.dead||(this.ctx.save(),this.ctx.translate(this.x,this.y),this.ctx.rotate(d-Math.PI/2),this.ctx.drawImage(F.images[this.image],this.spriteCol*this.frameWidth,this.spriteRow*this.frameHeight,this.frameWidth,this.frameHeight,-this.size/2,-this.size/2,this.size,this.size),this.ctx.restore())}}function j(a,b){particle.call(this,a,b),this.speed=250,this.direction=Math.PI/2,this.size=45*dtSize,this.dead=!1,this.drops=["health","laser","missile"];var c=Math.floor(Math.random()*this.drops.length);switch(this.type=this.drops[c],this.type){case"health":this.image=0;break;case"laser":this.image=2;break;case"missile":this.image=20}this.context=F.contextPlayer,this.update=function(){if(this.vx=Math.cos(this.direction)*this.speed*dt,this.vy=Math.sin(this.direction)*this.speed*dt,this.x+=this.vx,this.y+=this.vy,A(this,playerShip)&&!this.dead&&!F.gameOver){switch(this.type){case"health":this.hull<=7.5?playerShip.hull+=2.5:playerShip.hull=10,gameUI.updateEnergy();break;case"laser":playerShip.laserLevel+=1;break;case"missile":playerShip.missileLevel+=1}F.sound&&F.sounds.push(new Audio("_sounds/_sfx/loot_powerUp.mp3")),this.dead=!0}},this.draw=function(){F.contextPlayer.clearRect(this.x-this.vx,this.y-this.vy,this.size,this.size),this.dead||F.contextPlayer.drawImage(F.images[this.image],this.x,this.y,this.size,this.size)}}function k(){this.width=F.width,this.height=.04*F.height,this.energyBarSize=.3*F.width,this.energyPointSize=.01*F.height,this.hangarShipSize=.03*F.height,this.level=F.level,this.updateLevel=function(){this.level=F.level,F.contextText.fillStyle="#FFD455",F.contextText.font=15*dtSize+"px helvetica",F.contextText.clearRect(.02*this.width,.3*this.height,.05*this.width,.35*this.height),F.contextText.fillText("S"+this.level,.02*this.width,.6*this.height)},this.updateScore=function(){this.score=F.score,F.contextText.fillStyle="#FFD455",F.contextText.font=15*dtSize+"px helvetica",F.contextText.clearRect(.1*this.width,.3*this.height,.12*this.width,.35*this.height),F.contextText.fillText("Score: "+this.score,.1*this.width,.6*this.height)},this.updateSound=function(){this.soundFx=F.sound?"ON":"OFF",navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)||(F.contextText.fillStyle="#FFD455",F.contextText.font=15*dtSize+"px helvetica",F.contextText.clearRect(.39*this.width,.3*this.height,.05*this.width,.35*this.height),F.contextText.fillText("Sound(F8): "+this.soundFx,.25*this.width,.6*this.height))},this.updateEnergy=function(){for(this.hull=playerShip.hull,F.contextText.clearRect(.555*this.width,.27*this.height,.205*this.width,.34*this.height),s=0;s<this.hull;s++)F.contextText.drawImage(F.images[26],.545*this.width+11*s,.15*this.height,this.energyPointSize,2.2*this.energyPointSize)},this.updateHangar=function(){for(this.hangar=playerShip.lives,F.contextText.clearRect(.83*this.width,.35*this.height,.13*this.width,.58*this.height),i=0;i<this.hangar;i++)F.contextText.drawImage(F.images[0],.82*this.width+.05*this.width*i,.3*this.height,this.hangarShipSize,this.hangarShipSize)},this.updateAll=function(){F.contextText.clearRect(0,0,this.width,1.5*this.height),F.contextText.drawImage(F.images[25],.5*this.width,.1*-this.height,this.energyBarSize,this.energyBarSize/4),this.updateLevel(),this.updateScore(),this.updateSound(),this.updateEnergy(),this.updateHangar()}}function l(){this.backgroundAlpha=0,this.enemiesAlpha=0,this.playerAlpha=0,this.textAlpha=0,this.alphaDelta=.01,this.on=function(a){switch(a=a){case"all":F.contextText.globalAlpha=1,F.contextBackground.globalAlpha=1,F.contextEnemies.globalAlpha=1,F.contextPlayer.globalAlpha=1,F.textFaded=!1,F.backgroundFaded=!1,F.enemiesFaded=!1,F.playerFaded=!1,F.faded=!1;break;case"text":F.contextText.globalAlpha=1,F.textFaded=!1;break;case"background":F.contextBackground.globalAlpha=1,F.backgroundFaded=!1;break;case"enemies":F.contextEnemies.globalAlpha=1,F.enemiesFaded=!1;break;case"player":F.contextPlayer.globalAlpha=1,F.playerFaded=!1}},this.off=function(a){switch(a=a){case"all":F.contextText.globalAlpha=0,F.contextBackground.globalAlpha=0,F.contextEnemies.globalAlpha=0,F.contextPlayer.globalAlpha=0,F.textFaded=!0,F.backgroundFaded=!0,F.enemiesFaded=!0,F.playerFaded=!0,F.faded=!0;break;case"text":F.contextText.globalAlpha=0,F.textFaded=!0;break;case"background":F.contextBackground.globalAlpha=0,F.backgroundFaded=!0;break;case"enemies":F.contextEnemies.globalAlpha=0,F.enemiesFaded=!0;break;case"player":F.contextPlayer.globalAlpha=0,F.playerFaded=!0}},this.fadeIn=function(a){switch(a=a){case"all":this.backgroundAlpha<1||this.enemiesAlpha<1||this.playerAlpha<1||this.textAlpha<1?(this.backgroundAlpha+=this.alphaDelta,this.enemiesAlpha+=this.alphaDelta,this.playerAlpha+=this.alphaDelta,this.textAlpha+=this.alphaDelta):this.backgroundAlpha>=1&&this.enemiesAlpha>=1&&this.playerAlpha>=1&&this.textAlpha>=1&&(F.contextBackground.globalAlpha=1,F.contextEnemies.globalAlpha=1,F.contextPlayer.globalAlpha=1,F.contextText.globalAlpha=1,F.backgroundFaded=!1,F.enemiesFaded=!1,F.playerFaded=!1,F.textFaded=!1,F.faded=!1),F.contextBackground.globalAlpha=this.backgroundAlpha,F.contextEnemies.globalAlpha=this.enemiesAlpha,F.contextPlayer.globalAlpha=this.playerAlpha,F.contextText.globalAlpha=this.textAlpha;break;case"text":this.textAlpha<1?this.textAlpha+=this.alphaDelta:this.textAlpha>=1&&(F.contextText.globalAlpha=1,F.textFaded=!1),F.contextText.globalAlpha=this.textAlpha;break;case"background":this.backgroundAlpha<1?this.backgroundAlpha+=this.alphaDelta:this.backgroundAlpha>=1&&(F.contextBackground.globalAlpha=1,F.backgroundFaded=!1),F.contextBackground.globalAlpha=this.backgroundAlpha;break;case"enemies":this.enemiesAlpha<1?this.enemiesAlpha+=this.alphaDelta:F.enemiesApha>=1&&(F.contextEnemies.globalAlpha=1,F.enemiesFaded=!1),F.contextEnemies.globalAlpha=this.enemiesAlpha;break;case"player":this.playerAlpha<1?this.playerAlpha+=this.alphaDelta:this.playerAlpha>=1&&(F.contextPlayer.globalAlpha=1,F.playerFaded=!1),F.contextPlayer.globalAlpha=this.playerAlpha}},this.fadeOut=function(a){switch(a=a){case"all":this.backgroundAlpha>0||this.enemiesAlpha>0||this.playerAlpha>0||this.textAlpha>0?(this.backgroundAlpha-=this.alphaDelta,this.enemiesAlpha-=this.alphaDelta,this.playerAlpha-=this.alphaDelta,this.textAlpha-=this.alphaDelta):this.backgroundAlpha<=0&&this.enemiesAlpha<=0&&this.playerAlpha<=0&&this.textAlpha<=0&&(F.contextBackground.globalAlpha=0,F.contextEnemies.globalAlpha=0,F.contextPlayer.globalAlpha=0,F.contextText.globalAlpha=0,F.backgroundFaded=!0,F.enemiesFaded=!0,F.playerFaded=!0,F.textFaded=!0,F.faded=!0),F.contextBackground.globalAlpha=this.backgroundAlpha,F.contextEnemies.globalAlpha=this.enemiesAlpha,F.contextPlayer.globalAlpha=this.playerAlpha,F.contextText.globalAlpha=this.textAlpha;break;case"text":this.textAlpha>0?this.textAlpha-=this.alphaDelta:this.textAlpha<=0&&(F.contextText.globalAlpha=0,F.textFaded=!0),F.contextText.globalAlpha=this.textAlpha;break;case"background":this.backgroundAlpha>0?this.backgroundAlpha-=this.alphaDelta:this.backgroundAlpha<=0&&(F.contextBackground.globalAlpha=0,F.backgroundFaded=!0),F.contextBackground.globalAlpha=this.backgroundAlpha;break;case"enemies":this.enemiesAlpha>0?this.enemiesAlpha-=this.alphaDelta:F.enemiesApha<=0&&(F.contextEnemies.globalAlpha=0,F.enemiesFaded=!0),F.contextEnemies.globalAlpha=this.enemiesAlpha;break;case"player":this.playerAlpha>0?this.playerAlpha-=this.alphaDelta:this.playerAlpha<=0&&(F.contextPlayer.globalAlpha=0,F.playerFaded=!0),F.contextPlayer.globalAlpha=this.playerAlpha}}}function m(){this.font="Helvetica",this.fontWeight="bold",this.fontColor0="purple",this.fontColor1="#FFD455",this.fontColor2="#FFFFFF",this.levelBriefing=["Outside the galaxy","The outer space","AlphaPI 2034"],this.gameIntro=function(){F.contextText.clearRect(0,0,F.width,F.height),B("10,000 AD",1,this.font,.06*F.width,this.fontColor0,this.fontWeight),B("No one knew they were coming",2,this.font,.05*F.width,this.fontColor1,this.fontWeight),navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?B("Tap screen to continue",3,this.font,.04*F.width,this.fontColor2,this.fontWeight):B("Press ENTER or LMB to continue",3,this.font,.04*F.width,this.fontColor2,this.fontWeight)},this.lvlIntro=function(){F.contextText.clearRect(0,0,F.width,F.height),B("Stage "+F.level,1,this.font,.06*F.width,this.fontColor1,this.fontWeight),B(this.levelBriefing[F.level-1],2,this.font,.05*F.width,this.fontColor1,this.fontWeight),navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?B("Tap screen to continue",3,this.font,.04*F.width,this.fontColor2,this.fontWeight):B("Press ENTER or LMB to continue",3,this.font,.04*F.width,this.fontColor2,this.fontWeight)},this.lvlComplete=function(){F.contextText.clearRect(0,0,F.width,F.height),B("Stage Complete!",1,this.font,.06*F.width,this.fontColor1,this.fontWeight),B(F.score+" enemy ships destroyed",2,this.font,.05*F.width,this.fontColor1,this.fontWeight),navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?B("Tap screen to continue",3,this.font,.04*F.width,this.fontColor2,this.fontWeight):B("Press ENTER or LMB to continue",3,this.font,.04*F.width,this.fontColor2,this.fontWeight)},this.gameOver=function(){F.contextText.clearRect(0,0,F.width,F.height),B("Game Over",1,this.font,.06*F.width,this.fontColor1,this.fontWeight),B(F.score+" enemy ships destroyed",2,this.font,.05*F.width,this.fontColor1,this.fontWeight),navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?B("Tap screen to restart",3,this.font,.04*F.width,this.fontColor2,this.fontWeight):B("Press ENTER or LMB to restart",3,this.font,.04*F.width,this.fontColor2,this.fontWeight)}}function n(){this.keyframe0=!0,this.keyframe1=!1,this.keyframe2=!1,this.lvlIntro=function(){gameText.lvlIntro(),this.keyframe0?(gameLights.fadeIn("text"),(!F.textFaded||F.keys[13]||O)&&(O=0,F.keys[13]=!1,F.textFaded||(this.keyframe0=!1,this.keyframe1=!0),gameLights.on("text"))):this.keyframe1?(F.keys[13]||O)&&(O=0,F.keys[13]=!1,this.keyframe1=!1,this.keyframe2=!0):this.keyframe2&&(gameLights.fadeOut("text"),(F.textFaded||F.keys[13]||O)&&(O=0,F.keys[13]=!1,F.textFaded&&(this.keyframe2=!1,this.keyframe0=!0,z(),F.lvlIntro=!1,F.lvlStart=!0),gameLights.off("text")))},this.lvlStart=function(){gameLights.fadeIn("all"),F.faded||(gameUI.updateAll(),F.lvlStart=!1)},this.lvlComplete=function(){gameText.lvlComplete(),this.keyframe0?(F.keys[13]||O)&&(O=0,F.keys[13]=!1,this.keyframe0=!1,this.keyframe1=!0):this.keyframe1&&(gameLights.fadeOut("all"),(F.faded||F.keys[13]||O)&&(O=0,F.keys[13]=!1,F.faded&&(F.lvlIntro=!0,this.keyframe0=!0,this.keyframe1=!1,F.levelComplete=!1,F.level++),gameLights.off("all")))},this.gameOver=function(){gameText.gameOver(),this.keyframe0?(F.keys[13]||O)&&(O=0,F.keys[13]=!1,this.keyframe0=!1,this.keyframe1=!0):this.keyframe1&&(gameLights.fadeOut("all"),(F.faded||F.keys[13]||O)&&(O=0,F.keys[13]=0,F.faded&&(this.keyframe0=!0,this.keyframe1=!1,F.start=!0,gameLights.on("text"),gameText.gameIntro(),F.gameOver=!1,F.paused=!0),gameLights.off("all")))},this.reset=function(){this.keyframe0=!0,this.keyframe1=!1,this.keyframe2=!1}}function o(){if(!F.keys[13]&&!O||!F.start||F.gameOver||F.gameWon||(z(),O=0,F.keys[13]=!1,F.music&&F.songs.length<1&&(F.songs.push(new Audio("_sounds/_lvl1/tune1.mp3")),F.songs[0].play(),F.songs[0].loop=!0),gameLights.off("all"),F.start=!1,F.paused=!1,gameUI.updateAll()),F.keys[27]&&(O=0,F.keys[27]=!1,playerShip.hull=0,playerShip.lives=0,F.gameOver=!0),F.keys[119]&&(F.sound=F.sound?!1:!0,gameUI.updateSound(),F.keys[119]=!1),F.keys[120])if(F.music=F.music?!1:!0,gameUI.updateSound(),F.keys[120]=!1,F.songs.length>0){for(var a in F.songs)F.songs[a].pause();F.songs=[]}else if(F.songs.length<1){F.songs.push(new Audio("_sounds/_lvl1/tune1.mp3"));for(var b in F.songs)F.songs[b].play(),F.songs[b].loop=!0}!F.keys[80]||F.gameWon||F.gameOver||(F.paused=F.paused?!1:!0,F.keys[80]=!1),(F.keys[27]||(F.keys[13]||O)&&F.paused&&!F.start&&F.gameOver&&!F.gameWon||(F.keys[13]||O)&&F.paused&&!F.start&&F.level>=7)&&((F.lives<1||F.level>=7)&&(F.level=X_Level,F.score=0,playerShip.lives=X_Lives),z())
}function p(){if(dtTimer<=30){var a=(new Date).getTime(),b=a-timeThen;dtArray.push(b),timeThen=a,dtTimer++}if(30==dtTimer){for(var d=0,e=0;e<dtArray.length-2;e++)d+=dtArray[e+2];dt=Math.round(d/dtArray.length)/1e3}if(F.timer++,F.seconds=F.timer/60||0,F.contextEnemies.clearRect(0,0,F.width,F.height),F.contextPlayer.clearRect(0,0,F.width,F.height),playerShip.update(),playerShip.draw(),F.contextBackground.clearRect(0,0,F.width,F.height),gameBackground.load(),1==F.level?q():2==F.level?q():3==F.level&&lvl3(),F.bossDead&&F.levelUpTimer<=100&&(F.levelUpTimer++,100==F.levelUpTimer&&(F.levelComplete=!0,O=0)),F.lvlIntro?gameTransition.lvlIntro():F.lvlStart?gameTransition.lvlStart():F.levelComplete?gameTransition.lvlComplete():F.gameOver&&gameTransition.gameOver(),F.playerBullets.length>=1)for(var f in F.playerBullets)F.playerBullets[f].dead||(F.playerBullets[f].update(),F.playerBullets[f].draw()),(F.playerBullets[f].dead||F.playerBullets[f].x>F.width+F.playerBullets[f].size||F.playerBullets[f].x<0-F.playerBullets[f].size||F.playerBullets[f].y>F.height+F.playerBullets[f].size||F.playerBullets[f].y<-30)&&F.playerBullets.splice(f,1);if(F.enemies.length>0){for(var g in F.enemies)F.enemies[g].update(),F.enemies[g].draw();if(F.playerBullets.length>=1)for(var h in F.enemies)for(var i in F.playerBullets)A(F.enemies[h],F.playerBullets[i])&&!F.enemies[h].dead&&(F.enemies[h].hit=!0,F.enemies[h].hull-=F.playerBullets[i].power,F.enemies[h].hull>0&&F.explosions.push(new c(F.enemies[h].x+.5*F.enemies[h].size,F.enemies[h].y+.5*F.enemies[h].size,0,1,.25*F.enemies[h].size)),F.playerBullets[i].dead=!0);for(var k in F.enemies)!A(F.enemies[k],playerShip)||F.enemies[k].dead||playerShip.imune||F.gameOver||(playerShip.hull-=F.enemies[k].hull,gameUI.updateEnergy(),playerShip.hit=!0,F.enemies[k].hit=!0,F.enemies[k].hull-=playerShip.hull);for(var l in F.enemies)(F.enemies[l].dead||F.enemies[l].y>F.height+F.enemies[l].size||F.enemies[l].x<.3*-F.width||F.enemies[l].x>1.3*F.width)&&(F.enemies[l].dead&&(lootchance=Math.random(),lootchance<.05&&F.loot.push(new j(F.enemies[l].x,F.enemies[l].y))),F.enemies.splice(l,1))}if(F.waves.length>0)for(var m in F.waves)F.waves[m].update(),F.waves[m].over&&F.waves.splice(m,1);if(F.loot.length>=1)for(var n in F.loot)F.loot[n].update(),F.loot[n].draw(),(F.loot[n].dead||F.loot[n].x>F.width+F.loot[n].size||F.loot[n].x<0-F.loot[n].size||F.loot[n].y>F.height+F.loot[n].size||F.loot[n].y<-30)&&F.loot.splice(n,1);if(F.enemyBullets.length>=1)for(var o in F.enemyBullets)F.enemyBullets[o].update(),F.enemyBullets[o].draw(),!A(F.enemyBullets[o],playerShip)||playerShip.imune||F.gameOver||(playerShip.hull-=F.enemyBullets[o].power,gameUI.updateEnergy(),playerShip.hit=!0,F.enemyBullets[o].dead=!0),(F.enemyBullets[o].dead||F.enemyBullets[o].x>F.width+F.enemyBullets[o].size||F.enemyBullets[o].x<0-F.enemyBullets[o].size||F.enemyBullets[o].y>F.height+F.enemyBullets[o].size||F.enemyBullets[o].y<-30)&&F.enemyBullets.splice(o,1);if(F.explosions.length>0){for(var p in F.explosions)F.explosions[p].update(),F.explosions[p].draw();for(var r in F.explosions)19==F.explosions[r].currentFrame&&F.explosions.splice(r,1)}if(F.sounds.length>0)for(var s in F.sounds)F.sounds[s].play(),F.sounds[s].addEventListener("ended",F.sounds.splice(s,1))}function q(){1==F.seconds&&F.waves.push(new L("left",.3*F.width,1,"pawn",1,300,1,0,!0)),1==F.seconds&&F.waves.push(new L("right",.3*F.width,1,"pawn",1,250,1,0,!0)),3==F.seconds&&F.waves.push(new L("left",.5*F.height,1,"pawn",1,250,1,0,!0)),3==F.seconds&&F.waves.push(new L("right",.5*F.height,1,"pawn",1,300,1,0,!0)),5==F.seconds&&F.enemies.push(new f(.7*F.width,.1*-F.height,80,Math.PI/2,10,"miniboss",24,2)),7==F.seconds&&F.enemies.push(new f(.3*F.width,.1*-F.height,155,Math.PI/2,10,"base",22,1)),8==F.seconds&&F.waves.push(new L("left",.3*F.height,1,"pawn",4,250,1,2,!0)),9==F.seconds&&F.waves.push(new L("right",.2*F.height,1,"pawn",3,300,1,2,!0)),10==F.seconds&&F.waves.push(new L("top",.5*F.width,1,"pawn",6,300,1,2,!0)),11==F.seconds&&F.waves.push(new L("top",.7*F.width,1,"pawn",4,300,1,2,!0)),12==F.seconds&&F.waves.push(new L("left",.2*F.height,1,"pawn",3,300,1,2,!0)),13==F.seconds&&(F.music&&(F.songs.push(new Audio("_sounds/_lvl1/tune2.mp3")),F.songs[1].play(),F.songs[1].loop=!0),F.enemies.push(new f(.3*F.width,.1*-F.height,155,Math.PI/2,10,"base",23,1))),15==F.seconds&&F.waves.push(new L("top",.2*F.width,1,"pawn",2,300,1,2,!0)),16==F.seconds&&F.waves.push(new L("top",.4*F.width,1,"pawn",3,300,1,2,!0)),17==F.seconds&&F.waves.push(new L("top",.6*F.width,1,"pawn",4,300,1,2,!0)),18==F.seconds&&F.waves.push(new L("top",.8*F.width,1,"pawn",5,300,1,2,!0)),22==F.seconds&&F.waves.push(new L("top",.3*F.width,1,"pawn",4,300,1,2,!0)),25==F.seconds&&F.waves.push(new L("left",.4*F.width,1,"pawn",4,300,1,2,!0)),27==F.seconds&&F.waves.push(new L("right",.3*F.width,1,"pawn",4,300,1,2,!0)),30==F.seconds&&F.waves.push(new L("top",.3*F.width,1,"pawn",4,300,1,2,!0)),33==F.seconds&&F.waves.push(new L("top",.6*F.width,1,"pawn",4,300,1,2,!0)),35==F.seconds&&F.waves.push(new L("right",.2*F.width,1,"pawn",4,300,1,2,!0)),37==F.seconds&&F.enemies.push(new f(.2*F.width,.1*-F.height,80,Math.PI/2,10,"miniboss",24,2)),38==F.seconds&&F.enemies.push(new f(.4*F.width,.1*-F.height,80,Math.PI/2,10,"miniboss",24,2)),39==F.seconds&&F.enemies.push(new f(.6*F.width,.1*-F.height,80,Math.PI/2,10,"miniboss",24,2)),40==F.seconds&&F.enemies.push(new f(.8*F.width,.1*-F.height,80,Math.PI/2,10,"miniboss",24,2)),41==F.seconds&&F.enemies.push(new f(.5*F.width,.1*-F.height,80,Math.PI/2,10,"miniboss",24,2)),42==F.seconds&&F.enemies.push(new f(.2*F.width,.1*-F.height,80,Math.PI/2,10,"miniboss",24,2)),43==F.seconds&&F.enemies.push(new f(.4*F.width,.1*-F.height,80,Math.PI/2,10,"miniboss",24,2)),44==F.seconds&&F.enemies.push(new f(.6*F.width,.1*-F.height,80,Math.PI/2,10,"miniboss",24,2)),45==F.seconds&&F.enemies.push(new f(.8*F.width,.1*-F.height,80,Math.PI/2,10,"miniboss",24,2)),F.seconds>50&&0===F.enemies.length&&!F.bossDead&&(F.music&&(F.songs.push(new Audio("_sounds/_lvl1/boss.mp3")),F.songs[2].play()),F.enemies.push(new g(.3*F.width,.1*-F.height,150,Math.PI/2,100,27)))}function r(){M=document.getElementById("textCanvas"),N=M.getContext("2d"),M.addEventListener("mousedown",v,!1),M.addEventListener("mouseup",t,!1),M.addEventListener("mousemove",x,!1),M.addEventListener("touchstart",w,!1),M.addEventListener("touchend",u,!1),M.addEventListener("touchcancel",u,!1),M.addEventListener("touchleave",u,!1),M.addEventListener("touchmove",y,!1)}function t(a){a&&(a.preventDefault(),O=0,x())}function u(a){a&&(a.preventDefault(),O=0)}function v(a){a&&(a.preventDefault(),O=1,x())}function w(a){a&&(a.preventDefault(),O=1,y())}function x(a){a&&(a.preventDefault(),canvasX=a.pageX-M.offsetLeft,canvasY=a.pageY-M.offsetTop)}function y(a){a&&(a.preventDefault(),canvasX=a.targetTouches[0].pageX-M.offsetLeft,canvasY=a.targetTouches[0].pageY-M.offsetTop)}function z(){gameLights.off("all"),gameTransition.reset(),O=0,F.gameOver=!1,F.gameWon=!1,F.level=F.lvlIntro?F.level:1,F.bossDead=!1,F.levelComplete=!1,F.lvlStart=!1,F.lvlIntro=!0,F.levelUpTimer=0,F.contextBackground.clearRect(0,0,F.width,F.height),F.contextPlayer.clearRect(0,0,F.width,F.height),F.contextEnemies.clearRect(0,0,F.width,F.height),F.contextText.clearRect(0,0,F.width,F.height),playerShip.reset(),gameUI.updateAll(),F.background=[],F.enemies=[],F.waves=[],F.enemyBullets=[],F.loot=[],F.delayTimer=0,F.timer=0,F.sounds=[];for(var a in F.songs)F.songs[a].pause();F.songs=[],F.music&&(F.songs.push(new Audio("_sounds/_lvl1/tune1.mp3")),F.songs[0].play(),F.songs[0].loop=!0),F.paused=!1}function A(a,b){return!(a.x>b.x+b.size||a.x+a.size<b.x||a.y>b.y+b.size||a.y+a.size<b.y)}function B(a,b,c,d,e,f){var g=a,h=g.length,i=h*d/2,j=.1*F.height,k=.5*(F.width-i),l=F.height/3.5+j*b;F.contextText.font=f+" "+d+"px "+c,F.contextText.fillStyle=e,F.contextText.fillText(g,k,l)}function C(){requestAnimFrame(C),o(),F.paused||p()}function D(a){F.requiredImages=a.length;for(var b in a){var c=new Image;c.src=a[b],F.images[b]=c,F.images[b].onload=function(){F.doneImages++}}}function E(){F.doneImages>=F.requiredImages?(gameText.gameIntro(),C()):setTimeout(function(){E()},1)}window.addEventListener("load",function(){window.applicationCache.addEventListener("updateready",function(){window.applicationCache.status==window.applicationCache.UPDATEREADY&&confirm("A new version of InVaDeRs is available. Load it?")&&window.location.reload()},!1)},!1),window.addEventListener("load",r,!1),$.ajax({type:"GET",url:"game.xml",dataType:"xml",async:!1,success:function(a){$(a).find("data").each(function(){X_Sound=parseInt($(this).find("sound").text()),X_Music=parseInt($(this).find("music").text()),X_Level=parseInt($(this).find("level").text()),X_Lives=parseInt($(this).find("player-lives").text()),X_PlayerSpeed=parseInt($(this).find("player-speed").text()),X_EnemySpeed=parseInt($(this).find("enemy-speed").text()),X_GunSpeed=parseInt($(this).find("reload-time").text()),X_EnGunSpeed=parseInt($(this).find("enreload-time").text()),X_BulletSpeed=parseInt($(this).find("bullet-speed").text()),X_EnBulletSpeed=parseInt($(this).find("enbullet-speed").text()),X_Title=$(this).find("title").text(),X_Subtitle=$(this).find("subtitle").text(),X_dt_Start=$(this).find("dt-start").text(),X_mb_Start=$(this).find("mb-start").text()})},error:function(){alert("The XML File could not be processed correctly.")}});var F={};F.stars=[],F.faded=!0,F.backgroundFaded=!0,F.enemiesFaded=!0,F.playerFaded=!0,F.textFaded=!0,F.background=[],F.score=0,F.levelScore=0,F.level=X_Level,F.bossDead=!1,F.levelComplete=!1,F.levelUpTimer=0,F.lives=X_Lives,F.keys=[],F.playerBullets=[],F.enemyBullets=[],F.enemies=[],F.waves=[],F.loot=[],F.explosions=[],dt=0,dtTimer=0,dtArray=[],timeThen=(new Date).getTime(),F.start=!0,F.lvlIntro=!0,F.lvlStart=!1,F.paused=!0,F.escaped=!1,F.gameWon=!1,F.gameOver=!1,F.delayTimer=0,F.timer=0,F.sound=X_Sound,F.music=X_Music,F.sounds=[],F.songs=[],F.images=[],F.doneImages=0,F.requiredImages=0,F.contextBackground=document.getElementById("backgroundCanvas").getContext("2d"),F.contextEnemies=document.getElementById("enemiesCanvas").getContext("2d"),F.contextPlayer=document.getElementById("playerCanvas").getContext("2d"),F.contextText=document.getElementById("textCanvas").getContext("2d");var G=$("#backgroundCanvas"),H=$("#enemiesCanvas"),I=$("#playerCanvas"),J=$("#textCanvas"),K=(G.get(0).getContext("2d"),$(G).parent());$(window).resize(a),a(),b.prototype=Object.create(particle.prototype),b.prototype.constructor=b,gameBackground=new b,c.prototype=Object.create(particle.prototype),c.prototype.constructor=c,d.prototype=Object.create(particle.prototype),d.prototype.constructor=d,playerShip=new d(10,15),e.prototype=Object.create(particle.prototype),e.prototype.constructor=e,f.prototype=Object.create(particle.prototype),f.prototype.constructor=f,g.prototype=Object.create(particle.prototype),g.prototype.constructor=g,h.prototype=Object.create(particle.prototype),h.prototype.constructor=h,j.prototype=Object.create(particle.prototype),j.prototype.constructor=j;var L=function(a,b,c,d,e,g,h,i){switch(this.side=a,this.spawnedShips=0,this.race=c,this.type=d,this.fleetSize=e,this.speed=g,this.hull=h,this.fireRate=i||0,this.spawnTimer=1,this.spawnDivision=Math.round(1500*dt),this.side){case"top":this.x=b,this.y=.1*-F.height,this.direction=Math.PI/2;break;case"left":this.x=.2*-F.width,this.y=b,this.direction=0;break;case"right":this.x=1.2*F.width,this.y=b,this.direction=Math.PI}this.over=!1,this.update=function(){this.spawnTimer++,this.spawnedShips<=this.fleetSize&&this.spawnTimer%this.spawnDivision==1&&(this.spawnTimer=1,F.enemies.push(new f(this.x,this.y,this.speed,this.direction,this.hull,this.type,this.race,this.fireRate,!0)),this.spawnedShips++),this.spawnedShips==this.fleetSize&&(this.over=!0)}};gameUI=new k,gameLights=new l,gameText=new m,gameTransition=new n,$(document).keydown(function(a){F.keys[a.keyCode?a.keyCode:a.which]=!0}),$(document).keyup(function(a){delete F.keys[a.keyCode?a.keyCode:a.which]});var M,N;canvasX=playerShip.x,canvasY=playerShip.y;var O=0;moveX=canvasX,moveY=canvasY,D(["_img/_dist/fighter/fighter.png","_img/_dist/enemies/sectoid.png","_img/_dist/laser.png","_img/_dist/explosion.png","_img/_dist/fighter/fighter_right1.png","_img/_dist/fighter/fighter_right2.png","_img/_dist/fighter/fighter_right3.png","_img/_dist/fighter/fighter_right4.png","_img/_dist/fighter/fighter_right5.png","_img/_dist/fighter/fighter_left1.png","_img/_dist/fighter/fighter_left2.png","_img/_dist/fighter/fighter_left3.png","_img/_dist/fighter/fighter_left4.png","_img/_dist/fighter/fighter_left5.png","_img/_dist/stars/star1.png","_img/_dist/stars/star2.png","_img/_dist/stars/star3.png","_img/_dist/stars/star4.png","_img/_dist/stars/star5.png","_img/_dist/stars/star6.png","_img/_dist/missile.png","_img/_dist/background/level_1.jpg","_img/_dist/enemies/_alienbase/alienbase1.png","_img/_dist/enemies/_alienbase/alienbase2.png","_img/_dist/enemies/_miniboss/floater.png","_img/_dist/ui/energyBar.png","_img/_dist/ui/energyPoint.png","_img/_dist/enemies/_bigboss/sectoidBoss.png"]),E()})}(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();