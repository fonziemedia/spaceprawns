var vector={_x:1,_y:0,create:function(a,b){var c=Object.create(this);return c.setX(a),c.setY(b),c},setX:function(a){this._x=a},getX:function(){return this._x},setY:function(a){this._y=a},getY:function(){return this._y},setAngle:function(a){var b=this.getLength();this._x=Math.cos(a)*b,this._y=Math.sin(a)*b},getAngle:function(){return Math.atan2(this._y,this._x)},setLength:function(a){var b=this.getAngle();this._x=Math.cos(b)*a,this._y=Math.sin(b)*a},getLength:function(){return Math.sqrt(this._x*this._x+this._y*this._y)},add:function(a){return vector.create(this._x+a.getX(),this._y+a.getY())},subtract:function(a){return vector.create(this._x-a.getX(),this._y-a.getY())},multiply:function(a){return vector.create(this._x*a,this._y*a)},divide:function(a){return vector.create(this._x/a,this._y/a)},addTo:function(a){this._x+=a.getX(),this._y+=a.getY()},subtractFrom:function(a){this._x-=a.getX(),this._y-=a.getY()},multiplyBy:function(a){this._x*=a,this._y*=a},divideBy:function(a){this._x/=a,this._y/=a}},utils={norm:function(a,b,c){return(a-b)/(c-b)},lerp:function(a,b,c){return(c-b)*a+b},map:function(a,b,c,d,e){return utils.lerp(utils.norm(a,b,c),d,e)},clamp:function(a,b,c){return Math.min(Math.max(a,Math.min(b,c)),Math.max(b,c))},distance:function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)},distanceXY:function(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(e*e+f*f)},circleCollision:function(a,b){return utils.distance(a,b)<=a.radius+b.radius},circlePointCollision:function(a,b,c){return utils.distanceXY(a,b,c.x,c.y)<c.radius},pointInRect:function(a,b,c){return utils.inRange(a,c.x,c.x+c.width)&&utils.inRange(b,c.y,c.y+c.height)},inRange:function(a,b,c){return a>=Math.min(b,c)&&a<=Math.max(b,c)},rangeIntersect:function(a,b,c,d){return Math.max(a,b)>=Math.min(c,d)&&Math.min(a,b)<=Math.max(c,d)},rectIntersect:function(a,b){return utils.rangeIntersect(a.x,a.x+a.width,b.x,b.x+b.width)&&utils.rangeIntersect(a.y,a.y+a.height,b.y,b.y+b.height)},degreesToRads:function(a){return a/180*Math.PI},radsToDegrees:function(a){return 180*a/Math.PI},randomRange:function(a,b){return a+Math.random()*(b-a)},randomInt:function(a,b){return Math.floor(a+Math.random()*(b-a+1))},roundToPlaces:function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},roundNearest:function(a,b){return Math.round(a/b)*b},quadraticBezier:function(a,b,c,d,e){return e=e||{},e.x=Math.pow(1-d,2)*a.x+2*(1-d)*d*b.x+d*d*c.x,e.y=Math.pow(1-d,2)*a.y+2*(1-d)*d*b.y+d*d*c.y,e},cubicBezier:function(a,b,c,d,e,f){return f=f||{},f.x=Math.pow(1-e,3)*a.x+3*Math.pow(1-e,2)*e*b.x+3*(1-e)*e*e*c.x+e*e*e*d.x,f.y=Math.pow(1-e,3)*a.y+3*Math.pow(1-e,2)*e*b.y+3*(1-e)*e*e*c.y+e*e*e*d.y,f},multicurve:function(a,b){var c,d,e,f;b.moveTo(a[0].x,a[0].y);for(var g=1;g<a.length-2;g+=1)c=a[g],d=a[g+1],e=(c.x+d.x)/2,f=(c.y+d.y)/2,b.quadraticCurveTo(c.x,c.y,e,f);c=a[a.length-2],d=a[a.length-1],b.quadraticCurveTo(c.x,c.y,d.x,d.y)}},particle=function(a,b,c,d,e){this.x=a,this.y=b,this.vx=Math.cos(d)*c*dt,this.vy=Math.sin(d)*c*dt,this.mass=1,this.radius=0,this.bounce=-1,this.friction=1,this.gravity=e||0,this.springs=[],this.gravitations=[],this.addGravitation=function(a){this.removeGravitation(a),this.gravitations.push(a)},this.removeGravitation=function(a){for(var b=0;b<this.gravitations.length;b+=1)if(a===this.gravitations[b])return void this.gravitations.splice(b,1)},this.addSpring=function(a,b,c){this.removeSpring(a),this.springs.push({point:a,k:b,length:c||0})},this.removeSpring=function(a){for(var b=0;b<this.springs.length;b+=1)if(a===this.springs[b].point)return void this.springs.splice(b,1)},this.getSpeed=function(){return Math.sqrt(this.vx*this.vx+this.vy*this.vy)},this.setSpeed=function(a){var b=this.getHeading();this.vx=Math.cos(b)*a,this.vy=Math.sin(b)*a},this.getHeading=function(){return Math.atan2(this.vy,this.vx)},this.setHeading=function(a){var b=this.getSpeed();this.vx=Math.cos(a)*b,this.vy=Math.sin(a)*b},this.accelerate=function(a,b){this.vx+=a,this.vy+=b},this.update=function(){0===dt&&(this.vx=Math.cos(d)*c*dt,this.vy=Math.sin(d)*c*dt),this.handleSprings(),this.handleGravitations(),this.vx*=this.friction,this.vy*=this.friction,this.vy+=this.gravity,this.x+=this.vx,this.y+=this.vy},this.handleGravitations=function(){for(var a=0;a<this.gravitations.length;a+=1)this.gravitateTo(this.gravitations[a])},this.handleSprings=function(){for(var a=0;a<this.springs.length;a+=1){var b=this.springs[a];this.springTo(b.point,b.k,b.length)}},this.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)},this.distanceTo=function(a){var b=a.x-this.x,c=a.y-this.y;return Math.sqrt(b*b+c*c)},this.gravitateTo=function(a){var b=a.x-this.x,c=a.y-this.y,d=b*b+c*c,e=Math.sqrt(d),f=a.mass/d,g=b/e*f,h=c/e*f;this.vx+=g,this.vy+=h},this.springTo=function(a,b,c){var d=a.x-this.x,e=a.y-this.y,f=Math.sqrt(d*d+e*e),g=(f-c||0)*b;this.vx+=d/f*g,this.vy+=e/f*g}};!function(){$(document).ready(function(){function a(){if(D.attr("height",$(H).height()),E.attr("height",$(H).height()),F.attr("height",$(H).height()),G.attr("height",.2*$(H).height()),$(H).width()<1080)D.attr("width",$(H).width()),E.attr("width",$(H).width()),F.attr("width",$(H).width()),G.attr("width",$(H).width()),C.width=$(H).width();else{var a=9*$(H).height()/16;D.attr("width",a),E.attr("width",a),F.attr("width",a),G.attr("width",a),D.css({left:.5*($(H).width()-a)}),E.css({left:.5*($(H).width()-a)}),F.css({left:.5*($(H).width()-a)}),G.css({left:.5*($(H).width()-a)}),C.width=a}C.height=$(H).height(),dtSize=.001*C.height,C.enemySpeed=X_EnemySpeed*C.height/2500,C.EnBulletSpeed=X_EnBulletSpeed*C.height/1e3,C.fullShootTimer=X_GunSpeed,C.enfullShootTimer=X_EnGunSpeed,C.shootTimer=C.fullShootTimer,C.enshootTimer=C.enfullShootTimer,C.contextBackground.font="bold "+.08*C.width+"px "+C.font,C.contextBackground.fillStyle="white",C.contextBackground.fillText("Loading...",.3*C.width,.47*C.height)}function b(a,b,c){particle.call(this,a),this.direction=Math.PI/2,this.section=c,this.width=C.width,this.height=C.width*(16/9)*4,this.x=0,this.y=0===this.section?-(this.height-C.height):this.y=-this.height,this.image=b,this.update=function(){this.vx=Math.cos(this.direction)*a*dt,this.vy=Math.sin(this.direction)*a*dt,this.x+=this.vx,this.y+=this.vy},this.draw=function(){C.contextBackground.drawImage(C.images[this.image],this.x,this.y,this.width,this.height)}}function c(a,b,c,d,e){particle.call(this,a,b,c,d),this.x=a-.2*e,this.y=b-.2*e,this.speed=c,this.size=1.5*e,this.hitTimer=0,this.dead=!1,this.deadTime=60,this.image=3,this.frameWidth=96,this.frameHeight=96,this.startFrame=0,this.endFrame=19,this.frameSpeed=2,this.animationSequence=[],this.currentFrame=0,this.counter=0,this.fpr=Math.floor(C.images[this.image].width/this.frameWidth),this.update=function(){for(this.vx=Math.cos(d)*this.speed*dt,this.vy=Math.sin(d)*this.speed*dt,this.x+=this.vx,this.y+=this.vy,this.FrameNum=this.startFrame;this.FrameNum<=this.endFrame;this.FrameNum++)this.animationSequence.push(this.FrameNum);this.counter==this.frameSpeed-1&&(this.currentFrame=(this.currentFrame+1)%this.animationSequence.length),this.counter=(this.counter+1)%this.frameSpeed,this.spriteRow=Math.floor(this.animationSequence[this.currentFrame]/this.fpr),this.spriteCol=Math.floor(this.animationSequence[this.currentFrame]%this.fpr)},this.draw=function(){this.currentFrame<=19&&C.contextPlayer.drawImage(C.images[this.image],this.spriteCol*this.frameWidth,this.spriteRow*this.frameHeight,this.frameWidth,this.frameHeight,this.x,this.y,this.size,this.size)}}function d(a,b){particle.call(this),this.x=.46*C.width,this.y=.9*C.height,this.speed=0,this.direction=-Math.PI/2,this.size=100*dtSize,this.hull=a,this.bulletspeed=X_BulletSpeed*C.height/1e3,this.image=0,this.rendered=!1,this.hit=!1,this.hitTimer=0,this.dead=!1,this.bullets=[],this.bulletTimer=b-1,this.bulletDivision=b,this.laserLevel=1,this.missileLevel=0,this.lives=X_Lives,this.context=C.contextPlayer,this.update=function(){if(this.vx=Math.cos(this.direction)*this.speed*dt,this.vy=Math.sin(this.direction)*this.speed*dt,!L||C.paused||C.gameOver||C.gameWon||canvasX>this.size/4&&canvasX<=C.width-this.size/4&&canvasY>this.size&&canvasY<=C.height-this.size/6&&(moveRight1=canvasX>moveX&&canvasX<=moveX+2?!0:!1,moveRight2=canvasX>moveX+2&&canvasX<=moveX+4?!0:!1,moveRight3=canvasX>moveX+4&&canvasX<=moveX+6?!0:!1,moveRight4=canvasX>moveX+6&&canvasX<=moveX+8?!0:!1,moveRight5=canvasX>moveX+8?!0:!1,moveLeft1=canvasX<moveX&&canvasX>=moveX-2?!0:!1,moveLeft2=canvasX<moveX-2&&canvasX>=moveX-4?!0:!1,moveLeft3=canvasX<moveX-4&&canvasX>=moveX-6?!0:!1,moveLeft4=canvasX<moveX-6&&canvasX>=moveX-8?!0:!1,moveLeft5=canvasX<moveX-8?!0:!1,(canvasX!=moveX||canvasY!=moveY)&&(distX=moveX-canvasX,distY=moveY-canvasY,distX<10&&distX>-10?(this.speed=400,this.x-=distX):distX>=10?(this.speed=400,this.x-=this.speed*dt):distX<=-10&&(this.speed=400,this.x+=this.speed*dt),distY<10&&distY>-10?(this.speed=400,this.y-=distY):distY>=10?(this.speed=400,this.y-=this.speed*dt):distY<=-10&&(this.speed=400,this.y+=this.speed*dt)),this.image=moveRight1?4:moveRight2?5:moveRight3?6:moveRight4?7:moveRight5?8:moveLeft1?9:moveLeft2?10:moveLeft3?11:moveLeft4?12:moveLeft5?13:0,this.rendered=!1,moveX=this.x+.5*this.size,moveY=this.y+1.5*this.size),L||C.gameOver||(this.image=0,this.rendered=!1),(C.keys[37]||C.keys[65]&&!C.gameOver&&!C.gameWon)&&this.x>this.size/50&&(this.speed=400,this.direction=Math.PI,this.image=13,this.rendered=!1,this.x-=this.speed*dt),(C.keys[39]||C.keys[68]&&!C.gameOver&&!C.gameWon)&&this.x<=C.width-this.size&&(this.speed=400,this.direction=0,this.image=8,this.rendered=!1,this.x+=this.speed*dt),(C.keys[38]||C.keys[87]&&!C.gameOver&&!C.gameWon)&&this.y>this.size/12&&(this.speed=400,this.direction=-Math.PI/2,this.rendered=!1,this.y-=this.speed*dt),C.keys[40]||C.keys[83]&&!C.gameOver&&!C.gameWon?this.y<=C.height-this.size&&(this.speed=400,this.direction=Math.PI/2,this.rendered=!1,this.y+=this.speed*dt):this.speed=0,!C.keys[32]&&!L||C.gameOver)this.bulletTimer=b-1;else if(this.bulletTimer++,this.bulletTimer%this.bulletDivision===0){switch(this.laserLevel){case 1:this.bullets.push(new e(playerShip.x+.5*playerShip.size,playerShip.y-.2*playerShip.size,600,-Math.PI/2,45,1,1,2,48,11));break;case 2:this.bullets.push(new e(playerShip.x+.25*playerShip.size,playerShip.y-.2*playerShip.size,600,-Math.PI/2,45,1,1,2,48,11)),this.bullets.push(new e(playerShip.x+.75*playerShip.size,playerShip.y-.2*playerShip.size,600,-Math.PI/2,45,1,1,2,48,11));break;default:this.bullets.push(new e(playerShip.x+.25*playerShip.size,playerShip.y-.2*playerShip.size,600,-Math.PI/2,45,1,1,2,48,11)),this.bullets.push(new e(playerShip.x+.5*playerShip.size,playerShip.y-.2*playerShip.size,600,-Math.PI/2,45,1,1,2,48,11)),this.bullets.push(new e(playerShip.x+.75*playerShip.size,playerShip.y-.2*playerShip.size,600,-Math.PI/2,45,1,1,2,48,11))}switch(this.missileLevel){case 0:break;case 1:this.bullets.push(new e(playerShip.x+.5*playerShip.size,playerShip.y+playerShip.size,100,-Math.PI/2,45,2,1.03,20,64,2));break;case 2:this.bullets.push(new e(playerShip.x,playerShip.y+playerShip.size,100,-Math.PI/2,45,2,1.03,20,64,2)),this.bullets.push(new e(playerShip.x+playerShip.size,playerShip.y+playerShip.size,100,-Math.PI/2,45,2,1.03,20,64,2));break;default:this.bullets.push(new e(playerShip.x,playerShip.y+playerShip.size,100,-Math.PI/2,45,2,1.03,20,64,2)),this.bullets.push(new e(playerShip.x+playerShip.size,playerShip.y+playerShip.size,100,-Math.PI/2,45,2,1.03,20,64,2)),this.bullets.push(new e(playerShip.x+.5*playerShip.size,playerShip.y+playerShip.size,100,-Math.PI/2,45,2,1.03,20,64,2))}"ON"==gameUI.soundFx&&C.shootSound.play(),this.bulletTimer=1}if(this.bullets.length>=1)for(var d in this.bullets)this.bullets[d].update(),(this.bullets.dead||this.bullets[d].x>C.width+this.bullets[d].size||this.bullets[d].x<0-this.bullets[d].size||this.bullets[d].y>C.height+this.bullets[d].size||this.bullets[d].y<-30)&&this.bullets.splice(d,1);this.hull<=0&&(C.explosions.push(new c(this.x,this.y,.5*this.speed,this.direction,this.size)),this.dead=!0,"ON"==gameUI.soundFx&&C.playerexplodeSound.play(),x(),this.lives-=1,this.hull=a),this.vx=Math.cos(this.direction)*this.speed,this.vy=Math.sin(this.direction)*this.speed},this.draw=function(){for(var a in this.bullets)this.bullets[a].draw();if(!this.dead&&(C.contextPlayer.drawImage(C.images[this.image],this.x,this.y,this.size,this.size),this.hit)){this.hitTimer++,navigator.vibrate(30);for(var b=C.contextPlayer.getImageData(this.x,this.y,this.size,this.size),c=b.data,d=0;d<c.length;d+=4){{c[d],c[d+1],c[d+2]}c[d]=c[d+1]=c[d+2]=255}C.contextPlayer.putImageData(b,this.x,this.y),this.hitTimer>4&&(this.hit=!1,this.hitTimer=0)}},this.reset=function(){playerShip.dead=!1,this.x=.46*C.width,this.y=.9*C.height,this.image=0,this.hull=a,this.rendered=!1,this.hit=!1,this.hitTimer=0,this.dead=!1,this.friction=0,this.bullets=[],this.laserLevel=1,this.missileLevel=0,this.lives=this.lives<1?3:this.lives}}function e(a,b,c,d,e,f,g,h,i,j){particle.call(this,a,b,c,d),this.size=e*dtSize,this.power=f,this.image=h,this.dead=!1,this.deadTime=60,this.frameWidth=i,this.frameHeight=i,this.startFrame=0,this.endFrame=j,this.frameSpeed=4,this.animationSequence=[],this.currentFrame=0,this.counter=0,this.fpr=Math.floor(C.images[this.image].width/this.frameWidth),this.image=h,this.friction=g,this.dtSet=!1,this.context=C.contextPlayer,this.update=function(){for(0===dt||this.dtSet||(this.vx=Math.cos(d)*c*dt,this.vy=Math.sin(d)*c*dt,this.dtSet=!0),this.vx*=this.friction,this.vy*=this.friction,this.x+=this.vx,this.y+=this.vy,this.FrameNum=this.startFrame;this.FrameNum<=this.endFrame;this.FrameNum++)this.animationSequence.push(this.FrameNum);this.counter==this.frameSpeed-1&&(this.currentFrame=(this.currentFrame+1)%this.animationSequence.length),this.counter=(this.counter+1)%this.frameSpeed,this.spriteRow=Math.floor(this.animationSequence[this.currentFrame]/this.fpr),this.spriteCol=Math.floor(this.animationSequence[this.currentFrame]%this.fpr)},this.draw=function(){this.dead||(C.contextPlayer.save(),C.contextPlayer.translate(this.x,this.y),C.contextPlayer.rotate(d-Math.PI/2),C.contextPlayer.drawImage(C.images[this.image],this.spriteCol*this.frameWidth,this.spriteRow*this.frameHeight,this.frameWidth,this.frameHeight,-this.size/2,-this.size/2,this.size,this.size),C.contextPlayer.restore())}}function f(a,b,d,e,f,g,i,j,k){switch(particle.call(this,a,b,d,e),this.type=g,this.type){case"pawn":this.size=65*dtSize;break;case"miniboss":this.size=120*dtSize;break;case"base":this.size=170*dtSize,this.rotation=0}this.hull=f,this.image=i,this.hit=!1,this.hitTimer=0,this.dead=!1,this.bulletTimer=1,this.sheep=k||!1,this.fireRate=60*j,this.bulletDivision=this.sheep?2*this.fireRate-Math.floor(Math.random()*this.fireRate)||99999:this.bulletDivision=this.fireRate||99999,this.context=C.contextEnemies,this.update=function(){this.lastX=this.x,this.lastY=this.y,this.vx=Math.cos(e)*d*dt,this.vy=Math.sin(e)*d*dt,this.x+=this.vx,this.y+=this.vy,!w(playerShip,this)||this.dead||C.gameOver||(playerShip.hull-=this.hull,gameUI.updateEnergy(),playerShip.hit=!0,this.hit=!0,this.hull-=playerShip.hull),this.hull<=0&&(this.dead=!0,C.explosions.push("base"==this.type?new c(this.x-this.size/2,this.y-this.size/2,d,e,this.size):new c(this.x,this.y,d,e,this.size)),"ON"==C.soundStatus&&C.enemyexplodeSound.play(),playerShip.crashed||(C.score++,C.levelScore++,gameUI.updateScore())),0!==this.fireRate&&(this.bulletTimer++,this.bulletTimer%this.bulletDivision==1&&(this.bulletTimer=1,bulletX="base"==this.type?this.x+.42*this.size-this.size/2:this.x+.42*this.size,bulletY="base"==this.type?this.y+this.size-this.size/2:this.y+this.size,bulletDirection=this.angleTo(playerShip),C.enemyBullets.push(new h(bulletX,bulletY,50,bulletDirection,1,20)))),"base"!=this.type&&(e-=utils.randomRange(-.05,.05))},this.draw=function(){if("base"==this.type?(C.contextEnemies.save(),C.contextEnemies.translate(this.lastX,this.lastY),C.contextEnemies.rotate(this.rotation),C.contextEnemies.clearRect(-this.size/2,-this.size/2,this.size,this.size),C.contextEnemies.restore(),this.dead||(this.rotation+=.01,C.contextEnemies.save(),C.contextEnemies.translate(this.x,this.y),C.contextEnemies.rotate(this.rotation),C.contextEnemies.drawImage(C.images[this.image],-this.size/2,-this.size/2,this.size,this.size),C.contextEnemies.restore())):(C.contextEnemies.clearRect(this.x-this.vx,this.y-this.vy,this.size,this.size),this.dead||C.contextEnemies.drawImage(C.images[this.image],this.x,this.y,this.size,this.size)),this.hit){this.hitTimer++;for(var a="base"==this.type?C.contextEnemies.getImageData(this.x-this.size/2,this.y-this.size/2,this.size,this.size):C.contextEnemies.getImageData(this.x,this.y,this.size,this.size),b=a.data,c=0;c<b.length;c+=4){{b[c],b[c+1],b[c+2]}b[c]=b[c+1]=b[c+2]=255}"base"==this.type?C.contextEnemies.putImageData(a,this.x-this.size/2,this.y-this.size/2):C.contextEnemies.putImageData(a,this.x,this.y),this.hitTimer>4&&(this.hit=!1,this.hitTimer=0)}}}function g(a,b,d,e,f,g){particle.call(this,a,b,d,e),this.hull=f,this.image=g,this.size=300*dtSize,this.hit=!1,this.hitTimer=0,this.dead=!1,this.deadTime=60,this.bulletTimer1=1,this.bulletTimer2=1,this.bulletDivision1=50,this.bulletDivision2=30,this.fireRate=0,this.context=C.contextEnemies,this.update=function(){this.bulletDirection=this.angleTo(playerShip),this.vx=Math.cos(e)*d*dt,this.vy=Math.sin(e)*d*dt,this.x+=this.vx,this.y+=this.vy,!w(playerShip,this)||this.dead||C.gameOver||(playerShip.hull-=this.hull,playerShip.hit=!0,this.hit=!0,this.hull-=playerShip.hull),this.hull<=0&&(this.dead=!0,C.explosions.push(new c(this.x,this.y,d,e,this.size)),"ON"==C.soundStatus&&C.bossexplodeSound.play(),playerShip.crashed||(C.score++,C.levelScore++)),this.bulletTimer1++,this.bulletTimer2++,this.bulletTimer1%this.bulletDivision1==1&&(this.bulletTimer1=1,C.enemyBullets.push(new h(this.x,this.y+.6*this.size,50,this.bulletDirection,1,20)),C.enemyBullets.push(new h(this.x+this.size,this.y+.6*this.size,50,this.bulletDirection,1,20))),this.bulletTimer2%this.bulletDivision2==1&&(this.bulletTimer2=1,bulletX=this.x+.48*this.size,bulletY=this.y+this.size,C.enemyBullets.push(new h(bulletX,bulletY,250,Math.PI/2,1.5,2)),C.enemyBullets.push(new h(bulletX,bulletY,250,Math.PI/2,1.5,2))),this.y>.1*C.height&&(d=0,this.x>0&&this.x<=C.width-this.size/4&&(this.x<playerShip.x?this.x+=1:this.x>playerShip.x&&(this.x-=1)))},this.draw=function(){if(C.contextEnemies.clearRect(this.x-this.vx,this.y-this.vy,this.size,this.size),this.dead||C.contextEnemies.drawImage(C.images[this.image],this.x,this.y,this.size,this.size),this.hit){this.hitTimer++;for(var a=C.contextEnemies.getImageData(this.x,this.y,this.size,this.size),b=a.data,c=0;c<b.length;c+=4){{b[c],b[c+1],b[c+2]}b[c]=b[c+1]=b[c+2]=255}C.contextEnemies.putImageData(a,this.x,this.y),this.hitTimer>4&&(this.hit=!1,this.hitTimer=0)}}}function h(a,b,c,d,e,f){particle.call(this,a,b,c,d),this.size=30*dtSize,this.power=e,this.image=f,this.dead=!1,this.deadTime=60,this.frameWidth=64,this.frameHeight=64,this.startFrame=0,this.endFrame=2,this.frameSpeed=5,this.animationSequence=[],this.currentFrame=0,this.counter=0,this.fpr=Math.floor(C.images[this.image].width/this.frameWidth),this.image=f,this.friction=1.02,this.dtSet=!1,this.update=function(){for(0===dt||this.dtSet||(this.vx=Math.cos(d)*c*dt,this.vy=Math.sin(d)*c*dt,this.dtSet=!0),this.vx*=this.friction,this.vy*=this.friction,this.x+=this.vx,this.y+=this.vy,this.FrameNum=this.startFrame;this.FrameNum<=this.endFrame;this.FrameNum++)this.animationSequence.push(this.FrameNum);this.counter==this.frameSpeed-1&&(this.currentFrame=(this.currentFrame+1)%this.animationSequence.length),this.counter=(this.counter+1)%this.frameSpeed,this.spriteRow=Math.floor(this.animationSequence[this.currentFrame]/this.fpr),this.spriteCol=Math.floor(this.animationSequence[this.currentFrame]%this.fpr),w(this,playerShip)&&!C.gameOver&&(playerShip.hull-=this.power,gameUI.updateEnergy(),playerShip.hit=!0,this.dead=!0)},this.draw=function(){this.dead||(C.contextPlayer.save(),C.contextPlayer.translate(this.x,this.y),C.contextPlayer.rotate(d-Math.PI/2),C.contextPlayer.drawImage(C.images[this.image],this.spriteCol*this.frameWidth,this.spriteRow*this.frameHeight,this.frameWidth,this.frameHeight,-this.size/2,-this.size/2,this.size,this.size),C.contextPlayer.restore())}}function j(a,b){particle.call(this,a,b),this.speed=250,this.direction=Math.PI/2,this.size=45*dtSize,this.dead=!1,this.drops=["health","laser","missile"];var c=Math.floor(Math.random()*this.drops.length);switch(this.type=this.drops[c],this.type){case"health":this.image=0;break;case"laser":this.image=2;break;case"missile":this.image=20}this.update=function(){if(this.vx=Math.cos(this.direction)*this.speed*dt,this.vy=Math.sin(this.direction)*this.speed*dt,this.x+=this.vx,this.y+=this.vy,w(playerShip,this)&&!this.dead&&!C.gameOver){switch(this.type){case"health":this.hull<=7.5?playerShip.hull+=2.5:playerShip.hull=10,gameUI.updateEnergy();break;case"laser":playerShip.laserLevel+=1;break;case"missile":playerShip.missileLevel+=1}this.dead=!0}},this.draw=function(){C.contextEnemies.clearRect(this.x-this.vx,this.y-this.vy,this.size,this.size),this.dead||C.contextEnemies.drawImage(C.images[this.image],this.x,this.y,this.size,this.size)}}function k(){this.width=C.width,this.height=.04*C.height,this.energyBarSize=.3*C.width,this.energyPointSize=.01*C.height,this.hangarShipSize=.03*C.height,this.level=C.level,C.contextText.fillStyle="#FFD455",C.contextText.font=15*dtSize+"px helvetica",this.updateLevel=function(){this.level=C.level,C.contextText.clearRect(.02*this.width,.3*this.height,.05*this.width,.35*this.height),C.contextText.fillText("S"+this.level,.02*this.width,.6*this.height)},this.updateScore=function(){this.score=C.score,C.contextText.clearRect(.1*this.width,.3*this.height,.12*this.width,.35*this.height),C.contextText.fillText("Score: "+this.score,.1*this.width,.6*this.height)},this.updateSound=function(){this.soundFx=C.sound?"ON":"OFF",navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)||(C.contextText.clearRect(.39*this.width,.3*this.height,.05*this.width,.35*this.height),C.contextText.fillText("Sound(F8): "+this.soundFx,.25*this.width,.6*this.height))},this.updateEnergy=function(){for(this.hull=playerShip.hull,C.contextText.clearRect(.555*this.width,.27*this.height,.205*this.width,.34*this.height),s=0;s<this.hull;s++)C.contextText.drawImage(C.images[26],.545*this.width+11*s,.15*this.height,this.energyPointSize,2.2*this.energyPointSize)},this.updateHangar=function(){for(this.hangar=playerShip.lives,C.contextText.clearRect(.83*this.width,.35*this.height,.13*this.width,.58*this.height),i=0;i<this.hangar;i++)C.contextText.drawImage(C.images[0],.82*this.width+.05*this.width*i,.3*this.height,this.hangarShipSize,this.hangarShipSize)},this.updateAll=function(){C.contextText.clearRect(0,0,this.width,1.5*this.height),C.contextText.drawImage(C.images[25],.5*this.width,.1*-this.height,this.energyBarSize,this.energyBarSize/4),this.updateLevel(),this.updateScore(),this.updateSound(),this.updateEnergy(),this.updateHangar()}}function l(){!C.keys[13]&&!L||!C.start||C.gameOver||C.gameWon||(C.paused=!1,C.start=!1,L=0,gameUI.updateAll()),C.keys[27]&&(C.lives=0,v()),C.keys[119]&&(C.sound=C.sound?!1:!0,C.keys[119]=!1,gameUI.updateSound()),!C.keys[80]||C.gameWon||C.gameOver||(C.paused=C.paused?!1:!0,C.keys[80]=!1),(C.keys[27]||(C.keys[13]||L)&&C.paused&&!C.start&&C.gameOver&&!C.gameWon||(C.keys[13]||L)&&C.paused&&!C.start&&C.level>=7)&&((C.lives<1||C.level>=7)&&(C.level=X_Level,C.score=0,playerShip.lives=X_Lives),v()),(C.keys[13]||L)&&!C.gameOver&&!C.start&&C.gameWon&&C.level<=6&&(C.downDivision=Math.floor(300*C.level),v()),C.gameWon&&C.level>1&&C.level<=6&&(y("Battle Won!","Helvetica",.08*C.height,"#FFD455","bold"),y(C.levelScore+" enemy ships destroyed","Helvetica",.06*C.height,"#FFD455","bold"),navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?y("Tap screen to continue","Helvetica",.04*C.height,"#FFD455","bold"):y("Press ENTER or LMB to continue","Helvetica",.04*C.height,"#FFD455","bold"),C.levelScore=0),C.gameWon&&C.level>=7&&(C.contextPlayer.font="bold "+.08*C.width+"px "+C.font,C.contextPlayer.fillStyle="#CC99FF",C.contextPlayer.fillText("Victory!",.35*C.width,.42*C.height),C.contextPlayer.font="bold "+.06*C.width+"px "+C.font,C.contextPlayer.fillText(C.score+" enemy ships destroyed",.17*C.width,.52*C.height),C.contextPlayer.font="bold "+.04*C.width+"px "+C.font,C.contextPlayer.fillStyle="white",navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?C.contextPlayer.fillText("Tap screen to restart",.3*C.width,.62*C.height):C.contextPlayer.fillText("Press Enter or LMB to restart",.24*C.width,.62*C.height),C.levelScore=0)}function m(){C.timer++,C.seconds=C.timer/60||0,playerShip.update(),C.contextPlayer.clearRect(0,0,C.width,C.height),playerShip.draw(),C.contextBackground.clearRect(0,0,C.width,C.height),level1Bg.length<1&&level1Bg.push(new b(150,21,0));for(var a in level1Bg)level1Bg[a].y>.02*-C.height&&level1Bg.length<2&&level1Bg.push(new b(150,21,1)),level1Bg[a].y>C.height&&level1Bg.splice(a,1),level1Bg[a].update(),level1Bg[a].draw();if(1==C.seconds&&C.waves.push(new I("top",.3*C.width,1,"pawn",4,300,1,0,!0)),3==C.seconds&&C.waves.push(new I("top",.3*C.width,1,"pawn",4,300,1,0,!0)),5==C.seconds&&C.enemies.push(new f(.7*C.width,.1*-C.height,80,Math.PI/2,10,"miniboss",24,2)),7==C.seconds&&C.enemies.push(new f(.3*C.width,.1*-C.height,155,Math.PI/2,10,"base",22,1)),11==C.seconds&&C.waves.push(new I("top",.3*C.width,1,"pawn",4,300,1,2,!0)),13==C.seconds&&C.enemies.push(new f(.3*C.width,.1*-C.height,155,Math.PI/2,10,"base",23,1)),18==C.seconds&&C.waves.push(new I("top",.3*C.width,1,"pawn",4,300,1,2,!0)),22==C.seconds&&C.waves.push(new I("top",.3*C.width,1,"pawn",4,300,1,2,!0)),25==C.seconds&&C.waves.push(new I("top",.3*C.width,1,"pawn",4,300,1,2,!0)),28==C.seconds&&C.enemies.push(new g(.3*C.width,.1*-C.height,150,Math.PI/2,100,27)),C.enemies.length>0)for(var c in C.enemies){for(var d in playerShip.bullets)w(C.enemies[c],playerShip.bullets[d])&&!C.enemies[c].dead&&(C.enemies[c].hit=!0,C.enemies[c].hull-=playerShip.bullets[d].power,playerShip.bullets[d].dead=!0,playerShip.bullets.splice(d,1));C.enemies[c].update(),C.enemies[c].draw(),(C.enemies[c].dead||C.enemies[c].y>C.height+C.enemies[c].size||C.enemies[c].x<.3*-C.width||C.enemies[c].x>1.3*C.width)&&(C.enemies[c].dead&&(C.contextEnemies.clearRect(C.enemies[c].x,C.enemies[c].y,C.enemies[c].size,C.enemies[c].size),lootchance=Math.random(),lootchance<.1&&C.loot.push(new j(C.enemies[c].x,C.enemies[c].y))),C.enemies.splice(c,1))}if(C.waves.length>0)for(var e in C.waves)C.waves[e].update(),C.waves[e].over&&C.waves.splice(e,1);if(C.loot.length>=1)for(var h in C.loot)C.loot[h].update(),C.loot[h].draw(),(C.loot[h].x>C.width+C.loot[h].size||C.loot[h].x<0-C.loot[h].size||C.loot[h].y>C.height+C.loot[h].size||C.loot[h].y<-30)&&C.loot.splice(h,1);if(C.enemyBullets.length>=1)for(var i in C.enemyBullets)C.enemyBullets[i].update(),C.enemyBullets[i].draw(),(C.enemyBullets[i].dead||C.enemyBullets[i].x>C.width+C.enemyBullets[i].size||C.enemyBullets[i].x<0-C.enemyBullets[i].size||C.enemyBullets[i].y>C.height+C.enemyBullets[i].size||C.enemyBullets[i].y<-30)&&C.enemyBullets.splice(i,1);if(C.explosions.length>0){for(var k in C.explosions)C.explosions[k].update(),C.explosions[k].draw();for(var l in C.explosions)19==C.explosions[l].currentFrame&&C.explosions.splice(l,1)}}function n(){J=document.getElementById("playerCanvas"),K=J.getContext("2d"),J.addEventListener("mousedown",q,!1),J.addEventListener("mouseup",o,!1),J.addEventListener("mousemove",t,!1),J.addEventListener("touchstart",r,!1),J.addEventListener("touchend",p,!1),J.addEventListener("touchcancel",p,!1),J.addEventListener("touchleave",p,!1),J.addEventListener("touchmove",u,!1)}function o(){L=0,t()}function p(){L=0}function q(){L=1,t()}function r(){L=1,u()}function t(a){a&&(a.preventDefault(),canvasX=a.pageX-J.offsetLeft,canvasY=a.pageY-J.offsetTop)}function u(a){a&&(a.preventDefault(),canvasX=a.targetTouches[0].pageX-J.offsetLeft,canvasY=a.targetTouches[0].pageY-J.offsetTop)}function v(){L=0,C.gameOver=!1,C.gameWon=!1,C.contextBackground.clearRect(1,1,C.width,C.height),C.contextPlayer.clearRect(1,1,C.width,C.height),C.contextEnemies.clearRect(1,1,C.width,C.height),C.contextText.clearRect(1,1,C.width,C.height),playerShip.reset(),gameUI.updateAll(),C.enemies=[],C.waves=[],C.enemyBullets=[],C.loot=[],C.timer=0,C.paused=!1}function w(a,b){return!(a.x>b.x+b.size||a.x+a.size<b.x||a.y>b.y+b.size||a.y+a.size<b.y)}function x(){C.gameOver=!0,C.lives--,C.score=C.score-C.levelScore,setTimeout(function(){C.paused=!0,L=0,C.gameOver&&C.paused&&C.lives<1&&(y("Game Over",1,"Helvetica",.06*C.width,"#FFD455","bold"),y(C.score+" enemy ships destroyed",2,"Helvetica",.05*C.width,"#FFD455","bold"),navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?y("Tap screen to restart",3,"Helvetica",.04*C.width,"white","bold"):y("Press ENTER or LMB to restart",3,"Helvetica",.04*C.width,"white","bold"),"ON"==C.soundStatus&&C.deathSound.play(),C.levelScore=0),C.gameOver&&C.paused&&C.lives>=1&&(y("Your ship has been destroyed!",1,"Helvetica",.06*C.width,"#FFD455","bold"),y(C.lives+" ships left",2,"Helvetica",.05*C.width,"#FFD455","bold"),navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?y("Tap screen to continue",3,"Helvetica",.04*C.width,"white","bold"):y("Press ENTER or LMB to continue",3,"Helvetica",.04*C.width,"white","bold"),C.levelScore=0)},1e3)}function y(a,b,c,d,e,f){var g=a,h=g.length,i=h*d/2,j=.1*C.height,k=.5*(C.width-i),l=C.height/3.5+j*b;C.contextPlayer.font=f+" "+d+"px "+c,C.contextPlayer.fillStyle=e,C.contextPlayer.fillText(g,k,l)}function z(){requestAnimFrame(z);var a=(new Date).getTime();dt=(a-(M||a))/1e3,M=a,l(),C.paused||m()}function A(a){C.requiredImages=a.length;for(var b in a){var c=new Image;c.src=a[b],C.images[b]=c,C.images[b].onload=function(){C.doneImages++}}}function B(){C.doneImages>=C.requiredImages?(C.contextBackground.clearRect(0,0,C.width,C.height),C.contextBackground.font="bold "+.11*C.width+"px "+C.font,C.contextBackground.fillStyle="purple",C.contextBackground.fillText(X_Title,.2*C.width,.4*C.height),C.contextBackground.font="bold "+.04*C.width+"px "+C.font,C.contextBackground.fillStyle="#FFD455",C.contextBackground.fillText(X_Subtitle,.1*C.width,.55*C.height),C.contextBackground.fillStyle="white",navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?C.contextBackground.fillText(X_mb_Start,.25*C.width,.65*C.height):C.contextBackground.fillText(X_dt_Start,.1*C.width,.7*C.height),z()):setTimeout(function(){B()},1)}window.addEventListener("load",function(){window.applicationCache.addEventListener("updateready",function(){window.applicationCache.status==window.applicationCache.UPDATEREADY&&confirm("A new version of InVaDeRs is available. Load it?")&&window.location.reload()},!1)},!1),window.addEventListener("load",n,!1),$.ajax({type:"GET",url:"game.xml",dataType:"xml",async:!1,success:function(a){$(a).find("data").each(function(){X_Sound=parseInt($(this).find("sound").text()),X_Level=parseInt($(this).find("level").text()),X_Lives=parseInt($(this).find("player-lives").text()),X_PlayerSpeed=parseInt($(this).find("player-speed").text()),X_EnemySpeed=parseInt($(this).find("enemy-speed").text()),X_GunSpeed=parseInt($(this).find("reload-time").text()),X_EnGunSpeed=parseInt($(this).find("enreload-time").text()),X_BulletSpeed=parseInt($(this).find("bullet-speed").text()),X_EnBulletSpeed=parseInt($(this).find("enbullet-speed").text()),X_Title=$(this).find("title").text(),X_Subtitle=$(this).find("subtitle").text(),X_dt_Start=$(this).find("dt-start").text(),X_mb_Start=$(this).find("mb-start").text()})},error:function(){alert("The XML File could not be processed correctly.")}});var C={};C.stars=[],C.score=0,C.levelScore=0,C.level=X_Level,C.lives=X_Lives,C.keys=[],C.playerBullets=[],C.enemyBullets=[],C.enemies=[],C.waves=[],C.loot=[],C.explosions=[],dt=0,C.start=!0,C.paused=!0,C.gameWon=!1,C.gameOver=!1,C.delayTimer=0,C.timer=0,C.sound=X_Sound,C.enemyexplodeSound=new Audio("_sounds/explosion.wav"),C.playerexplodeSound=new Audio("_sounds/blast.mp3"),C.shootSound=new Audio("_sounds/laser.wav"),C.deathSound=new Audio("_sounds/death.mp3"),C.winSound=new Audio("_sounds/victory.mp3"),C.images=[],C.doneImages=0,C.requiredImages=0,C.contextBackground=document.getElementById("backgroundCanvas").getContext("2d"),C.contextEnemies=document.getElementById("enemiesCanvas").getContext("2d"),C.contextPlayer=document.getElementById("playerCanvas").getContext("2d"),C.contextText=document.getElementById("textCanvas").getContext("2d");
var D=$("#backgroundCanvas"),E=$("#enemiesCanvas"),F=$("#playerCanvas"),G=$("#textCanvas"),H=(D.get(0).getContext("2d"),$(D).parent());$(window).resize(a),a(),b.prototype=Object.create(particle.prototype),b.prototype.constructor=b,level1Bg=[],c.prototype=Object.create(particle.prototype),c.prototype.constructor=c,d.prototype=Object.create(particle.prototype),d.prototype.constructor=d,playerShip=new d(10,15),e.prototype=Object.create(particle.prototype),e.prototype.constructor=e,f.prototype=Object.create(particle.prototype),f.prototype.constructor=f,g.prototype=Object.create(particle.prototype),g.prototype.constructor=g,h.prototype=Object.create(particle.prototype),h.prototype.constructor=h,j.prototype=Object.create(particle.prototype),j.prototype.constructor=j;var I=function(a,b,c,d,e,g,h,i){switch(this.side=a,this.spawnedShips=0,this.race=c,this.type=d,this.fleetSize=e,this.speed=g,this.hull=h,this.fireRate=i||0,this.spawnTimer=1,this.spawnDivision=15,this.side){case"top":this.x=b,this.y=.1*-C.height,this.direction=Math.PI/2;break;case"left":this.x=.2*-C.width,this.y=b,this.direction=0;break;case"right":this.x=1.2*C.width,this.y=b,this.direction=Math.PI}this.over=!1,this.update=function(){0===dt||this.spawnDivisionSet||(this.spawnDivision=Math.round(700*dt),this.spawnDivisionSet=!0),this.spawnTimer++,this.spawnedShips<=this.fleetSize&&this.spawnTimer%this.spawnDivision==1&&(this.spawnTimer=1,C.enemies.push(new f(this.x,this.y,this.speed,this.direction,this.hull,this.type,this.race,this.fireRate,!0)),this.spawnedShips++),this.spawnedShips==this.fleetSize&&(this.over=!0)}};gameUI=new k,$(document).keydown(function(a){C.keys[a.keyCode?a.keyCode:a.which]=!0}),$(document).keyup(function(a){delete C.keys[a.keyCode?a.keyCode:a.which]});var J,K;canvasX=playerShip.x,canvasY=playerShip.y;var L=0;moveX=canvasX,moveY=canvasY;var M;A(["_img/_dist/fighter/fighter.png","_img/_dist/enemies/sectoid.png","_img/_dist/laser.png","_img/_dist/explosion.png","_img/_dist/fighter/fighter_right1.png","_img/_dist/fighter/fighter_right2.png","_img/_dist/fighter/fighter_right3.png","_img/_dist/fighter/fighter_right4.png","_img/_dist/fighter/fighter_right5.png","_img/_dist/fighter/fighter_left1.png","_img/_dist/fighter/fighter_left2.png","_img/_dist/fighter/fighter_left3.png","_img/_dist/fighter/fighter_left4.png","_img/_dist/fighter/fighter_left5.png","_img/_dist/stars/star1.png","_img/_dist/stars/star2.png","_img/_dist/stars/star3.png","_img/_dist/stars/star4.png","_img/_dist/stars/star5.png","_img/_dist/stars/star6.png","_img/_dist/missile.png","_img/_dist/background/level_1.jpg","_img/_dist/enemies/_alienbase/alienbase1.png","_img/_dist/enemies/_alienbase/alienbase2.png","_img/_dist/enemies/_miniboss/floater.png","_img/_dist/ui/energyBar.png","_img/_dist/ui/energyPoint.png","_img/_dist/enemies/_bigboss/sectoidBoss.png"]),B()})}(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();