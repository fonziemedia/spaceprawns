var vector={_x:1,_y:0,create:function(a,b){var c=Object.create(this);return c.setX(a),c.setY(b),c},setX:function(a){this._x=a},getX:function(){return this._x},setY:function(a){this._y=a},getY:function(){return this._y},setAngle:function(a){var b=this.getLength();this._x=Math.cos(a)*b,this._y=Math.sin(a)*b},getAngle:function(){return Math.atan2(this._y,this._x)},setLength:function(a){var b=this.getAngle();this._x=Math.cos(b)*a,this._y=Math.sin(b)*a},getLength:function(){return Math.sqrt(this._x*this._x+this._y*this._y)},add:function(a){return vector.create(this._x+a.getX(),this._y+a.getY())},subtract:function(a){return vector.create(this._x-a.getX(),this._y-a.getY())},multiply:function(a){return vector.create(this._x*a,this._y*a)},divide:function(a){return vector.create(this._x/a,this._y/a)},addTo:function(a){this._x+=a.getX(),this._y+=a.getY()},subtractFrom:function(a){this._x-=a.getX(),this._y-=a.getY()},multiplyBy:function(a){this._x*=a,this._y*=a},divideBy:function(a){this._x/=a,this._y/=a}},utils={norm:function(a,b,c){return(a-b)/(c-b)},lerp:function(a,b,c){return(c-b)*a+b},map:function(a,b,c,d,e){return utils.lerp(utils.norm(a,b,c),d,e)},clamp:function(a,b,c){return Math.min(Math.max(a,Math.min(b,c)),Math.max(b,c))},distance:function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)},distanceXY:function(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(e*e+f*f)},circleCollision:function(a,b){return utils.distance(a,b)<=a.radius+b.radius},circlePointCollision:function(a,b,c){return utils.distanceXY(a,b,c.x,c.y)<c.radius},pointInRect:function(a,b,c){return utils.inRange(a,c.x,c.x+c.width)&&utils.inRange(b,c.y,c.y+c.height)},inRange:function(a,b,c){return a>=Math.min(b,c)&&a<=Math.max(b,c)},rangeIntersect:function(a,b,c,d){return Math.max(a,b)>=Math.min(c,d)&&Math.min(a,b)<=Math.max(c,d)},rectIntersect:function(a,b){return utils.rangeIntersect(a.x,a.x+a.width,b.x,b.x+b.width)&&utils.rangeIntersect(a.y,a.y+a.height,b.y,b.y+b.height)},degreesToRads:function(a){return a/180*Math.PI},radsToDegrees:function(a){return 180*a/Math.PI},randomRange:function(a,b){return a+Math.random()*(b-a)},randomInt:function(a,b){return Math.floor(a+Math.random()*(b-a+1))},roundToPlaces:function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},roundNearest:function(a,b){return Math.round(a/b)*b},quadraticBezier:function(a,b,c,d,e){return e=e||{},e.x=Math.pow(1-d,2)*a.x+2*(1-d)*d*b.x+d*d*c.x,e.y=Math.pow(1-d,2)*a.y+2*(1-d)*d*b.y+d*d*c.y,e},cubicBezier:function(a,b,c,d,e,f){return f=f||{},f.x=Math.pow(1-e,3)*a.x+3*Math.pow(1-e,2)*e*b.x+3*(1-e)*e*e*c.x+e*e*e*d.x,f.y=Math.pow(1-e,3)*a.y+3*Math.pow(1-e,2)*e*b.y+3*(1-e)*e*e*c.y+e*e*e*d.y,f},multicurve:function(a,b){var c,d,e,f;b.moveTo(a[0].x,a[0].y);for(var g=1;g<a.length-2;g+=1)c=a[g],d=a[g+1],e=(c.x+d.x)/2,f=(c.y+d.y)/2,b.quadraticCurveTo(c.x,c.y,e,f);c=a[a.length-2],d=a[a.length-1],b.quadraticCurveTo(c.x,c.y,d.x,d.y)}},particle=function(a,b,c,d,e){this.x=a,this.y=b,this.vx=Math.cos(d)*c*dt,this.vy=Math.sin(d)*c*dt,this.mass=1,this.radius=0,this.bounce=-1,this.friction=1,this.gravity=e||0,this.springs=[],this.gravitations=[],this.addGravitation=function(a){this.removeGravitation(a),this.gravitations.push(a)},this.removeGravitation=function(a){for(var b=0;b<this.gravitations.length;b+=1)if(a===this.gravitations[b])return void this.gravitations.splice(b,1)},this.addSpring=function(a,b,c){this.removeSpring(a),this.springs.push({point:a,k:b,length:c||0})},this.removeSpring=function(a){for(var b=0;b<this.springs.length;b+=1)if(a===this.springs[b].point)return void this.springs.splice(b,1)},this.getSpeed=function(){return Math.sqrt(this.vx*this.vx+this.vy*this.vy)},this.setSpeed=function(a){var b=this.getHeading();this.vx=Math.cos(b)*a,this.vy=Math.sin(b)*a},this.getHeading=function(){return Math.atan2(this.vy,this.vx)},this.setHeading=function(a){var b=this.getSpeed();this.vx=Math.cos(a)*b,this.vy=Math.sin(a)*b},this.accelerate=function(a,b){this.vx+=a,this.vy+=b},this.update=function(){0===dt&&(this.vx=Math.cos(d)*c*dt,this.vy=Math.sin(d)*c*dt),this.handleSprings(),this.handleGravitations(),this.vx*=this.friction,this.vy*=this.friction,this.vy+=this.gravity,this.x+=this.vx,this.y+=this.vy},this.handleGravitations=function(){for(var a=0;a<this.gravitations.length;a+=1)this.gravitateTo(this.gravitations[a])},this.handleSprings=function(){for(var a=0;a<this.springs.length;a+=1){var b=this.springs[a];this.springTo(b.point,b.k,b.length)}},this.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)},this.distanceTo=function(a){var b=a.x-this.x,c=a.y-this.y;return Math.sqrt(b*b+c*c)},this.gravitateTo=function(a){var b=a.x-this.x,c=a.y-this.y,d=b*b+c*c,e=Math.sqrt(d),f=a.mass/d,g=b/e*f,h=c/e*f;this.vx+=g,this.vy+=h},this.springTo=function(a,b,c){var d=a.x-this.x,e=a.y-this.y,f=Math.sqrt(d*d+e*e),g=(f-c||0)*b;this.vx+=d/f*g,this.vy+=e/f*g}};!function(){$(document).ready(function(){function a(){if(H.attr("height",$(L).height()),I.attr("height",$(L).height()),J.attr("height",$(L).height()),K.attr("height",$(L).height()),$(L).width()<1080)H.attr("width",$(L).width()),I.attr("width",$(L).width()),J.attr("width",$(L).width()),K.attr("width",$(L).width()),G.width=$(L).width();else{var a=9*$(L).height()/16;H.attr("width",a),I.attr("width",a),J.attr("width",a),K.attr("width",a),H.css({left:.5*($(L).width()-a)}),I.css({left:.5*($(L).width()-a)}),J.css({left:.5*($(L).width()-a)}),K.css({left:.5*($(L).width()-a)}),G.width=Math.round(a)}G.height=Math.round($(L).height()),dtSize=.001*G.height,G.contextText.font="bold "+.08*G.width+"px "+G.font,G.contextText.fillStyle="white",G.contextText.fillText("Loading...",.3*G.width,.47*G.height)}function b(a,b,c,d,e,f,g,h){this.image=a,this.imageSize=b,this.frameWidth=c,this.frameHeight=d,this.startFrame=e,this.endFrame=f,this.frameSpeed=g,this.ctx=h,this.animationSequence=[],this.currentFrame=0,this.counter=0,this.fpr=Math.floor(G.images[this.image].width/this.frameWidth),this.draw=function(a,b){for(this.FrameNum=this.startFrame;this.FrameNum<=this.endFrame;this.FrameNum++)this.animationSequence.push(this.FrameNum);this.counter==this.frameSpeed-1&&(this.currentFrame=(this.currentFrame+1)%this.animationSequence.length),this.counter=(this.counter+1)%this.frameSpeed,this.spriteRow=Math.floor(this.animationSequence[this.currentFrame]/this.fpr),this.spriteCol=Math.floor(this.animationSequence[this.currentFrame]%this.fpr),this.ctx.drawImage(G.images[this.image],this.spriteCol*this.frameWidth,this.spriteRow*this.frameHeight,this.frameWidth,this.frameHeight,a,b,this.imageSize,this.imageSize)}}function c(a){this.speed=Math.round(180*dt),this.section=a,this.width=G.width,this.height=Math.round(G.width*(16/9)*4),this.x=0,this.y=0===this.section?-Math.round(this.height-G.height):-this.height,this.image="level"+G.level+".jpg",this.limits=.02*-G.height,this.update=function(){this.y+=this.speed,G.contextBackground.drawImage(G.images[this.image],this.x,this.y,this.width,this.height)},this.load=function(){G.background.length<1&&G.background.push(new c(0));for(var a in G.background)G.background[a].y>this.limits&&G.background.length<2&&G.background.push(new c(1)),G.background[a].y>G.height&&G.background.splice(a,1),G.background[a].update()}}function d(a,c,d,e,f){particle.call(this,a,c,d,e),this.x=Math.round(a-.2*f),this.y=Math.round(c-.2*f),this.speed=d,this.size=Math.round(1.5*f),this.hitTimer=0,this.dead=!1,this.deadTime=60,this.image="explosion.png",this.ctx=G.contextPlayer,this.sprite=new b(this.image,this.size,96,96,0,19,2,this.ctx),this.update=function(){this.vx=Math.cos(e)*this.speed*dt,this.vy=Math.sin(e)*this.speed*dt,this.x+=this.vx,this.y+=this.vy},this.draw=function(){this.sprite.draw(this.x,this.y)}}function e(a,b){particle.call(this),this.x=Math.round(.46*G.width),this.y=Math.round(.9*G.height),this.speed=0,this.maxSpeed=400,this.direction=-Math.PI/2,this.size=Math.round(100*dtSize),this.hull=a,this.bulletspeed=Math.round(X_BulletSpeed*G.height/1e3),this.image="fighter.png",this.rendered=!1,this.hit=!1,this.hitTimer=0,this.imune=!1,this.imuneTimer=0,this.dead=!1,this.deadTimer=0,this.bullets=[],this.bulletTimer=1,this.bulletDivision=b,this.laserLevel=1,this.missileLevel=0,this.lives=X_Lives,this.ctx=G.contextPlayer,this.incline=[Math.round(.004*G.width),Math.round(.008*G.width),Math.round(.01*G.width),Math.round(.012*G.width)],this.steering=Math.round(.08*G.width),this.limitX1=Math.round(.25*this.size),this.limitX2=Math.round(G.width-.25*this.size),this.limitY1=this.size,this.limitY2=Math.round(G.height-.16*this.size),this.canVibrate="vibrate"in navigator||"mozVibrate"in navigator,!this.canVibrate||"vibrate"in navigator||(navigator.vibrate=navigator.mozVibrate),this.update=function(){if(this.playerImage=G.images[this.image],!Q||G.levelComplete||G.paused||G.gameOver||G.gameWon?Q||G.gameOver||(this.image="fighter.png",this.rendered=!1):O>this.limitX1&&O<=this.limitX2&&P>this.limitY1&&P<=this.limitY2&&(moveRight1=O>R&&O<=R+this.incline[0]?!0:!1,moveRight2=O>R+this.incline[0]&&O<=R+this.incline[1]?!0:!1,moveRight3=O>R+this.incline[1]&&O<=R+this.incline[2]?!0:!1,moveRight4=O>R+this.incline[2]&&O<=R+this.incline[3]?!0:!1,moveRight5=O>R+this.incline[3]?!0:!1,moveLeft1=R>O&&O>=R-this.incline[0]?!0:!1,moveLeft2=O<R-this.incline[0]&&O>=R-this.incline[1]?!0:!1,moveLeft3=O<R-this.incline[1]&&O>=R-this.incline[2]?!0:!1,moveLeft4=O<R-this.incline[2]&&O>=R-this.incline[3]?!0:!1,moveLeft5=O<R-this.incline[3]?!0:!1,(O!=R||P!=S)&&(distX=R-O,distY=S-P,distX<this.steering&&distX>-this.steering&&(this.speed=this.maxSpeed,this.x-=distX),distX>=this.steering&&(this.speed=this.maxSpeed,this.x-=this.speed*dt),distX<=-this.steering&&(this.speed=this.maxSpeed,this.x+=this.speed*dt),distY<this.steering&&distY>-this.steering&&(this.speed=this.maxSpeed,this.y-=distY),distY>=this.steering&&(this.speed=this.maxSpeed,this.y-=this.speed*dt),distY<=-this.steering&&(this.speed=this.maxSpeed,this.y+=this.speed*dt)),this.image=moveRight1?"fighter_right1.png":moveRight2?"fighter_right2.png":moveRight3?"fighter_right3.png":moveRight4?"fighter_right4.png":moveRight5?"fighter_right5.png":moveLeft1?"fighter_left1.png":moveLeft2?"fighter_left2.png":moveLeft3?"fighter_left3.png":moveLeft4?"fighter_left4.png":moveLeft5?"fighter_left5.png":"fighter.png",this.rendered=!1,R=Math.round(this.x+.5*this.size),S=Math.round(G.isMobile?this.y+1.7*this.size:this.y+this.size)),(G.keys[37]||G.keys[65]&&!G.gameOver&&!G.gameWon)&&this.x>0&&(this.speed=this.maxSpeed,this.direction=Math.PI,this.image="fighter_left5.png",this.rendered=!1,this.x-=Math.round(this.speed*dt)),(G.keys[39]||G.keys[68]&&!G.gameOver&&!G.gameWon)&&this.x<=G.width-this.size&&(this.speed=this.maxSpeed,this.direction=0,this.image="fighter_right5.png",this.rendered=!1,this.x+=Math.round(this.speed*dt)),(G.keys[38]||G.keys[87]&&!G.gameOver&&!G.gameWon||G.levelComplete)&&(this.y>0||G.levelComplete)&&(this.speed=this.maxSpeed,this.direction=-Math.PI/2,this.rendered=!1,this.y-=Math.round(this.speed*dt)),G.keys[40]||G.keys[83]&&!G.gameOver&&!G.gameWon?this.y<=G.height-this.size&&(this.speed=this.maxSpeed,this.direction=Math.PI/2,this.rendered=!1,this.y+=Math.round(this.speed*dt)):this.speed=0,this.midLaserX=Math.round(this.x+.5*this.size),this.leftlaserX=Math.round(this.x+.25*this.size),this.rightlaserX=Math.round(this.x+.75*this.size),this.LaserY=Math.round(this.y-.2*this.size),this.midMissileX=Math.round(this.x+.5*this.size),this.leftMissileX=this.x,this.rightMissileX=this.x+this.size,this.missileY=this.y+this.size,!G.keys[32]&&!Q||this.dead||G.gameOver)this.bulletTimer=1;else if(this.bulletTimer++,this.bulletTimer%this.bulletDivision===0){switch(this.laserLevel){case 1:G.playerBullets.push(new f(this.midLaserX,this.LaserY,600,-Math.PI/2,45,1,1,"laser.png",48,11)),G.sound&&G.sounds.push(new Audio("_sounds/_sfx/laser.wav"));break;case 2:G.playerBullets.push(new f(this.leftlaserX,this.LaserY,600,-Math.PI/2,45,1,1,"laser.png",48,11)),G.playerBullets.push(new f(this.rightlaserX,this.LaserY,600,-Math.PI/2,45,1,1,"laser.png",48,11)),G.sound&&G.sounds.push(new Audio("_sounds/_sfx/laser.wav"));break;default:G.playerBullets.push(new f(this.leftlaserX,this.LaserY,600,-Math.PI/2,45,1,1,"laser.png",48,11)),G.playerBullets.push(new f(this.midLaserX,this.LaserY,600,-Math.PI/2,45,1,1,"laser.png",48,11)),G.playerBullets.push(new f(this.rightlaserX,this.LaserY,600,-Math.PI/2,45,1,1,"laser.png",48,11)),G.sound&&G.sounds.push(new Audio("_sounds/_sfx/laser.wav"))}switch(this.missileLevel){case 0:break;case 1:G.playerBullets.push(new f(this.midMissileX,this.missileY,100,-Math.PI/2,45,2,1.03,"missile.png",64,2));break;case 2:G.playerBullets.push(new f(this.leftMissileX,this.missileY,100,-Math.PI/2,45,2,1.03,"missile.png",64,2)),G.playerBullets.push(new f(this.rightMissileX,this.missileY,100,-Math.PI/2,45,2,1.03,"missile.png",64,2));break;default:G.playerBullets.push(new f(this.leftMissileX,this.missileY,100,-Math.PI/2,45,2,1.03,"missile.png",64,2)),G.playerBullets.push(new f(this.rightMissileX,this.missileY,100,-Math.PI/2,45,2,1.03,"missile.png",64,2)),G.playerBullets.push(new f(this.midMissileX,this.missileY,100,-Math.PI/2,45,2,1.03,"missile.png",64,2))}}this.hull<=0&&!this.dead&&(this.dead=!0,this.lives-=1,G.explosions.push(new d(this.x,this.y,this.speed,this.direction,this.size)),G.sound&&G.sounds.push(new Audio("_sounds/blast.mp3")),gameUI.updateHangar()),this.dead&&this.deadTimer<=100&&G.lives>0&&(this.deadTimer++,this.deadTimer>100&&this.lives>0?(Q=0,this.hull=a,this.dead=!1,this.x=Math.round(.46*G.width),this.y=Math.round(.9*G.height),this.image="fighter.png",this.rendered=!1,this.hit=!1,this.hitTimer=0,this.friction=0,this.laserLevel=1,this.missileLevel=0,gameUI.updateEnergy(),this.deadTimer=0,this.imune=!0,this.imuneTimer=0):this.deadTimer>100&&0===this.lives?(Q=0,G.keys[13]=!1,this.deadTimer=0,G.gameOver=!0):(this.x=Math.round(.5*G.width),this.y=Math.round(1.5*G.height))),this.imune&&(this.imuneTimer++,this.imuneTimer>250&&(this.imune=!1,this.imuneTimer=0))},this.draw=function(){this.dead||(!this.imune||G.faded||G.starting||G.levelComplete||(this.ctx.globalAlpha=.8,(this.imuneTimer>=0&&this.imuneTimer<15||this.imuneTimer>=20&&this.imuneTimer<35||this.imuneTimer>=40&&this.imuneTimer<55||this.imuneTimer>=70&&this.imuneTimer<75||this.imuneTimer>=90&&this.imuneTimer<95||this.imuneTimer>=110&&this.imuneTimer<115||this.imuneTimer>=130&&this.imuneTimer<135||this.imuneTimer>=150&&this.imuneTimer<155||this.imuneTimer>=160&&this.imuneTimer<175||this.imuneTimer>180)&&this.ctx.drawImage(this.playerImage,this.x,this.y,this.size,this.size)),this.imune||(this.ctx.globalAlpha<1&&!G.faded&&!G.levelComplete&&(this.ctx.globalAlpha+=.1),this.ctx.drawImage(this.playerImage,this.x,this.y,this.size,this.size)),this.hit&&!this.imune&&(this.canVibrate&&navigator.vibrate(30),this.hit=!1))},this.load=function(){this.update(),this.draw()},this.reset=function(){this.dead=!1,this.x=Math.round(.46*G.width),this.y=Math.round(.9*G.height),this.image="fighter.png",this.hull=a,this.rendered=!1,this.hit=!1,this.hitTimer=0,this.dead=!1,G.gameOver=!1,this.friction=0,this.bullets=[],this.laserLevel=1,this.missileLevel=0,this.lives=X_Lives}}function f(a,c,d,e,f,g,h,i,j,k){particle.call(this,a,c,d,e),this.size=Math.round(f*dtSize),this.spriteX=-Math.round(.5*this.size),this.spriteY=-Math.round(.5*this.size),this.power=g,this.image=i,this.dead=!1,this.deadTime=60,this.friction=h,this.dtSet=!1,this.ctx=G.contextEnemies,this.sprite=new b(this.image,this.size,j,j,0,k,4,this.ctx),this.update=function(){0===dt||this.dtSet||(this.vx=Math.cos(e)*d*dt,this.vy=Math.sin(e)*d*dt,this.dtSet=!0),this.vx*=this.friction,this.vy*=this.friction,this.x+=this.vx,this.y+=this.vy},this.draw=function(){this.dead||(this.ctx.save(),this.ctx.translate(this.x,this.y),this.ctx.rotate(e-Math.PI/2),this.sprite.draw(this.spriteX,this.spriteY),this.ctx.restore())}}function g(a,b,c,e,f,g,h,i,k){switch(particle.call(this,a,b,c,e),this.type=g,this.type){case"pawn":this.size=Math.round(65*dtSize);break;case"miniboss":this.size=Math.round(120*dtSize);break;case"base":this.size=Math.round(170*dtSize),this.rotation=0}this.spritePos=Math.round(.5*this.size),this.hull=f,this.image=G.images[h],this.hit=!1,this.hitTimer=0,this.dead=!1,this.bulletTimer=1,this.sheep=k||!1,this.fireRate=60*i,this.bulletDivision=this.sheep?2*this.fireRate-Math.floor(Math.random()*this.fireRate)||99999:this.bulletDivision=this.fireRate||99999,this.ctx=G.contextEnemies,this.inCanvas=!1,this.speed=c,this.direction=e,this.collided=!1,this.update=function(){this.vx=Math.cos(this.direction)*this.speed*dt,this.vy=Math.sin(this.direction)*this.speed*dt,this.x+=this.vx,this.y+=this.vy,this.spriteX=this.x+this.spritePos,this.spriteY=this.y+this.spritePos,this.hit&&this.hull>0&&(G.sound&&G.sounds.push(new Audio("_sounds/_sfx/hit.mp3")),this.hit=!1),this.hull<=0&&(this.dead=!0,G.explosions.push(new d(this.x,this.y,this.speed,this.direction,this.size)),G.sound&&G.sounds.push(new Audio("_sounds/explosion.mp3")),playerShip.crashed||(G.score++,G.levelScore++,gameUI.updateScore())),0!==this.fireRate&&(this.bulletTimer++,this.bulletTimer%this.bulletDivision==1&&(this.bulletTimer=1,bulletX=Math.round(this.x+.42*this.size),bulletY=Math.round(this.y+this.size),bulletDirection=this.angleTo(playerShip),G.enemyBullets.push(new j(bulletX,bulletY,50,bulletDirection,1,"missile.png")))),"base"!=this.type&&(this.direction-=utils.randomRange(-.05,.05))},this.draw=function(){"base"==this.type?this.dead||(this.rotation+=.01,this.ctx.save(),this.ctx.translate(this.spriteX,this.spriteY),this.ctx.rotate(this.rotation),this.ctx.drawImage(this.image,-this.spritePos,-this.spritePos,this.size,this.size),this.ctx.restore()):this.dead||this.ctx.drawImage(this.image,this.x,this.y,this.size,this.size)}}function h(a,b,c,e,f,g){particle.call(this,a,b,c,e),this.hull=f,this.image=G.images[g],this.size=Math.round(200*dtSize),this.hit=!1,this.hitTimer=0,this.dead=!1,this.deadTimer=0,this.bulletTimer1=1,this.bulletTimer2=1,this.bulletDivision1=50,this.bulletDivision2=30,this.fireRate=0,this.yStop=Math.round(.1*G.height),this.xBondary=Math.round(G.width-this.size/4),this.context=G.contextEnemies,this.update=function(){this.bulletDirection=this.angleTo(playerShip),this.vx=Math.cos(e)*c*dt,this.vy=Math.sin(e)*c*dt,this.x+=this.vx,this.y+=this.vy,this.hit&&this.hull>0&&(G.sound&&G.sounds.push(new Audio("_sounds/_sfx/hit.mp3")),this.hit=!1),!B(playerShip,this)||this.dead||G.gameOver||(playerShip.hull-=this.hull,playerShip.hit=!0,this.hit=!0,this.hull-=playerShip.hull),this.hull<=0&&(G.explosions.push(new d(this.x,this.y,c,e,this.size)),G.sound&&G.sounds.push(new Audio("_sounds/blast.mp3")),G.music&&G.songs.push(new Audio("_sounds/victory.mp3")),playerShip.crashed||(G.score++,G.levelScore++,G.bossDead=!0,this.dead=!0)),this.bulletTimer1++,this.bulletTimer2++,this.bulletTimer1%this.bulletDivision1==1&&(this.bulletTimer1=1,mBulletX1=Math.round(this.x),mBulletX2=Math.round(this.x+this.size),mBulletY=Math.round(this.y+.6*this.size),G.enemyBullets.push(new j(mBulletX1,mBulletY,50,this.bulletDirection,1,"missile.png")),G.enemyBullets.push(new j(mBulletX2,mBulletY,50,this.bulletDirection,1,"missile.png"))),this.bulletTimer2%this.bulletDivision2==1&&(this.bulletTimer2=1,lBulletX=Math.round(this.x+.48*this.size),lBulletY=Math.round(this.y+this.size),G.enemyBullets.push(new j(lBulletX,lBulletY,250,Math.PI/2,1.5,"laser.png")),G.enemyBullets.push(new j(lBulletX,lBulletY,250,Math.PI/2,1.5,"laser.png"))),this.y>this.yStop&&(c=0,this.x>0&&this.x<=this.xBondary&&(this.x<playerShip.x&&this.x<=this.xBondary-1?this.x+=1:this.x>playerShip.x&&this.x>1&&(this.x-=1)))},this.draw=function(){this.dead||G.contextEnemies.drawImage(this.image,this.x,this.y,this.size,this.size)}}function j(a,c,d,e,f,g){particle.call(this,a,c,d,e),this.size=Math.round(30*dtSize),this.spriteX=-Math.round(.5*this.size),this.spriteY=-Math.round(.5*this.size),this.power=f,this.image=g,this.dead=!1,this.deadTime=60,this.friction=1.02,this.dtSet=!1,this.ctx=G.contextEnemies,this.sprite=new b(this.image,this.size,64,64,0,2,5,this.ctx),this.update=function(){0===dt||this.dtSet||(this.vx=Math.cos(e)*d*dt,this.vy=Math.sin(e)*d*dt,this.dtSet=!0),this.vx*=this.friction,this.vy*=this.friction,this.x+=this.vx,this.y+=this.vy},this.draw=function(){this.dead||(this.ctx.save(),this.ctx.translate(this.x,this.y),this.ctx.rotate(e-Math.PI/2),this.sprite.draw(this.spriteX,this.spriteY),this.ctx.restore())}}function k(a,b){particle.call(this,a,b),this.speed=250,this.direction=Math.PI/2,this.size=Math.round(45*dtSize),this.dead=!1,this.drops=["health","laser","missile"];var c=Math.floor(Math.random()*this.drops.length);switch(this.type=this.drops[c],this.type){case"health":this.image="fighter.png";break;case"laser":this.image="laser.png";break;case"missile":this.image="missile.png"}this.context=G.contextPlayer,this.update=function(){if(this.vx=Math.cos(this.direction)*this.speed*dt,this.vy=Math.sin(this.direction)*this.speed*dt,this.x+=this.vx,this.y+=this.vy,B(this,playerShip)&&!this.dead&&!G.gameOver){switch(this.type){case"health":this.hull<=7.5?playerShip.hull+=2.5:playerShip.hull=10,gameUI.updateEnergy();break;case"laser":playerShip.laserLevel+=1;break;case"missile":playerShip.missileLevel+=1}G.sound&&G.sounds.push(new Audio("_sounds/_sfx/loot_powerUp.mp3")),this.dead=!0}},this.draw=function(){this.dead||G.contextPlayer.drawImage(G.images[this.image],this.x,this.y,this.size,this.size)}}function l(){this.width=G.width,this.height=.04*G.height,this.enContainerWidth=.3*G.width,this.enContainerHeight=.04*G.height,this.enBarHeight=.019*G.height,this.enBarVol=.2*G.width,this.hangarShipSize=.03*G.height,this.level=G.level,this.hangarImg="fighter.png",this.enPointImg="energypoint.png",this.enContainerImg="energybar.png",this.scoreX=Math.round(.1*this.width),this.scoreY=Math.round(.6*this.height),this.energyX=Math.round(.55*this.width),this.energyY=Math.round(.18*this.height),this.updateLevel=function(){this.level=G.level,G.contextText.fillStyle="#FFD455",G.contextText.font=15*dtSize+"px helvetica",G.contextText.clearRect(.02*this.width,.3*this.height,.05*this.width,.35*this.height),G.contextText.fillText("S"+this.level,.02*this.width,.6*this.height)},this.updateScore=function(){this.score=G.score,G.contextText.fillStyle="#FFD455",G.contextText.font=15*dtSize+"px helvetica",G.contextText.clearRect(this.scoreX,.3*this.height,.14*this.width,.35*this.height),G.contextText.fillText("Score: "+this.score,this.scoreX,this.scoreY)},this.updateSound=function(){this.soundFx=G.sound?"ON":"OFF",G.isMobile||(G.contextText.fillStyle="#FFD455",G.contextText.font=15*dtSize+"px helvetica",G.contextText.clearRect(.25*this.width,.3*this.height,.2*this.width,.35*this.height),G.contextText.fillText("Sound(F8): "+this.soundFx,.25*this.width,.6*this.height))},this.updateEnergy=function(){this.hull=playerShip.hull>0?playerShip.hull*G.width*.02:0,G.contextText.clearRect(.55*this.width,.2*this.height,this.enBarVol,this.enBarHeight),G.contextText.drawImage(G.images[this.enPointImg],this.energyX,this.energyY,this.hull,this.enBarHeight)},this.updateHangar=function(){for(this.hangar=playerShip.lives,G.contextText.clearRect(.83*this.width,.2*this.height,3*this.hangarShipSize,this.hangarShipSize),i=0;i<this.hangar;i++)G.contextText.drawImage(G.images[this.hangarImg],.82*this.width+.05*this.width*i,.2*this.height,this.hangarShipSize,this.hangarShipSize)},this.updateAll=function(){G.contextText.clearRect(0,0,this.width,1.5*this.height),G.contextText.drawImage(G.images[this.enContainerImg],.5*this.width,.1*-this.height,this.enContainerWidth,this.enContainerHeight),this.updateLevel(),this.updateScore(),this.updateSound(),this.updateEnergy(),this.updateHangar()}}function m(){this.backgroundAlpha=0,this.enemiesAlpha=0,this.playerAlpha=0,this.textAlpha=0,this.alphaDelta=.01,this.on=function(a){switch(a=a){case"all":G.contextText.globalAlpha=1,G.contextBackground.globalAlpha=1,G.contextEnemies.globalAlpha=1,G.contextPlayer.globalAlpha=1,G.textFaded=!1,G.backgroundFaded=!1,G.enemiesFaded=!1,G.playerFaded=!1,G.faded=!1;break;case"text":G.contextText.globalAlpha=1,G.textFaded=!1;break;case"background":G.contextBackground.globalAlpha=1,G.backgroundFaded=!1;break;case"enemies":G.contextEnemies.globalAlpha=1,G.enemiesFaded=!1;break;case"player":G.contextPlayer.globalAlpha=1,G.playerFaded=!1}},this.off=function(a){switch(a=a){case"all":G.contextText.globalAlpha=0,G.contextBackground.globalAlpha=0,G.contextEnemies.globalAlpha=0,G.contextPlayer.globalAlpha=0,G.textFaded=!0,G.backgroundFaded=!0,G.enemiesFaded=!0,G.playerFaded=!0,G.faded=!0;break;case"text":G.contextText.globalAlpha=0,G.textFaded=!0;break;case"background":G.contextBackground.globalAlpha=0,G.backgroundFaded=!0;break;case"enemies":G.contextEnemies.globalAlpha=0,G.enemiesFaded=!0;break;case"player":G.contextPlayer.globalAlpha=0,G.playerFaded=!0}},this.fadeIn=function(a){switch(a=a){case"all":this.backgroundAlpha<1||this.enemiesAlpha<1||this.playerAlpha<1||this.textAlpha<1?(this.backgroundAlpha+=this.alphaDelta,this.enemiesAlpha+=this.alphaDelta,this.playerAlpha+=this.alphaDelta,this.textAlpha+=this.alphaDelta):this.backgroundAlpha>=1&&this.enemiesAlpha>=1&&this.playerAlpha>=1&&this.textAlpha>=1&&(G.contextBackground.globalAlpha=1,G.contextEnemies.globalAlpha=1,G.contextPlayer.globalAlpha=1,G.contextText.globalAlpha=1,G.backgroundFaded=!1,G.enemiesFaded=!1,G.playerFaded=!1,G.textFaded=!1,G.faded=!1),G.contextBackground.globalAlpha=this.backgroundAlpha,G.contextEnemies.globalAlpha=this.enemiesAlpha,G.contextPlayer.globalAlpha=this.playerAlpha,G.contextText.globalAlpha=this.textAlpha;break;case"text":this.textAlpha<1?this.textAlpha+=this.alphaDelta:this.textAlpha>=1&&(G.contextText.globalAlpha=1,G.textFaded=!1),G.contextText.globalAlpha=this.textAlpha;break;case"background":this.backgroundAlpha<1?this.backgroundAlpha+=this.alphaDelta:this.backgroundAlpha>=1&&(G.contextBackground.globalAlpha=1,G.backgroundFaded=!1),G.contextBackground.globalAlpha=this.backgroundAlpha;break;case"enemies":this.enemiesAlpha<1?this.enemiesAlpha+=this.alphaDelta:G.enemiesApha>=1&&(G.contextEnemies.globalAlpha=1,G.enemiesFaded=!1),G.contextEnemies.globalAlpha=this.enemiesAlpha;break;case"player":this.playerAlpha<1?this.playerAlpha+=this.alphaDelta:this.playerAlpha>=1&&(G.contextPlayer.globalAlpha=1,G.playerFaded=!1),G.contextPlayer.globalAlpha=this.playerAlpha}},this.fadeOut=function(a){switch(a=a){case"all":this.backgroundAlpha>0||this.enemiesAlpha>0||this.playerAlpha>0||this.textAlpha>0?(this.backgroundAlpha-=this.alphaDelta,this.enemiesAlpha-=this.alphaDelta,this.playerAlpha-=this.alphaDelta,this.textAlpha-=this.alphaDelta):this.backgroundAlpha<=0&&this.enemiesAlpha<=0&&this.playerAlpha<=0&&this.textAlpha<=0&&(G.contextBackground.globalAlpha=0,G.contextEnemies.globalAlpha=0,G.contextPlayer.globalAlpha=0,G.contextText.globalAlpha=0,G.backgroundFaded=!0,G.enemiesFaded=!0,G.playerFaded=!0,G.textFaded=!0,G.faded=!0),G.contextBackground.globalAlpha=this.backgroundAlpha,G.contextEnemies.globalAlpha=this.enemiesAlpha,G.contextPlayer.globalAlpha=this.playerAlpha,G.contextText.globalAlpha=this.textAlpha;break;case"text":this.textAlpha>0?this.textAlpha-=this.alphaDelta:this.textAlpha<=0&&(G.contextText.globalAlpha=0,G.textFaded=!0),G.contextText.globalAlpha=this.textAlpha;break;case"background":this.backgroundAlpha>0?this.backgroundAlpha-=this.alphaDelta:this.backgroundAlpha<=0&&(G.contextBackground.globalAlpha=0,G.backgroundFaded=!0),G.contextBackground.globalAlpha=this.backgroundAlpha;break;case"enemies":this.enemiesAlpha>0?this.enemiesAlpha-=this.alphaDelta:G.enemiesApha<=0&&(G.contextEnemies.globalAlpha=0,G.enemiesFaded=!0),G.contextEnemies.globalAlpha=this.enemiesAlpha;break;case"player":this.playerAlpha>0?this.playerAlpha-=this.alphaDelta:this.playerAlpha<=0&&(G.contextPlayer.globalAlpha=0,G.playerFaded=!0),G.contextPlayer.globalAlpha=this.playerAlpha}}}function n(){this.font="Helvetica",this.fontWeight="bold",this.fontColor0="purple",this.fontColor1="#FFC619",this.fontColor2="#FFFFFF",this.introFontSize0=Math.round(.09*G.width),this.introFontSize1=Math.round(.07*G.width),this.introFontSize2=Math.round(.06*G.width),this.fontSize0=Math.round(.06*G.width),this.fontSize1=Math.round(.05*G.width),this.fontSize2=Math.round(.04*G.width),this.levelBriefing=["Outside the galaxy","The outer space","AlphaPI 2034"],this.introBackground="intro_bg.jpg",this.gameIntro=function(){G.contextText.clearRect(0,0,G.width,G.height),G.contextBackground.drawImage(G.images[this.introBackground],0,0,G.width,G.height),C("Space Prawns 2039",1,this.font,this.introFontSize0,this.fontColor0,this.fontWeight),C("We invited, they came...",2,this.font,this.introFontSize1,this.fontColor1,this.fontWeight),G.isMobile?C("Tap screen to start",3,this.font,this.introFontSize2,this.fontColor2,this.fontWeight):C("Press ENTER or LMB to start",3,this.font,this.introFontSize2,this.fontColor2,this.fontWeight)},this.lvlIntro=function(){G.contextText.clearRect(0,0,G.width,G.height),C("Stage "+G.level,1,this.font,this.fontSize0,this.fontColor1,this.fontWeight),C(this.levelBriefing[G.level-1],2,this.font,this.fontSize1,this.fontColor1,this.fontWeight),G.isMobile?C("Tap screen to continue",3,this.font,this.fontSize2,this.fontColor2,this.fontWeight):C("Press ENTER or LMB to continue",3,this.font,this.fontSize2,this.fontColor2,this.fontWeight)},this.lvlComplete=function(){G.contextText.clearRect(0,0,G.width,G.height),C("Stage Complete!",1,this.font,this.fontSize0,this.fontColor1,this.fontWeight),C(G.score+" enemy ships destroyed",2,this.font,this.fontSize1,this.fontColor1,this.fontWeight),G.isMobile?C("Tap screen to continue",3,this.font,this.fontSize2,this.fontColor2,this.fontWeight):C("Press ENTER or LMB to continue",3,this.font,this.fontSize2,this.fontColor2,this.fontWeight)},this.gameOver=function(){G.contextText.clearRect(0,0,G.width,G.height),C("Game Over",1,this.font,this.fontSize0,this.fontColor1,this.fontWeight),C(G.score+" enemy ships destroyed",2,this.font,this.fontSize1,this.fontColor1,this.fontWeight),G.isMobile?C("Tap screen to restart",3,this.font,this.fontSize2,this.fontColor2,this.fontWeight):C("Press ENTER or LMB to restart",3,this.font,this.fontSize2,this.fontColor2,this.fontWeight)}}function o(){this.keyframe0=!0,this.keyframe1=!1,this.keyframe2=!1,this.lvlIntro=function(){gameText.lvlIntro(),this.keyframe0?(gameLights.fadeIn("text"),(!G.textFaded||G.keys[13]||Q)&&(Q=0,G.keys[13]=!1,G.textFaded||(this.keyframe0=!1,this.keyframe1=!0),gameLights.on("text"))):this.keyframe1?(G.keys[13]||Q)&&(Q=0,G.keys[13]=!1,this.keyframe1=!1,this.keyframe2=!0):this.keyframe2&&(gameLights.fadeOut("text"),(G.textFaded||G.keys[13]||Q)&&(Q=0,G.keys[13]=!1,G.textFaded&&(this.keyframe2=!1,this.keyframe0=!0,A(),G.lvlIntro=!1,G.lvlStart=!0),gameLights.off("text")))},this.lvlStart=function(){gameLights.fadeIn("all"),G.faded||(gameUI.updateAll(),G.lvlStart=!1)},this.lvlComplete=function(){gameText.lvlComplete(),this.keyframe0?(G.keys[13]||Q)&&(Q=0,G.keys[13]=!1,this.keyframe0=!1,this.keyframe1=!0):this.keyframe1&&(gameLights.fadeOut("all"),(G.faded||G.keys[13]||Q)&&(Q=0,G.keys[13]=!1,G.faded&&(G.lvlIntro=!0,this.keyframe0=!0,this.keyframe1=!1,G.levelComplete=!1,G.level++),gameLights.off("all")))},this.gameOver=function(){gameText.gameOver(),this.keyframe0?(G.keys[13]||Q)&&(Q=0,G.keys[13]=!1,this.keyframe0=!1,this.keyframe1=!0):this.keyframe1&&(gameLights.fadeOut("all"),(G.faded||G.keys[13]||Q)&&(Q=0,G.keys[13]=0,G.faded&&(this.keyframe0=!0,this.keyframe1=!1,G.start=!0,gameLights.on("text"),gameText.gameIntro(),G.gameOver=!1,G.paused=!0),gameLights.off("all")))},this.load=function(){G.lvlIntro?gameTransition.lvlIntro():G.lvlStart?gameTransition.lvlStart():G.levelComplete?gameTransition.lvlComplete():G.gameOver&&gameTransition.gameOver()},this.reset=function(){this.keyframe0=!0,this.keyframe1=!1,this.keyframe2=!1}}function p(){if(!G.keys[13]&&!Q||!G.start||G.gameOver||G.gameWon||(A(),Q=0,G.keys[13]=!1,G.music&&G.songs.length<1&&(G.songs.push(new Audio("_sounds/_lvl1/tune1.mp3")),G.songs[0].play(),G.songs[0].loop=!0),gameLights.off("all"),G.start=!1,G.paused=!1,gameUI.updateAll()),G.keys[27]&&(Q=0,G.keys[27]=!1,playerShip.hull=0,playerShip.lives=0,G.gameOver=!0),G.keys[119]&&(G.sound=G.sound?!1:!0,gameUI.updateSound(),G.keys[119]=!1),G.keys[120])if(G.music=G.music?!1:!0,gameUI.updateSound(),G.keys[120]=!1,G.songs.length>0){for(var a in G.songs)G.songs[a].pause();
G.songs=[]}else if(G.songs.length<1){G.songs.push(new Audio("_sounds/_lvl1/tune1.mp3"));for(var b in G.songs)G.songs[b].play(),G.songs[b].loop=!0}!G.keys[80]||G.gameWon||G.gameOver||(G.paused=G.paused?!1:!0,G.keys[80]=!1),(G.keys[27]||(G.keys[13]||Q)&&G.paused&&!G.start&&G.gameOver&&!G.gameWon||(G.keys[13]||Q)&&G.paused&&!G.start&&G.level>=7)&&((G.lives<1||G.level>=7)&&(G.level=X_Level,G.score=0,playerShip.lives=X_Lives),A())}function q(){if(z(),dtTimer<=30){var a=(new Date).getTime(),b=a-timeThen;dtArray.push(b),timeThen=a,dtTimer++}if(30==dtTimer){for(var c=0,e=0;e<dtArray.length-2;e++)c+=dtArray[e+2];dt=Math.round(c/dtArray.length)/1e3}if(G.timer++,G.seconds=G.timer/60||0,playerShip.load(),gameBackground.load(),1==G.level?r():2==G.level?r():3==G.level&&lvl3(),G.bossDead&&G.levelUpTimer<=100&&(G.levelUpTimer++,100==G.levelUpTimer&&(G.levelComplete=!0,Q=0)),gameTransition.load(),G.playerBullets.length>=1){for(var f in G.playerBullets)G.playerBullets[f].dead||(G.playerBullets[f].update(),G.playerBullets[f].draw());for(var g in G.playerBullets)(G.playerBullets[g].dead||G.playerBullets[g].x>G.width+G.playerBullets[g].size||G.playerBullets[g].x<0-G.playerBullets[g].size||G.playerBullets[g].y>G.height+G.playerBullets[g].size||G.playerBullets[g].y<-30)&&G.playerBullets.splice(g,1)}if(G.enemies.length>0){for(var h in G.enemies)G.enemies[h].update(),G.enemies[h].draw();if(G.playerBullets.length>=1)for(var i in G.enemies)for(var j in G.playerBullets)B(G.enemies[i],G.playerBullets[j])&&!G.enemies[i].dead&&(G.enemies[i].hit=!0,G.enemies[i].hull-=G.playerBullets[j].power,G.enemies[i].hull>0&&G.explosions.push(new d(G.enemies[i].x+.5*G.enemies[i].size,G.enemies[i].y+.5*G.enemies[i].size,0,1,.25*G.enemies[i].size)),G.playerBullets[j].dead=!0);for(var l in G.enemies)!B(G.enemies[l],playerShip)||G.enemies[l].dead||playerShip.imune||G.gameOver||(playerShip.hull-=G.enemies[l].hull,gameUI.updateEnergy(),playerShip.hit=!0,G.enemies[l].hit=!0,G.enemies[l].hull-=playerShip.hull);for(var m in G.enemies)(G.enemies[m].dead||G.enemies[m].y>G.height+G.enemies[m].size||G.enemies[m].x<.3*-G.width||G.enemies[m].x>1.3*G.width)&&(G.enemies[m].dead&&(lootchance=Math.random(),lootchance<.05&&G.loot.push(new k(G.enemies[m].x,G.enemies[m].y))),G.enemies.splice(m,1))}if(G.waves.length>0)for(var n in G.waves)G.waves[n].update(),G.waves[n].over&&G.waves.splice(n,1);if(G.loot.length>=1)for(var o in G.loot)G.loot[o].update(),G.loot[o].draw(),(G.loot[o].dead||G.loot[o].x>G.width+G.loot[o].size||G.loot[o].x<0-G.loot[o].size||G.loot[o].y>G.height+G.loot[o].size||G.loot[o].y<-30)&&G.loot.splice(o,1);if(G.enemyBullets.length>=1){for(var p in G.enemyBullets)G.enemyBullets[p].update(),G.enemyBullets[p].draw();for(var q in G.enemyBullets)!B(G.enemyBullets[q],playerShip)||playerShip.imune||G.gameOver||(playerShip.hull-=G.enemyBullets[q].power,gameUI.updateEnergy(),playerShip.hit=!0,G.enemyBullets[q].dead=!0);for(var s in G.enemyBullets)(G.enemyBullets[s].dead||G.enemyBullets[s].x>G.width+G.enemyBullets[s].size||G.enemyBullets[s].x<0-G.enemyBullets[s].size||G.enemyBullets[s].y>G.height+G.enemyBullets[s].size||G.enemyBullets[s].y<-30)&&G.enemyBullets.splice(s,1)}if(G.explosions.length>0){for(var t in G.explosions)G.explosions[t].update(),G.explosions[t].draw();for(var u in G.explosions)G.explosions[u].sprite.currentFrame>=G.explosions[u].sprite.endFrame&&G.explosions.splice(u,1)}if(G.sounds.length>0)for(var v in G.sounds)G.sounds[v].play(),G.sounds[v].addEventListener("ended",G.sounds.splice(v,1))}function r(){1==G.seconds&&G.waves.push(new M("left",.3*G.width,"sectoid.png","pawn",1,300,1,0)),1==G.seconds&&G.waves.push(new M("right",.3*G.width,"sectoid.png","pawn",1,250,1,0)),3==G.seconds&&G.waves.push(new M("left",.5*G.height,"sectoid.png","pawn",1,250,1,0)),3==G.seconds&&G.waves.push(new M("right",.5*G.height,"sectoid.png","pawn",1,300,1,0)),5==G.seconds&&G.enemies.push(new g(.7*G.width,.1*-G.height,80,Math.PI/2,10,"miniboss","floater.png",2)),7==G.seconds&&G.enemies.push(new g(.3*G.width,.1*-G.height,155,Math.PI/2,10,"base","alienbase1.png",1)),8==G.seconds&&G.waves.push(new M("left",.3*G.height,"sectoid.png","pawn",4,250,1,2)),9==G.seconds&&G.waves.push(new M("right",.2*G.height,"sectoid.png","pawn",3,300,1,2)),10==G.seconds&&G.waves.push(new M("top",.5*G.width,"sectoid.png","pawn",6,300,1,2)),11==G.seconds&&G.waves.push(new M("top",.7*G.width,"sectoid.png","pawn",4,300,1,2)),12==G.seconds&&G.waves.push(new M("left",.2*G.height,"sectoid.png","pawn",3,300,1,2)),13==G.seconds&&(G.music&&(G.songs.push(new Audio("_sounds/_lvl1/tune2.mp3")),G.songs[1].play(),G.songs[1].loop=!0),G.enemies.push(new g(.3*G.width,.1*-G.height,155,Math.PI/2,10,"base","alienbase2.png",1))),15==G.seconds&&G.waves.push(new M("top",.2*G.width,"sectoid.png","pawn",2,300,1,2)),16==G.seconds&&G.waves.push(new M("top",.4*G.width,"sectoid.png","pawn",3,300,1,2)),17==G.seconds&&G.waves.push(new M("top",.6*G.width,"sectoid.png","pawn",4,300,1,2)),18==G.seconds&&G.waves.push(new M("top",.8*G.width,"sectoid.png","pawn",5,300,1,2)),22==G.seconds&&G.waves.push(new M("top",.3*G.width,"sectoid.png","pawn",4,300,1,2)),25==G.seconds&&G.waves.push(new M("left",.4*G.width,"sectoid.png","pawn",4,300,1,2)),27==G.seconds&&G.waves.push(new M("right",.3*G.width,"sectoid.png","pawn",4,300,1,2)),30==G.seconds&&G.waves.push(new M("top",.3*G.width,"sectoid.png","pawn",4,300,1,2)),33==G.seconds&&G.waves.push(new M("top",.6*G.width,"sectoid.png","pawn",4,300,1,2)),35==G.seconds&&G.waves.push(new M("right",.2*G.width,"sectoid.png","pawn",4,300,1,2)),37==G.seconds&&G.enemies.push(new g(.2*G.width,.1*-G.height,80,Math.PI/2,10,"miniboss","floater.png",2)),38==G.seconds&&G.enemies.push(new g(.4*G.width,.1*-G.height,80,Math.PI/2,10,"miniboss","floater.png",2)),39==G.seconds&&G.enemies.push(new g(.6*G.width,.1*-G.height,80,Math.PI/2,10,"miniboss","floater.png",2)),40==G.seconds&&G.enemies.push(new g(.8*G.width,.1*-G.height,80,Math.PI/2,10,"miniboss","floater.png",2)),41==G.seconds&&G.enemies.push(new g(.5*G.width,.1*-G.height,80,Math.PI/2,10,"miniboss","floater.png",2)),42==G.seconds&&G.enemies.push(new g(.2*G.width,.1*-G.height,80,Math.PI/2,10,"miniboss","floater.png",2)),43==G.seconds&&G.enemies.push(new g(.4*G.width,.1*-G.height,80,Math.PI/2,10,"miniboss","floater.png",2)),44==G.seconds&&G.enemies.push(new g(.6*G.width,.1*-G.height,80,Math.PI/2,10,"miniboss","floater.png",2)),45==G.seconds&&G.enemies.push(new g(.8*G.width,.1*-G.height,80,Math.PI/2,10,"miniboss","floater.png",2)),G.seconds>50&&0===G.enemies.length&&!G.bossDead&&(G.music&&(G.songs.push(new Audio("_sounds/_lvl1/boss.mp3")),G.songs[2].play()),G.enemies.push(new h(.3*G.width,.1*-G.height,150,Math.PI/2,100,"sectoidBoss.png")))}function s(){N=document.getElementById("textCanvas"),N.addEventListener("mousedown",v,!1),N.addEventListener("mouseup",t,!1),N.addEventListener("mousemove",x,!1),N.addEventListener("touchstart",w,!1),N.addEventListener("touchend",u,!1),N.addEventListener("touchcancel",u,!1),N.addEventListener("touchleave",u,!1),N.addEventListener("touchmove",y,!1)}function t(a){a.preventDefault(),Q=0,x()}function u(a){a.preventDefault(),Q=0,y()}function v(a){a.preventDefault(),Q=1,x()}function w(a){a.preventDefault(),Q=1,y()}function x(a){a&&(a.preventDefault(),O=a.pageX-N.offsetLeft,P=a.pageY-N.offsetTop)}function y(a){a&&(a.preventDefault(),O=a.targetTouches[0].pageX-N.offsetLeft,P=a.targetTouches[0].pageY-N.offsetTop)}function z(){G.contextBackground.clearRect(0,0,G.width,G.height),G.contextPlayer.clearRect(0,0,G.width,G.height),G.contextEnemies.clearRect(0,0,G.width,G.height)}function A(){gameLights.off("all"),gameTransition.reset(),Q=0,G.gameOver=!1,G.gameWon=!1,G.level=G.lvlIntro?G.level:1,G.bossDead=!1,G.levelComplete=!1,G.lvlStart=!1,G.lvlIntro=!0,G.levelUpTimer=0,z(),playerShip.reset(),gameUI.updateAll(),G.background=[],G.enemies=[],G.waves=[],G.enemyBullets=[],G.loot=[],G.delayTimer=0,G.timer=0,G.sounds=[];for(var a in G.songs)G.songs[a].pause();G.songs=[],G.music&&(G.songs.push(new Audio("_sounds/_lvl1/tune1.mp3")),G.songs[0].play(),G.songs[0].loop=!0),G.paused=!1}function B(a,b){return!(a.x>b.x+b.size||a.x+a.size<b.x||a.y>b.y+b.size||a.y+a.size<b.y)}function C(a,b,c,d,e,f){var g=a,h=g.length,i=Math.round(h*(d/2)),j=Math.round(.1*G.height),k=Math.round(.5*(G.width-i)),l=Math.round(G.height/3.5+j*b);G.contextText.font=f+" "+d+"px "+c,G.contextText.fillStyle=e,G.contextText.fillText(g,k,l)}function D(){requestAnimFrame(D),p(),G.paused||q()}function E(a){G.requiredImages=a.length;for(var b in a){var c=new Image;c.src=a[b];var d=c.src.split("/").pop();G.images[d]=c,G.images[d].onload=function(){G.doneImages++}}}function F(){G.doneImages>=G.requiredImages?(gameText.gameIntro(),D()):setTimeout(function(){F()},1)}window.addEventListener("load",function(){window.applicationCache.addEventListener("updateready",function(){window.applicationCache.status==window.applicationCache.UPDATEREADY&&confirm("A new version of InVaDeRs is available. Load it?")&&window.location.reload()},!1)},!1),document.body.addEventListener("touchstart",function(a){a.preventDefault()}),document.body.addEventListener("touchmove",function(a){a.preventDefault()}),document.body.addEventListener("touchend",function(a){a.preventDefault()}),document.body.addEventListener("touchcancel",function(a){a.preventDefault()}),document.body.addEventListener("touchleave",function(a){a.preventDefault()}),window.addEventListener("load",s(),!1),$.ajax({type:"GET",url:"game.xml",dataType:"xml",async:!1,success:function(a){$(a).find("data").each(function(){X_Sound=parseInt($(this).find("sound").text()),X_Music=parseInt($(this).find("music").text()),X_Level=parseInt($(this).find("level").text()),X_Lives=parseInt($(this).find("player-lives").text()),X_PlayerSpeed=parseInt($(this).find("player-speed").text()),X_EnemySpeed=parseInt($(this).find("enemy-speed").text()),X_GunSpeed=parseInt($(this).find("reload-time").text()),X_EnGunSpeed=parseInt($(this).find("enreload-time").text()),X_BulletSpeed=parseInt($(this).find("bullet-speed").text()),X_EnBulletSpeed=parseInt($(this).find("enbullet-speed").text()),X_Title=$(this).find("title").text(),X_Subtitle=$(this).find("subtitle").text(),X_dt_Start=$(this).find("dt-start").text(),X_mb_Start=$(this).find("mb-start").text()})},error:function(){alert("The XML File could not be processed correctly.")}});var G={};G.isMobile=/iPhone|iPod|iPad|Android|BlackBerry/.test(navigator.userAgent),G.stars=[],G.faded=!0,G.backgroundFaded=!0,G.enemiesFaded=!0,G.playerFaded=!0,G.textFaded=!0,G.background=[],G.score=0,G.levelScore=0,G.level=X_Level,G.bossDead=!1,G.levelComplete=!1,G.levelUpTimer=0,G.lives=X_Lives,G.keys=[],G.playerBullets=[],G.enemyBullets=[],G.enemies=[],G.waves=[],G.loot=[],G.explosions=[],dt=0,dtTimer=0,dtArray=[],timeThen=(new Date).getTime(),G.start=!0,G.lvlIntro=!0,G.lvlStart=!1,G.paused=!0,G.escaped=!1,G.gameWon=!1,G.gameOver=!1,G.delayTimer=0,G.timer=0,G.sound=X_Sound,G.music=X_Music,G.sounds=[],G.songs=[],G.images=[],G.doneImages=0,G.requiredImages=0,G.contextBackground=document.getElementById("backgroundCanvas").getContext("2d"),G.contextEnemies=document.getElementById("enemiesCanvas").getContext("2d"),G.contextPlayer=document.getElementById("playerCanvas").getContext("2d"),G.contextText=document.getElementById("textCanvas").getContext("2d");var H=$("#backgroundCanvas"),I=$("#enemiesCanvas"),J=$("#playerCanvas"),K=$("#textCanvas"),L=$(H).parent();$(window).resize(a),a(),gameBackground=new c,d.prototype=Object.create(particle.prototype),d.prototype.constructor=d,e.prototype=Object.create(particle.prototype),e.prototype.constructor=e,playerShip=new e(10,15),f.prototype=Object.create(particle.prototype),f.prototype.constructor=f,g.prototype=Object.create(particle.prototype),g.prototype.constructor=g,h.prototype=Object.create(particle.prototype),h.prototype.constructor=h,j.prototype=Object.create(particle.prototype),j.prototype.constructor=j,k.prototype=Object.create(particle.prototype),k.prototype.constructor=k;var M=function(a,b,c,d,e,f,h,i){switch(this.side=a,this.spawnedShips=0,this.race=c,this.type=d,this.fleetSize=e,this.speed=f,this.hull=h,this.fireRate=i||0,this.spawnTimer=1,this.spawnDivision=Math.round(1500*dt),this.side){case"top":this.x=b,this.y=-Math.round(.1*G.height),this.direction=Math.PI/2;break;case"left":this.x=-Math.round(.2*G.width),this.y=b,this.direction=0;break;case"right":this.x=Math.round(1.2*G.width),this.y=b,this.direction=Math.PI}this.over=!1,this.update=function(){this.spawnTimer++,this.spawnedShips<=this.fleetSize&&this.spawnTimer%this.spawnDivision==1&&(this.spawnTimer=1,G.enemies.push(new g(this.x,this.y,this.speed,this.direction,this.hull,this.type,this.race,this.fireRate,!0)),this.spawnedShips++),this.spawnedShips==this.fleetSize&&(this.over=!0)}};gameUI=new l,gameLights=new m,gameText=new n,gameTransition=new o,$(document).keydown(function(a){G.keys[a.keyCode?a.keyCode:a.which]=!0}),$(document).keyup(function(a){delete G.keys[a.keyCode?a.keyCode:a.which]});var N,O=playerShip.x,P=playerShip.y,Q=0,R=O,S=P;E(["_img/_dist/background/intro_bg.jpg","_img/_dist/background/level1.jpg","_img/_dist/ui/energybar.png","_img/_dist/ui/energypoint.png","_img/_dist/fighter/fighter.png","_img/_dist/fighter/fighter_right1.png","_img/_dist/fighter/fighter_right2.png","_img/_dist/fighter/fighter_right3.png","_img/_dist/fighter/fighter_right4.png","_img/_dist/fighter/fighter_right5.png","_img/_dist/fighter/fighter_left1.png","_img/_dist/fighter/fighter_left2.png","_img/_dist/fighter/fighter_left3.png","_img/_dist/fighter/fighter_left4.png","_img/_dist/fighter/fighter_left5.png","_img/_dist/enemies/sectoid.png","_img/_dist/enemies/_miniboss/floater.png","_img/_dist/enemies/_alienbase/alienbase1.png","_img/_dist/enemies/_alienbase/alienbase2.png","_img/_dist/enemies/_bigboss/sectoidBoss.png","_img/_dist/laser.png","_img/_dist/missile.png","_img/_dist/explosion.png"]),F()})}(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();