function setGameDimensions(){var a=($("#gamearea"),$("canvas"));game.windowWidth=game.isMobile?doc.documentElement.clientWidth:parseInt($("#gamearea").css("width")),game.windowHeight=doc.documentElement.clientHeight,game.deltaSpeed=game.windowHeight>=480?game.windowHeight/480:1,game.deltaSpeed=game.windowHeight>=720?1.5:game.deltaSpeed,a.attr("width",game.windowWidth),a.attr("height",game.windowHeight),game.width=Math.round(game.windowWidth),game.height=Math.round(game.windowHeight),game.outerLeft=-Math.round(.1*game.width),game.outerRight=Math.round(game.width+.1*game.width),game.outerTop=-Math.round(.1*game.height),game.outerBottom=Math.round(game.height+.1*game.height),game.centerX=Math.round(game.width/2),game.centerY=Math.round(game.height/2),playerShip&&"undefined"!=typeof playerShip&&(playerShip.limitX2=Math.round(game.width-.5*playerShip.width),playerShip.limitY2=Math.round(game.height-playerShip.height),playerShip.accel=7e-4*game.height,playerShip.speedLimit=Math.round(3*game.dt*game.deltaSpeed)),"undefined"!=typeof gameBackground&&gameBackground.resize()}function getNewExplosion(a,b,c,d,e){var f=null;f=game.explosionsPool.pop(),f.reset(a,b,c,d,e),f.sprite.reset(f.image,5,4,2),game.objects.push(f)}function freeExplosion(a){game.objects.splice(game.objects.indexOf(a),1),game.explosionsPool.push(a)}function initExplosions(){for(var a=1;a<=game.requiredExplosions;a++)e=new explosion(null,null,null,null,1,null),game.explosionsPool.push(e),game.doneObjects++}function getNewEnemyMinion(a,b,c,d,e,f,g){var h=null;h=game.minionsPool.pop(),h.reset(a,b,c,d,e,f,g),game.enemies.push(h)}function freeEnemyMinion(a){game.enemies.splice(game.enemies.indexOf(a),1),game.minionsPool.push(a)}function initEnemyMinions(){for(var a=1;a<=game.requiredMinions;a++)en=new enemyMinion(0,0,0,0,0,"enemy_sectoid",0),game.minionsPool.push(en),game.doneObjects++}function getNewEnemyMiniBoss(a,b,c,d,e,f,g){var h=null;h=game.miniBossPool.pop(),h.reset(a,b,c,d,e,f,g),game.enemies.push(h)}function freeEnemyMiniBoss(a){game.enemies.splice(game.enemies.indexOf(a),1),game.miniBossPool.push(a)}function initEnemyMiniBosses(){for(var a=1;a<=game.requiredMiniBosses;a++)en=new enemyMiniBoss(0,0,0,0,0,"enemy_sectoid",0),game.miniBossPool.push(en),game.doneObjects++}function getNewEnemyBase(a,b,c,d,e,f,g){var h=null;h=game.enemyBasePool.pop(),h.sprite.reset(f,6,5,6),h.reset(a,b,c,d,e,f,g),game.enemies.push(h)}function freeEnemyBase(a){game.enemies.splice(game.enemies.indexOf(a),1),game.enemyBasePool.push(a)}function initEnemyBases(){for(var a=1;a<=game.requiredEnemyBases;a++)en=new enemyBase(0,0,0,0,0,"enemy_sectoid",0),game.enemyBasePool.push(en),game.doneObjects++}function getNewEnemyWave(a,b,c,d,e,f,g){var h=null;switch(h=game.wavesPool.pop(),h.side=a,h.spawnedShips=0,h.race=c,h.fleetSize=d,h.speed=e,h.hull=f,h.fireRate=g,h.spawnTimer=1,h.spawnRate=6*h.speed,h.side){case"top":h.x=Math.round(b),h.y=game.outerTop,h.direction=Math.PI/2;break;case"left":h.x=game.outerLeft,h.y=Math.round(b),h.direction=0;break;case"right":h.x=game.outerRight,h.y=Math.round(b),h.direction=Math.PI}game.objects.push(h)}function freeEnemyWave(a){game.objects.splice(game.objects.indexOf(a),1),game.wavesPool.push(a)}function initWaves(){for(var a=1;a<=game.requiredWaves;a++)ew=new enemyWave(null,null,"enemy_sectoid","pawn",0,0,0,0),game.wavesPool.push(ew),game.doneObjects++}function initBosses(){for(var a=1;a<=game.requiredBosses;a++){var b=new sectoidBoss(.4*game.width,game.outerTop,1,Math.PI/2,100,"boss_sectoid");game.bossesPool.push(b),game.doneObjects++}}function getNewSectoidBoss(){var a=null;a=game.bossesPool[0],a.reset(.4*game.width,game.outerTop,100),game.enemies.push(a),game.bossUp=!0,game.bossesPool.splice(0,1)}function freeSectoidBoss(a){game.enemies.splice(game.enemies.indexOf(a),1),game.bossesPool.splice(0,0,a),game.bossDead=!0,game.bossUp=!1}function initEnemyBullets(){for(var a=1;a<=game.requiredEnemyBullets;a++)eb=new enemyBullet(null,null,null,null,null,"bullet_e_missile"),game.enemyBulletsPool.push(eb),game.doneObjects++}function getNewLoot(a,b){var c=null;c=game.lootPool.pop(),c.reset(a,b),game.objects.push(c)}function freeLoot(a){game.objects.splice(game.objects.indexOf(a),1),game.lootPool.push(a)}function initLoot(){for(var a=1;a<=game.requiredLoot;a++)l=new loot(null,null),game.lootPool.push(l),game.doneObjects++}function update(){gameBackground.update(),game.dtTimerSet||getDeltaTime(),updateGameTime(),game.seconds==Math.round(game.seconds)&&win["level"+game.level]["second"+game.seconds]&&win["level"+game.level]["second"+game.seconds](),win["level"+game.level].update();for(var a=game.enemies.length;a--;)game.enemies[a].update();for(var b=game.objects.length;b--;)game.objects[b].update()}function respondCanvas(){game.paused=!gameMenu.toggled||game.paused,setGameDimensions(),game.paused=!!gameMenu.toggled&&game.paused}function vibrateDevice(a){game.canVibrate&&navigator.vibrate(a)}function addGamePlayInput(){inputAreaX=playerShip.x,inputAreaY=playerShip.y,inputArea.addEventListener("mousedown",mouseDown,!1),inputArea.addEventListener("mouseup",mouseUp,!1),inputArea.addEventListener("mousemove",mouseXY,!1),inputArea.addEventListener("touchstart",touchDown,!1),inputArea.addEventListener("touchend",touchUp,!1),inputArea.addEventListener("touchcancel",touchUp,!1),inputArea.addEventListener("touchleave",touchUp,!1),inputArea.addEventListener("touchmove",touchXY,!1)}function addStandByInput(){inputArea.addEventListener("mouseup",standByInput,!1),inputArea.addEventListener("touchstart",standByInput,!1)}function removeGamePlayInput(){inputArea.removeEventListener("mousedown",mouseDown,!1),inputArea.removeEventListener("mouseup",mouseUp,!1),inputArea.removeEventListener("mousemove",mouseXY,!1),inputArea.removeEventListener("touchstart",touchDown,!1),inputArea.removeEventListener("touchend",touchUp,!1),inputArea.removeEventListener("touchcancel",touchUp,!1),inputArea.removeEventListener("touchleave",touchUp,!1),inputArea.removeEventListener("touchmove",touchXY,!1)}function removeStandByInput(){inputArea.removeEventListener("mouseup",standByInput,!1),inputArea.removeEventListener("touchstart",standByInput,!1)}function mouseUp(a){a.preventDefault(),mouseIsDown=0,game.isMobile||(doc.getElementById("gamearea").style.cursor="crosshair")}function touchUp(a){a.preventDefault(),mouseIsDown=0}function mouseDown(a){a.preventDefault(),mouseIsDown=1,touchInitX=a.pageX-inputArea.offsetLeft,touchInitY=a.pageY-inputArea.offsetTop,game.isMobile||(doc.getElementById("gamearea").style.cursor="none")}function touchDown(a){a.preventDefault(),mouseIsDown=1;var b=a.targetTouches[0];touchInitX=b.pageX-b.target.offsetLeft,touchInitY=b.pageY-b.target.offsetTop}function mouseXY(a){a.preventDefault(),inputAreaX=a.pageX-inputArea.offsetLeft,inputAreaY=a.pageY-inputArea.offsetTop}function touchXY(a){a.preventDefault();var b=a.targetTouches[0];inputAreaX=b.pageX-inputArea.offsetLeft,inputAreaY=b.pageY-inputArea.offsetTop}function standByInput(a){a.preventDefault(),game.fadingIn&&(gameLights.fader.stop(!0,!0),gameLights.switch("on")),game.fadingOut&&(gameLights.fader.stop(!0,!0),gameLights.switch("off")),game.textFadingIn&&($(".all-text").stop(!0,!0),gameText.switch("off")),game.textFadingOut&&($(".all-text").stop(!0,!0),gameText.switch("off"))}function getDeltaTime(){if(document.getElementById("toggle-menu-btn").disabled=!0,game.dtTimer<=200){var a=(new Date).getTime(),b=a-game.timeThen;if(game.dtArray.push(b),game.timeThen=a,game.dtTimer++,200==game.dtTimer){for(var c=0,d=0,e=0;e<game.dtArray.length-10;e++)c+=game.dtArray[e+10];d=c/game.dtArray.length,game.dt=d<16.6?16.6/d:1,game.dtTimerSet=!0,document.getElementById("toggle-menu-btn").disabled=!1}}}function updateGameTime(){game.timer++,game.seconds=game.timer/60||0}function resetGame(){mouseIsDown=0,gameLights.switch("off"),game.gameOver=!0,game.bossDead=!1,game.levelComplete=!1,game.timer=0,game.seconds=0,game.levelUpTimer=0;for(var a=game.enemies.length;a--;)game.enemies[a].recycle();for(var b=game.objects.length;b--&&b>0;)game.objects[b].recycle();playerShip.reset(),gameUI.updateAll(),gameMusic.pauseAll(),gameMusic.on&&gameMusic.playTrack("tune1",!0)}function Collision(a,b){return!(a.x>b.x+b.width||a.x+a.width<b.x||a.y>b.y+b.height||a.y+a.height<b.y)}function loop(){requestAnimFrame(loop),game.paused||update()}function startGame(){game.loaded=!0,game.objects[0]instanceof player||(game.objects.unshift(new player(10,15)),playerShip=game.objects[0]),gameMusic.chromiumFix(),gameSfx.chromiumFix(),gameMusic.on&&gameMusic.playTrack("tune1",!0),loop()}function checkObjects(){game.doneObjects>=game.requiredObjects?(gameUI.loadingBarClose(),gameMenu.init(),gameBackground=new background):(gameUI.loadingBarUpdate(game.doneObjects,game.requiredObjects),setTimeout(function(){checkObjects()},1))}function initObjects(){initWaves(),initEnemyMinions(),initEnemyMiniBosses(),initEnemyBases(),initBosses(),initEnemyBullets(),initPlayerBullets(),initExplosions(),initLoot()}function windowLoadEvent(){win.removeEventListener("load",windowLoadEvent,!1),window.onresize=respondCanvas,doc.addEventListener("fullscreenchange",fullScreenHandler),doc.addEventListener("webkitfullscreenchange",fullScreenHandler),doc.addEventListener("mozfullscreenchange",fullScreenHandler),doc.addEventListener("MSFullscreenChange",fullScreenHandler),win.applicationCache.addEventListener("updateready",appCacheEvent,!1),gameGfx.init()}function fullScreenHandler(){var a=$("#toggleFullScreen");game.fullScreen=!game.fullScreen,game.fullScreen?(a.addClass("active"),a.text("Fullscreen: ON")):(a.removeClass("active"),a.text("Fullscreen: OFF"))}function appCacheEvent(){win.applicationCache.removeEventListener("updateready",appCacheEvent,!1),win.applicationCache.status==win.applicationCache.UPDATEREADY&&confirm("A new version of InVaDeRs is available. Load it?")&&win.location.reload()}function testpreload(a){clearTimeout(timeout),audioTest.removeEventListener("loadeddata",testpreload),audiopreload=void 0!==a&&"loadeddata"===a.type}var vector={_x:1,_y:0,create:function(a,b){var c=Object.create(this);return c.setX(a),c.setY(b),c},setX:function(a){this._x=a},getX:function(){return this._x},setY:function(a){this._y=a},getY:function(){return this._y},setAngle:function(a){var b=this.getLength();this._x=Math.cos(a)*b,this._y=Math.sin(a)*b},getAngle:function(){return Math.atan2(this._y,this._x)},setLength:function(a){var b=this.getAngle();this._x=Math.cos(b)*a,this._y=Math.sin(b)*a},getLength:function(){return Math.sqrt(this._x*this._x+this._y*this._y)},add:function(a){return vector.create(this._x+a.getX(),this._y+a.getY())},subtract:function(a){return vector.create(this._x-a.getX(),this._y-a.getY())},multiply:function(a){return vector.create(this._x*a,this._y*a)},divide:function(a){return vector.create(this._x/a,this._y/a)},addTo:function(a){this._x+=a.getX(),this._y+=a.getY()},subtractFrom:function(a){this._x-=a.getX(),this._y-=a.getY()},multiplyBy:function(a){this._x*=a,this._y*=a},divideBy:function(a){this._x/=a,this._y/=a}},utils={norm:function(a,b,c){return(a-b)/(c-b)},lerp:function(a,b,c){return(c-b)*a+b},map:function(a,b,c,d,e){return utils.lerp(utils.norm(a,b,c),d,e)},clamp:function(a,b,c){return Math.min(Math.max(a,Math.min(b,c)),Math.max(b,c))},angleTo:function(a,b){return Math.atan2(b.y+b.centerY-a.y,b.x+b.centerX-a.x)},distance:function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)},distanceXY:function(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(e*e+f*f)},circleCollision:function(a,b){return utils.distance(a,b)<=a.radius+b.radius},circlePointCollision:function(a,b,c){return utils.distanceXY(a,b,c.x,c.y)<c.radius},pointInRect:function(a,b,c){return utils.inRange(a,c.x,c.x+c.width)&&utils.inRange(b,c.y,c.y+c.height)},inRange:function(a,b,c){return a>=Math.min(b,c)&&a<=Math.max(b,c)},rangeIntersect:function(a,b,c,d){return Math.max(a,b)>=Math.min(c,d)&&Math.min(a,b)<=Math.max(c,d)},rectIntersect:function(a,b){return utils.rangeIntersect(a.x,a.x+a.width,b.x,b.x+b.width)&&utils.rangeIntersect(a.y,a.y+a.height,b.y,b.y+b.height)},degreesToRads:function(a){return a/180*Math.PI},radsToDegrees:function(a){return 180*a/Math.PI},randomRange:function(a,b){return a+Math.random()*(b-a)},randomInt:function(a,b){return Math.floor(a+Math.random()*(b-a+1))},roundToPlaces:function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},roundNearest:function(a,b){return Math.round(a/b)*b},quadraticBezier:function(a,b,c,d,e){return e=e||{},e.x=Math.pow(1-d,2)*a.x+2*(1-d)*d*b.x+d*d*c.x,e.y=Math.pow(1-d,2)*a.y+2*(1-d)*d*b.y+d*d*c.y,e},cubicBezier:function(a,b,c,d,e,f){return f=f||{},f.x=Math.pow(1-e,3)*a.x+3*Math.pow(1-e,2)*e*b.x+3*(1-e)*e*e*c.x+e*e*e*d.x,f.y=Math.pow(1-e,3)*a.y+3*Math.pow(1-e,2)*e*b.y+3*(1-e)*e*e*c.y+e*e*e*d.y,f},multicurve:function(a,b){var c,d,e,f;b.moveTo(a[0].x,a[0].y);for(var g=1;g<a.length-2;g+=1)c=a[g],d=a[g+1],e=(c.x+d.x)/2,f=(c.y+d.y)/2,b.quadraticCurveTo(c.x,c.y,e,f);c=a[a.length-2],d=a[a.length-1],b.quadraticCurveTo(c.x,c.y,d.x,d.y)}},doc=document,win=window,game={};/iPad|iPhone|iPod/.test(navigator.userAgent)&&!win.MSStream&&doc.querySelector("meta[name=viewport]").setAttribute("content","initial-scale=1.0001, minimum-scale=1.0001, maximum-scale=1.0001, user-scalable=no"),$.ajax({type:"GET",url:"game.xml",contentType:"text/xml",dataType:"text",async:!1,success:function(a){$(a).find("data").each(function(){X_Sound=parseInt($(this).find("sound").text()),X_Music=parseInt($(this).find("music").text()),X_Level=parseInt($(this).find("level").text()),X_Lives=parseInt($(this).find("player-lives").text()),X_PlayerSpeed=parseInt($(this).find("player-speed").text()),X_EnemySpeed=parseInt($(this).find("enemy-speed").text()),X_GunSpeed=parseInt($(this).find("reload-time").text()),X_EnGunSpeed=parseInt($(this).find("enreload-time").text()),X_BulletSpeed=parseInt($(this).find("bullet-speed").text()),X_EnBulletSpeed=parseInt($(this).find("enbullet-speed").text()),X_Title=$(this).find("title").text(),X_Subtitle=$(this).find("subtitle").text(),X_dt_Start=$(this).find("dt-start").text(),X_mb_Start=$(this).find("mb-start").text()})},error:function(){alert("The XML File could not be processed correctly.")}}),game.isMobile=!1,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(game.isMobile=!0),game.seconds=0,game.background=null,game.score=0,game.levelScore=0,game.level=X_Level,game.bossDead=!1,game.bossUp=!1,game.levelComplete=!1,game.levelUpTimer=0,game.lives=X_Lives,game.keys=[],game.objects=[],game.bullets=[],game.playerBulletsPool=[],game.enemyBulletsPool=[],game.lootPool=[],game.enemies=[],game.minionsPool=[],game.miniBossPool=[],game.enemyBasePool=[],game.bossesPool=[],game.waves=[],game.wavesPool=[],game.explosions=[],game.explosionsPool=[],game.requiredWaves=10,game.requiredMinions=25,game.requiredMiniBosses=15,game.requiredEnemyBases=3,game.requiredBosses=5,game.requiredEnemies=game.requiredMinions+game.requiredMiniBosses+game.requiredEnemyBases+game.requiredBosses,game.requiredPlayerBullets=70,game.requiredEnemyBullets=30,game.requiredLoot=10,game.requiredExplosions=30,game.requiredObjects=game.requiredWaves+game.requiredEnemies+game.requiredPlayerBullets+game.requiredEnemyBullets+game.requiredLoot+game.requiredExplosions,game.doneObjects=0,game.dt=1,game.dtTimer=0,game.dtArray=[],game.timeThen=(new Date).getTime(),game.dtTimerSet=!1,game.loaded=!1,game.started=!1,game.paused=!1,game.gameOver=!1,game.timer=0,game.fadingIn=!1,game.fadingOut=!1,game.faded=!0,game.textFadingIn=!1,game.textFadingOut=!1,game.textFaded=!0,game.windowWidth=game.isMobile?doc.documentElement.clientWidth:parseInt($("#gamearea").css("width")),game.windowHeight=doc.documentElement.clientHeight,game.deltaSpeed=null,game.fullScreen=!1,game.isMobile||(doc.getElementById("gamearea").style.cursor="crosshair"),game.mouseControls=!0,game.keyboardControls=!1;var inputArea=doc.getElementById("inputarea"),inputAreaX,inputAreaY,mouseIsDown=0,touchInitX=0,touchInitY=0;game.canVibrate="vibrate"in navigator||"mozVibrate"in navigator,!game.canVibrate||"vibrate"in navigator||(navigator.vibrate=navigator.mozVibrate);var audioElementSupported=function(a){var b=a.createElement("audio"),c={},d="audio/";return"function"==typeof b.canPlayType?(c.supported=Boolean(!0),c.mp3=b.canPlayType(d+"mpeg"),c.wav=b.canPlayType(d+'wav; codecs="1"'),c.ogg=b.canPlayType(d+'ogg; codecs="vorbis"'),c.m4a=b.canPlayType(d+"x-m4a")||b.canPlayType(d+"aac"),c.webm=b.canPlayType(d+'webm; codecs="vorbis"')):c.supported=Boolean(0),c}(this.document);""!==audioElementSupported.m4a?fileFormat=".m4a":""!==audioElementSupported.ogg?fileFormat=".ogg":fileFormat=".mp3",game.canvas=doc.getElementById("gameCanvas"),game.context=game.canvas.getContext("2d"),setGameDimensions(),"localStorage"in win&&null!==win.localStorage&&("true"===localStorage.keyboardControls?(game.mouseControls=!1,game.keyboardControls=!0):(game.mouseControls=!0,game.keyboardControls=!1)),sprite=function(a,b,c,d){for(this.image=gameGfx.offCtx[a],this.width=this.image.width,this.height=this.image.height,this.totalFrames=b*c,this.frameWidth=this.width/b,this.frameHeight=this.height/c,this.startFrame=0,this.endFrame=this.totalFrames-1,this.frameSpeed=d,this.ctx=game.context,this.animationSequence=[],this.fpr=Math.floor(this.image.width/this.frameWidth),this.frameNum=this.startFrame;this.frameNum<=this.endFrame;this.frameNum++)this.animationSequence.push(this.frameNum)},sprite.prototype.currentFrame=0,sprite.prototype.counter=0,sprite.prototype.reset=function(a,b,c,d){for(this.image=gameGfx.offCtx[a],this.width=this.image.width,this.height=this.image.height,this.totalFrames=b*c,this.frameWidth=this.width/b,this.frameHeight=this.height/c,this.startFrame=0,this.endFrame=this.totalFrames-1,this.frameSpeed=d,this.animationSequence=[],this.fpr=Math.floor(this.image.width/this.frameWidth),this.currentFrame=0,this.counter=0,this.frameNum=this.startFrame;this.frameNum<=this.endFrame;this.frameNum++)this.animationSequence.push(this.frameNum)},sprite.prototype.draw=function(a,b){this.ctx.drawImage(this.image,this.spriteCol*this.frameWidth,this.spriteRow*this.frameHeight,this.frameWidth,this.frameHeight,a,b,this.frameWidth,this.frameHeight),this.counter==this.frameSpeed-1&&(this.currentFrame=(this.currentFrame+1)%this.animationSequence.length),this.counter=(this.counter+1)%this.frameSpeed,this.spriteRow=Math.floor(this.animationSequence[this.currentFrame]/this.fpr),this.spriteCol=Math.floor(this.animationSequence[this.currentFrame]%this.fpr)},sprite.prototype.drawFrame=function(a,b,c){this.currentFrame=c%this.animationSequence.length,this.spriteRow=Math.floor(this.animationSequence[this.currentFrame]/this.fpr),this.spriteCol=Math.floor(this.animationSequence[this.currentFrame]%this.fpr),this.ctx.drawImage(this.image,this.spriteCol*this.frameWidth,this.spriteRow*this.frameHeight,this.frameWidth,this.frameHeight,a,b,this.frameWidth,this.frameHeight)},background=function(){this.image=gameGfx.offCtx["bg_level"+game.level],this.image.sX=this.image.width<=game.width?0:Math.ceil((this.image.width-game.width)/2),this.image.sY=this.image.height-game.height,this.image.sH=game.height,this.image.sW=game.width,this.image.dX=0,this.image.dY=0,this.image.dW=game.width,this.image.dH=game.height,this.image.TsX=this.image.sX,this.image.TsY=1,this.image.TsW=this.image.sW,this.image.TsH=game.height,this.image.TdX=0,this.image.TdY=0,this.image.TdW=this.image.dW,this.image.TdH=game.height,this.speed=Math.floor(2*game.dt*game.deltaSpeed),this.ctx=game.context},background.prototype.resize=function(){this.image.sX=this.image.width<=game.width?0:Math.ceil((this.image.width-game.width)/2),this.image.sW=game.width,this.image.dW=game.width,this.image.TsX=this.image.sX,this.image.TsW=this.image.sW,this.image.TdW=this.image.dW,background.prototype.update==background.prototype.roll?(this.image.sH=game.height,this.image.dH=game.height):(this.image.TsH=game.height,this.image.TdH=game.height)},background.prototype.drawImage=function(){this.ctx.drawImage(this.image,this.image.sX,this.image.sY,this.image.sW,this.image.sH,this.image.dX,this.image.dY,this.image.dW,this.image.dH)},background.prototype.drawTransImage=function(){this.ctx.drawImage(this.image,this.image.TsX,this.image.TsY,this.image.TsW,this.image.TsH,this.image.TdX,this.image.TdY,this.image.TdW,this.image.TdH)},background.prototype.transitionReset=function(){this.image.TsY=this.image.sY+1,this.image.TsH=this.image.sH,this.image.TdY=this.image.dY,this.image.TdH=this.image.dH,this.image.sY=this.image.height-1,this.image.sH=1,this.image.dY=0,this.image.dH=1,background.prototype.update=background.prototype.transition},background.prototype.rollReset=function(){this.image.dH=this.image.TdY,background.prototype.update=background.prototype.roll},background.prototype.roll=function(){return this.image.sY-=this.speed,this.image.sY<=1?void this.transitionReset():void this.drawImage()},background.prototype.transition=function(){return this.image.TsH-=this.speed,this.image.TdY+=this.speed,this.image.TdH-=this.speed,this.image.sY-=this.speed,this.image.sH+=this.speed,this.image.dH+=this.speed,this.image.TsH<=0?void this.rollReset():(this.drawTransImage(),void this.drawImage())},background.prototype.update=background.prototype.roll,explosion=function(a,b,c,d,e){this.size=e,this.image="explosion_s"+this.size,this.x=Math.round(a-.2*this.width),this.y=Math.round(b-.2*this.height),this.sprite=new sprite(this.image,5,4,2),this.width=this.sprite.frameWidth,this.height=this.sprite.frameHeight,this.speed=c,this.direction=d,this.vx=Math.cos(this.direction)*this.speed,this.xThrust=Math.round(this.vx),this.vy=Math.sin(this.direction)*this.speed,this.yThrust=Math.round(this.vy)},explosion.prototype.reset=function(a,b,c,d,e){this.size=e,this.image="explosion_s"+this.size,this.x=Math.round(a-.2*this.width),this.y=Math.round(b-.2*this.height),this.speed=c,this.direction=d,this.vx=Math.cos(this.direction)*this.speed,this.xThrust=Math.round(this.vx),this.vy=Math.sin(this.direction)*this.speed,this.yThrust=Math.round(this.vy)},explosion.prototype.playSfx=function(){switch(this.size){case 0:gameSfx.play("hit");break;case 4:gameSfx.play("blast");break;default:gameSfx.play("explosion")}},explosion.prototype.recycle=function(){freeExplosion(this)},explosion.prototype.checkStatus=function(){gameSfx.on&&this.sprite.currentFrame===this.sprite.startFrame&&this.playSfx(),this.sprite.currentFrame>=this.sprite.endFrame&&this.recycle()},explosion.prototype.setMovement=function(){this.x+=this.xThrust,this.y+=this.yThrust},explosion.prototype.update=function(){this.checkStatus(),this.setMovement(),this.draw()},explosion.prototype.draw=function(){this.sprite.draw(this.x,this.y)},player=function(a,b){self=this,this.fireRate=b,this.hull=a,this.maxHull=a,this.sprite=new sprite("player_ship",5,3,5),this.sprite_i=new sprite("player_ship_i",5,3,5),this.sprite_s=new sprite("player_shields",3,2,5),this.width=this.sprite.frameWidth,this.height=this.sprite.frameHeight,this.centerX=Math.round(.5*this.width),this.centerRightX=Math.round(.75*this.width),this.centerLeftX=Math.round(.25*this.width),this.centerY=Math.round(.5*this.height),this.tipY=Math.round(.2*this.height),this.limitX1=Math.round(.5*-this.width),this.limitX2=Math.round(game.width-.5*this.width),this.limitY1=0,this.limitY2=Math.round(game.height-this.height)},player.prototype.x=Math.round(.46*game.width),player.prototype.y=Math.round(.9*game.height),player.prototype.ctx=game.context,player.prototype.speed=0,player.prototype.speedX=0,player.prototype.speedY=0,player.prototype.spriteLeftFrames=[0,0,1,2,3,4,4,4,4,4,4],player.prototype.spriteRightFrames=[5,5,6,7,8,9,9,9,9,9,9],player.prototype.hit=!1,player.prototype.imune=!1,player.prototype.imuneTimer=-5,player.prototype.imuneTicks=0,player.prototype.deadTimer=0,player.prototype.lives=X_Lives,player.prototype.accel=7e-4*game.height,player.prototype.speedLimit=Math.round(5*game.dt*game.deltaSpeed),player.prototype.fireTimer=1,player.prototype.laserLevel=1,player.prototype.missileLevel=0,player.prototype.reset=function(){this.lives=game.gameOver?X_Lives:this.lives,game.gameOver=!1,this.imune=!0,this.imuneTimer=-5,this.hull=10,this.deadTimer=0,this.speed=0,this.hit=!1,this.spriteFrame=10,this.x=Math.round(game.centerX-this.centerX),this.y=Math.round(game.height-this.height),this.friction=0,this.laserLevel=1,this.missileLevel=0,gameUI.updateEnergy(),player.prototype.update=player.prototype.aliveUpdate},player.prototype.mouseControls=function(){mouseIsDown?(this.fireGuns(),this.speedX=Math.round(.1*(touchInitX-inputAreaX)*game.deltaSpeed),this.speedY=Math.round(.1*(touchInitY-inputAreaY)*game.deltaSpeed),this.speedX=this.speedX<this.speedLimit?this.speedX:this.speedLimit,this.speedY=this.speedY<this.speedLimit?this.speedY:this.speedLimit,this.speedX=this.speedX>-this.speedLimit?this.speedX:-this.speedLimit,this.speedY=this.speedY>-this.speedLimit?this.speedY:-this.speedLimit):(0!==this.speedX&&(this.speedX=this.speedX>0?Math.floor(this.speedX-this.accel):Math.ceil(this.speedX+this.accel)),0!==this.speedY&&(this.speedY=this.speedY>0?Math.floor(this.speedY-this.accel):Math.ceil(this.speedY+this.accel)))},player.prototype.keyboardControls=function(){game.keys[32]&&this.fireGuns(),game.keys[37]||game.keys[39]||game.keys[38]||game.keys[40]?(game.keys[37]&&(this.speedX=this.speedX<this.speedLimit?Math.round(this.speedX+this.accel):Math.round(this.speedLimit)),game.keys[39]&&(this.speedX=this.speedX>-this.speedLimit?Math.round(this.speedX-this.accel):Math.round(-this.speedLimit)),game.keys[38]&&(this.speedY=this.speedY<this.speedLimit?Math.round(this.speedY+this.accel):Math.round(this.speedLimit)),game.keys[40]&&(this.speedY=this.speedY>-this.speedLimit?Math.round(this.speedY-this.accel):Math.round(-this.speedLimit))):(0!==this.speedX&&(this.speedX=this.speedX>0?Math.floor(this.speedX-this.accel):Math.ceil(this.speedX+this.accel)),0!==this.speedY&&(this.speedY=this.speedY>0?Math.floor(this.speedY-this.accel):Math.ceil(this.speedY+this.accel)))},player.prototype.setControls=game.mouseControls?player.prototype.mouseControls:player.prototype.keyboardControls,player.prototype.setThrust=function(){this.x-=this.speedX,this.y-=this.speedY},player.prototype.setBoundaries=function(){this.x<this.limitX1?this.x=this.limitX2:this.x>this.limitX2?this.x=this.limitX1:this.y<this.limitY1?this.y=this.limitY1-this.speedY:this.y>this.limitY2&&(this.y=this.limitY2-this.speedY)},player.prototype.fireLasers=function(a){switch(a){case 3:this.midLaserX=Math.round(this.x+this.centerX),this.leftLaserX=Math.round(this.x+this.centerLeftX),this.rightLaserX=Math.round(this.x+this.centerRightX),this.laserY=Math.round(this.y-this.tipY),getNewBullet(this.leftLaserX,this.laserY,4,1,1,"bullet_p_laser"),getNewBullet(this.midLaserX,this.laserY,4,1,1,"bullet_p_laser"),getNewBullet(this.rightLaserX,this.laserY,4,1,1,"bullet_p_laser");break;case 2:this.leftLaserX=Math.round(this.x+this.centerLeftX),this.rightLaserX=Math.round(this.x+this.centerRightX),this.laserY=Math.round(this.y-this.tipY),getNewBullet(this.leftLaserX,this.laserY,4,1,1,"bullet_p_laser"),getNewBullet(this.rightLaserX,this.laserY,4,1,1,"bullet_p_laser");break;default:this.midLaserX=Math.round(this.x+this.centerX),this.laserY=Math.round(this.y-this.tipY),getNewBullet(this.midLaserX,this.laserY,4,1,1,"bullet_p_laser")}gameSfx.on&&gameSfx.play("laser")},player.prototype.fireMissiles=function(a){switch(a){case 3:this.midMissileX=Math.round(this.x+this.centerX),this.leftMissileX=Math.round(this.x),this.rightMissileX=Math.round(this.x+this.width),this.missileY=Math.round(this.y+this.height),getNewBullet(this.leftMissileX,this.missileY,1,2,1.03,"bullet_p_missile"),getNewBullet(this.midMissileX,this.missileY,1,2,1.03,"bullet_p_missile"),getNewBullet(this.rightMissileX,this.missileY,1,2,1.03,"bullet_p_missile");break;case 2:this.leftMissileX=Math.round(this.x),this.rightMissileX=Math.round(this.x+this.width),this.missileY=Math.round(this.y+this.height),getNewBullet(this.leftMissileX,this.missileY,1,2,1.03,"bullet_p_missile"),getNewBullet(this.rightMissileX,this.missileY,1,2,1.03,"bullet_p_missile");break;case 1:this.midMissileX=Math.round(this.x+this.centerX),this.missileY=Math.round(this.y+this.height),getNewBullet(this.midMissileX,this.missileY,1,2,1.03,"bullet_p_missile")}},player.prototype.fireGuns=function(){this.fireTimer++,this.fireTimer%this.fireRate===0&&(this.fireLasers(this.laserLevel),this.fireMissiles(this.missileLevel))},player.prototype.setImunity=function(){this.imuneTimer++,this.imuneTimer>15&&(this.imuneTicks++,this.imuneTimer=-5),this.imuneTicks>8&&(this.imune=!1,this.imuneTicks=0)},player.prototype.checkImunity=function(){this.imune&&this.setImunity()},player.prototype.detectCollision=function(){this.hit&&(this.sprite_s.currentFrame<1&&vibrateDevice(30),this.drawShields(),this.sprite_s.currentFrame>=this.sprite_s.endFrame&&(this.hit=!1,this.sprite_s.counter=0,this.sprite_s.currentFrame=0))},player.prototype.checkHull=function(){this.hull<=0&&!this.imune&&(this.lives-=1,getNewExplosion(this.x-this.width,this.y-this.centerY,0,0,4),player.prototype.update=player.prototype.die,gameUI.updateHangar(),this.imune=!0)},player.prototype.die=function(){this.deadTimer<=100&&(this.x=game.centerX,this.y=game.outerBottom,this.deadTimer++,this.deadTimer>100&&this.lives>0?this.reset():this.deadTimer>100&&0===this.lives&&!game.gameOver&&(mouseIsDown=0,game.keys[13]=!1,this.deadTimer=0,game.gameOver=!0,gameState.gameOver()))},player.prototype.levelComplete=function(){game.levelUpTimer++,game.levelUpTimer<100?(this.setControls(),this.setThrust(),this.setBoundaries(),this.checkImunity(),this.detectCollision(),this.checkHull()):game.levelUpTimer>100?(this.spriteFrame=10,this.speedX=0,this.speedY=0,this.speed=Math.round(2*this.speedLimit),this.y-=this.speed):(game.levelComplete=!0,gameState.lvlComplete(),mouseIsDown=0)},player.prototype.getSpriteFrame=function(){this.speedX>0?this.spriteFrame=this.spriteLeftFrames[this.speedX]:this.speedX<0?this.spriteFrame=this.spriteRightFrames[-this.speedX]:this.spriteFrame=10;
},player.prototype.drawShields=function(){this.sprite_s.draw(this.x-.7*this.width,this.y-.1*this.height)},player.prototype.draw=function(){this.getSpriteFrame(),this.imune?this.imuneTimer>0&&this.sprite_i.drawFrame(this.x,this.y,this.spriteFrame):this.sprite.drawFrame(this.x,this.y,this.spriteFrame)},player.prototype.aliveUpdate=function(){this.setControls(),this.setThrust(),this.setBoundaries(),this.checkImunity(),this.detectCollision(),this.checkHull(),this.draw()},player.prototype.levelCompleteUpdate=function(){this.levelComplete(),this.draw()},player.prototype.update=player.prototype.aliveUpdate;var playerShip=null;playerBullet=function(a,b,c,d,e,f){this.sprite=new sprite(f,3,1,4),this.width=this.sprite.frameWidth,this.height=this.sprite.frameHeight,this.x=Math.round(a-.5*this.width),this.y=Math.round(b-.5*this.height),this.speed=Math.round(c*game.dt*game.deltaSpeed),this.direction=-Math.PI/2,this.power=d,this.friction=e,this.vy=Math.sin(this.direction)*this.speed,this.yThrust=Math.round(this.vy*=this.friction)},playerBullet.prototype.ctx=game.context,playerBullet.prototype.reset=function(a,b,c,d,e){this.width=this.sprite.frameWidth,this.height=this.sprite.frameHeight,this.x=Math.round(a-.5*this.width),this.y=Math.round(b-.5*this.height),this.speed=Math.round(c*game.dt*game.deltaSpeed),this.power=d,this.friction=e,this.vy=Math.sin(this.direction)*this.speed,this.yThrust=Math.round(this.vy*=this.friction)},playerBullet.prototype.recycle=function(){freeBullet(this)},playerBullet.prototype.checkCollision=function(){for(var a=game.enemies.length;a--;)Collision(game.enemies[a],this)&&(game.enemies[a].hull-=this.power,game.enemies[a].hull>0&&getNewExplosion(game.enemies[a].x+game.enemies[a].centerX,game.enemies[a].y+game.enemies[a].centerY,0,1,0),this.recycle())},playerBullet.prototype.setBoundaries=function(){this.y<game.outerTop&&this.recycle()},playerBullet.prototype.setMovement=function(){this.y+=Math.round(this.vy*=this.friction)},playerBullet.prototype.draw=function(){this.sprite.draw(this.x,this.y)},playerBullet.prototype.update=function(){this.checkCollision(),this.setBoundaries(),this.setMovement(),this.draw()},getNewBullet=function(a,b,c,d,e,f){var g=null;g=game.playerBulletsPool.pop(),g.sprite.reset(f,3,1,4),g.reset(a,b,c,d,e),game.objects.push(g)},freeBullet=function(a){game.objects.splice(game.objects.indexOf(a),1),game.playerBulletsPool.push(a)},initPlayerBullets=function(){for(var a=1;a<=game.requiredPlayerBullets;a++)b=new playerBullet(null,null,null,null,null,"bullet_p_laser"),game.playerBulletsPool.push(b),game.doneObjects++},enemy=function(a,b,c,d,e,f,g){this.x=a,this.y=b,this.image=gameGfx.offCtx[f],this.width=gameGfx.offCtx[f].width,this.height=gameGfx.offCtx[f].height,this.centerX=Math.round(.5*this.width),this.centerY=Math.round(.5*this.height),this.speed=Math.round(c*game.dt*game.deltaSpeed),this.direction=d,this.hull=e,this.bullet={},this.bullet.x=null,this.bullet.y=null,this.fireRate=60*g,this.vy=Math.sin(this.direction)*this.speed,this.yThrust=Math.round(this.vy)},enemy.prototype.bulletTimer=1,enemy.prototype.hitTimer=0,enemy.prototype.collided=!1,enemy.prototype.ctx=game.context,enemy.prototype.reset=function(a,b,c,d,e,f,g){this.x=a,this.y=b,this.image=gameGfx.offCtx[f],this.width=this instanceof enemyBase?this.sprite.frameWidth:gameGfx.offCtx[f].width,this.height=this instanceof enemyBase?this.sprite.frameHeight:gameGfx.offCtx[f].height,this.centerX=Math.round(.5*this.width),this.centerY=Math.round(.5*this.height),this.speed=Math.round(c*game.dt*game.deltaSpeed),this.direction=d,this.hull=e,this.fireRate=60*g,this.bulletTimer=1,this.hitTimer=0,this.collided=!1,this.vy=Math.sin(this.direction)*this.speed,this.yThrust=Math.round(this.vy)},enemy.prototype.setMovement=function(){this.y+=this.yThrust},enemy.prototype.die=function(){getNewExplosion(this.x,this.y,this.speed/2,this.direction,this.explosionSize),lootchance=Math.random(),lootchance<.4&&getNewLoot(this.x,this.y),playerShip.crashed||(game.score++,game.levelScore++,gameUI.updateScore()),this.recycle()},enemy.prototype.checkHull=function(){this.hull<=0&&this.die()},enemy.prototype.checkCollision=function(){!Collision(this,playerShip)||playerShip.imune||game.gameOver||(getNewExplosion(playerShip.x,playerShip.y,0,1,1,"chasis"),playerShip.hull-=this.hull,gameUI.updateEnergy(),playerShip.hit=!0,this.hull-=playerShip.hull)},enemy.prototype.setBoundaries=function(){(this.x>game.outerRight||this.x<game.outerLeft||this.y>game.outerBottom||this.y<game.outerTop)&&this.recycle()},enemy.prototype.setGuns=function(){0!==this.fireRate&&(this.bulletTimer++,this.bulletTimer%this.fireRate===0&&this.fireMissile())},enemy.prototype.fireMissile=function(){this.bullet.x=this.x+this.centerX,this.bullet.y=this.y+this.height,getNewEnemyBullet(this.bullet.x,this.bullet.y,1,utils.angleTo(this.bullet,playerShip),1,"bullet_e_missile")},enemy.prototype.draw=function(){this.ctx.drawImage(this.image,this.x,this.y)},enemy.prototype.update=function(){this.checkCollision(),this.setMovement(),this.setBoundaries(),this.setGuns(),this.checkHull(),this.draw()},enemyMinion=function(a,b,c,d,e,f,g){enemy.call(this,a,b,c,d,e,f,g),this.waveAmp=1*game.deltaSpeed,this.wavePeriod=.06/game.deltaSpeed,this.direction===Math.PI/2?(this.vy=Math.sin(this.direction)*this.speed,this.yThrust=Math.round(this.vy),this.setMovement=enemyMinion.prototype.setMovementV):(this.vx=Math.cos(this.direction)*this.speed,this.xThrust=Math.round(this.vx),this.setMovement=enemyMinion.prototype.setMovementH)},enemyMinion.prototype=Object.create(enemy.prototype),enemyMinion.prototype.constructor=enemyMinion,enemyMinion.prototype.explosionSize=2,enemyMinion.prototype.reset=function(a,b,c,d,e,f,g){this.x=a,this.y=b,this.image=gameGfx.offCtx[f],this.width=gameGfx.offCtx[f].width,this.height=gameGfx.offCtx[f].height,this.centerX=Math.round(.5*this.width),this.centerY=Math.round(.5*this.height),this.speed=Math.round(c*game.dt*game.deltaSpeed),this.direction=d,this.hull=e,this.fireRate=60*g,this.bulletTimer=1,this.hitTimer=0,this.collided=!1,this.waveAmp=1*game.deltaSpeed,this.wavePeriod=.06/game.deltaSpeed,this.direction===Math.PI/2?(this.vy=Math.sin(this.direction)*this.speed,this.yThrust=Math.round(this.vy),this.setMovement=enemyMinion.prototype.setMovementV):(this.vx=Math.cos(this.direction)*this.speed,this.xThrust=Math.round(this.vx),this.setMovement=enemyMinion.prototype.setMovementH)},enemyMinion.prototype.getWaveMovementH=function(a){return this.waveAmp*Math.sin(this.wavePeriod*a)},enemyMinion.prototype.getWaveMovementV=function(a){return this.waveAmp*Math.cos(this.wavePeriod*a)},enemyMinion.prototype.setMovementH=function(){this.x+=this.xThrust,this.y+=this.getWaveMovementH(this.x)},enemyMinion.prototype.setMovementV=function(){this.y+=this.yThrust,this.x+=this.getWaveMovementV(this.y)},enemyMinion.prototype.recycle=function(){freeEnemyMinion(this)},enemyMiniBoss=function(a,b,c,d,e,f,g){enemy.call(this,a,b,c,d,e,f,g)},enemyMiniBoss.prototype=Object.create(enemy.prototype),enemyMiniBoss.prototype.constructor=enemyMiniBoss,enemyMiniBoss.prototype.explosionSize=3,enemyMiniBoss.prototype.recycle=function(){freeEnemyMiniBoss(this)},enemyBase=function(a,b,c,d,e,f,g){enemy.call(this,a,b,c,d,e,f,g),this.sprite=new sprite(f,6,5,5),this.width=this.sprite.frameWidth,this.height=this.sprite.frameHeight},enemyBase.prototype=Object.create(enemy.prototype),enemyBase.prototype.constructor=enemyBase,enemyBase.prototype.explosionSize=4,enemyBase.prototype.recycle=function(){freeEnemyBase(this)},enemyBase.prototype.draw=function(){this.sprite.draw(this.x,this.y)},enemyWave=function(a,b,c,d,e,f,g){switch(this.side=a,this.spawnedShips=0,this.race=c,this.fleetSize=d,this.speed=e,this.hull=f,this.fireRate=g,this.spawnTimer=1,this.spawnRate=6*this.speed,this.side){case"top":this.x=Math.round(b),this.y=game.outerTop,this.direction=Math.PI/2;break;case"left":this.x=game.outerLeft,this.y=Math.round(b),this.direction=0;break;case"right":this.x=game.outerRight,this.y=Math.round(b),this.direction=Math.PI}},enemyWave.prototype.recycle=function(){freeEnemyWave(this)},enemyWave.prototype.update=function(){this.spawnTimer++,this.spawnTimer%this.spawnRate===0&&(this.spawnFireRate=Math.round(utils.randomRange(this.fireRate,2*this.fireRate)),getNewEnemyMinion(this.x,this.y,this.speed,this.direction,this.hull,this.race,this.spawnFireRate),this.spawnedShips++),this.spawnedShips==this.fleetSize&&this.recycle()},boss=function(a,b,c,d,e,f){this.speed=Math.round(c*game.dt*game.deltaSpeed),this.direction=d,this.hull=e,this.image=gameGfx.offCtx[f],this.width=gameGfx.offCtx[f].width,this.height=gameGfx.offCtx[f].height,this.centerX=Math.round(.5*this.width),this.centerY=Math.round(.5*this.height),this.hCenter=Math.round(this.width/2),this.x=Math.round(game.centerX-this.hCenter),this.xBondary=Math.round(game.width-this.width),this.ctx=game.context},boss.prototype.y=game.outerTop,boss.prototype.yStop=Math.round(.05*game.height),boss.prototype.audioHit1="hit"+fileFormat,boss.prototype.audioHit2="hit2"+fileFormat,boss.prototype.audioHit3="hit3"+fileFormat,boss.prototype.deadTimer=0,boss.prototype.lasersTimer=1,boss.prototype.missilesTimer=1,boss.prototype.lasersFireRate=null,boss.prototype.missilesFireRate=null,boss.prototype.reset=function(a,b,c){this.x=a,this.y=b,this.hull=c},boss.prototype.detectCollision=function(){!Collision(playerShip,this)||playerShip.imune||game.gameOver||(playerShip.hull-=this.hull,playerShip.hit=!0,this.hull-=playerShip.hull)},boss.prototype.die=function(){getNewExplosion(this.x,this.y,this.speed/2,this.direction,4),playerShip.crashed||(game.score++,game.levelScore++,gameUI.updateScore(),gameMusic.pauseAll(),gameMusic.playTrack("victory",!1)),player.prototype.update=player.prototype.levelCompleteUpdate,this.recycle()},boss.prototype.checkHull=function(){this.hull<=0&&this.die()},boss.prototype.setGuns=function(){this.lasersTimer++,this.missilesTimer++,this.lasersTimer%this.lasersFireRate===0&&this.fireLasers(),this.missilesTimer%this.missilesFireRate===0&&this.fireMissiles()},boss.prototype.draw=function(){this.ctx.drawImage(this.image,this.x,this.y)},boss.prototype.aliveUpdate=function(){this.setMovement(),this.setGuns(),this.detectCollision(),this.checkHull(),this.draw()},boss.prototype.update=boss.prototype.aliveUpdate,sectoidBoss=function(a,b,c,d,e,f){boss.call(this,a,b,c,d,e,f),this.laser1={},this.laser2={},this.laser1.y=Math.round(this.yStop+this.height),this.laser2.y=this.laser1.y,this.laser1.offSetX=Math.round(.4*this.width),this.laser2.offSetX=Math.round(.6*this.width),this.missile1={},this.missile2={},this.missile1.y=Math.round(this.yStop+.5*this.height),this.missile2.y=this.missile1.y},sectoidBoss.prototype=Object.create(boss.prototype),sectoidBoss.prototype.constructor=sectoidBoss,sectoidBoss.prototype.lasersFireRate=40,sectoidBoss.prototype.missilesFireRate=120,sectoidBoss.prototype.fireLasers=function(){this.laser1.x=Math.round(this.x+this.laser1.offSetX),this.laser2.x=Math.round(this.x+this.laser2.offSetX),getNewEnemyBullet(this.laser1.x,this.laser1.y,4,Math.PI/2,1.5,"bullet_p_laser"),getNewEnemyBullet(this.laser2.x,this.laser2.y,4,Math.PI/2,1.5,"bullet_p_laser")},sectoidBoss.prototype.fireMissiles=function(){this.missile1.x=this.x,this.missile2.x=this.x+this.width,getNewEnemyBullet(this.missile1.x,this.missile1.y,1,utils.angleTo(this.missile1,playerShip),1,"bullet_e_missile"),getNewEnemyBullet(this.missile2.x,this.missile1.y,1,utils.angleTo(this.missile2,playerShip),1,"bullet_e_missile")},sectoidBoss.prototype.introMovement=function(){this.direction=Math.PI/2,this.vy=Math.sin(this.direction)*this.speed,this.x=this.x,this.y+=Math.round(this.vy),this.y>=this.yStop&&(sectoidBoss.prototype.setMovement=sectoidBoss.prototype.fightMovement)},sectoidBoss.prototype.setMovement=sectoidBoss.prototype.introMovement,sectoidBoss.prototype.fightMovement=function(){this.vx=Math.cos(this.direction)*this.speed,this.x+this.hCenter<playerShip.x+playerShip.centerX-this.vx?(this.direction=0,this.x+=Math.round(this.vx)):this.x+this.hCenter>playerShip.x+playerShip.centerX+this.vx?(this.direction=Math.PI,this.x+=Math.round(this.vx)):this.x+this.hCenter==playerShip.x+playerShip.centerX&&(this.x=this.x)},sectoidBoss.prototype.recycle=function(){sectoidBoss.prototype.setMovement=sectoidBoss.prototype.introMovement,freeSectoidBoss(this)},enemyBullet=function(a,b,c,d,e,f){this.sprite=new sprite(f,3,1,5),this.x=a,this.y=b,this.power=e,this.speed=Math.round(c*game.dt*game.deltaSpeed),this.direction=d,this.width=this.sprite.frameWidth,this.height=this.sprite.frameHeight,this.vx=Math.cos(this.direction)*this.speed,this.vy=Math.sin(this.direction)*this.speed,this.spriteX=-Math.round(.5*this.width),this.spriteY=-Math.round(.5*this.height)},enemyBullet.prototype.friction=1.02,enemyBullet.prototype.ctx=game.context,enemyBullet.prototype.reset=function(a,b,c,d,e){this.x=a,this.y=b,this.width=this.sprite.frameWidth,this.height=this.sprite.frameHeight,this.speed=Math.round(c*game.dt*game.deltaSpeed),this.direction=d,this.power=e,this.vx=Math.cos(this.direction)*this.speed,this.vy=Math.sin(this.direction)*this.speed},enemyBullet.prototype.recycle=function(){freeEnemyBullet(this)},enemyBullet.prototype.checkCollision=function(){!Collision(this,playerShip)||playerShip.imune||game.gameOver||(getNewExplosion(this.x,this.y,0,1,0),playerShip.hull-=this.power,gameUI.updateEnergy(),playerShip.hit=!0,this.recycle())},enemyBullet.prototype.setBoundaries=function(){(this.x>game.outerRight||this.x<game.outerLeft||this.y>game.outerBottom||this.y<game.outerTop)&&this.recycle()},enemyBullet.prototype.setMovement=function(){this.x+=this.vx*=this.friction,this.y+=this.vy*=this.friction},enemyBullet.prototype.draw=function(){this.ctx.save(),this.ctx.translate(this.x,this.y),this.ctx.rotate(this.direction-Math.PI/2),this.sprite.draw(this.spriteX,this.spriteY),this.ctx.restore()},enemyBullet.prototype.update=function(){this.checkCollision(),this.setBoundaries(),this.setMovement(),this.draw()},getNewEnemyBullet=function(a,b,c,d,e,f){var g=null;g=game.enemyBulletsPool.pop(),g.sprite.reset(f,3,1,4),g.reset(a,b,c,d,e),game.objects.push(g)},freeEnemyBullet=function(a){game.objects.splice(game.objects.indexOf(a),1),game.enemyBulletsPool.push(a)},loot=function(a,b){this.x=a,this.y=b,this.key=Math.floor(Math.random()*this.drops.length),this.type=this.drops[this.key],this.image=gameGfx.offCtx[this.type],this.width=this.image.width,this.height=this.image.height,this.vx=Math.cos(this.direction)*this.speed,this.xThrust=Math.round(this.vx),this.vy=Math.sin(this.direction)*this.speed,this.yThrust=Math.round(this.vy)},loot.prototype.speed=Math.round(1*game.dt*game.deltaSpeed),loot.prototype.direction=Math.PI/2,loot.prototype.drops=["loot_shields","loot_lasers","loot_missiles"],loot.prototype.ctx=game.context,loot.prototype.reset=function(a,b){this.x=a,this.y=b,this.key=Math.floor(Math.random()*this.drops.length),this.type=this.drops[this.key],this.image=gameGfx.offCtx[this.type],this.vx=Math.cos(this.direction)*this.speed,this.xThrust=Math.round(this.vx),this.vy=Math.sin(this.direction)*this.speed,this.yThrust=Math.round(this.vy)},loot.prototype.recycle=function(){freeLoot(this)},loot.prototype.reward=function(){switch(this.type){case"loot_shields":playerShip.hull=playerShip.hull<=7.5?playerShip.hull+2.5:playerShip.hull=10,gameUI.updateEnergy();break;case"loot_lasers":playerShip.laserLevel=playerShip.laserLevel<3?playerShip.laserLevel+1:playerShip.laserLevel;break;case"loot_missiles":playerShip.missileLevel=playerShip.missileLevel<3?playerShip.missileLevel+1:playerShip.missileLevel}},loot.prototype.setMovement=function(){this.x+=this.xThrust,this.y+=this.yThrust},loot.prototype.setBoundaries=function(){this.y>game.outerBottom&&this.recycle()},loot.prototype.checkCollision=function(){Collision(this,playerShip)&&(this.reward(),this.recycle(),gameSfx.on&&gameSfx.play("loot_powerUp"))},loot.prototype.draw=function(){this.ctx.drawImage(this.image,this.x,this.y)},loot.prototype.update=function(){this.checkCollision(),this.setMovement(),this.setBoundaries(),this.draw()},text=function(a,b,c){this.h1Text=a,this.h2Text=b,this.textInput=c,this.init()},text.prototype.h1=$("#h1"),text.prototype.h2=$("#h2"),text.prototype.h3=$("#h3"),game.isMobile?text.prototype.h3Text="Tap screen to continue":game.mouseControls?text.prototype.h3Text="Click to continue":game.keyboardControls&&(text.prototype.h3Text="Press any key to continue"),text.prototype.allText=$(".all-text"),text.prototype.effectDuration=2e3,text.prototype.switch=function(a){switch(a){case"on":this.allText.show(),game.textFaded=!1;break;case"off":this.allText.stop(!0,!0),this.allText.hide(),game.textFaded=!0}},text.prototype.fade=function(a){switch(a){case"in":game.textFadingIn=!0,this.allText.fadeIn(this.effectDuration,function(){game.textFadingIn=!1,game.textFaded=!1});break;case"out":var b=this;game.textFadingOut=!0,this.allText.fadeOut(this.effectDuration,function(){b.h1.text(""),b.h2.text(""),b.h3.text(""),game.textFadingOut=!1,game.textFaded=!0})}},text.prototype.init=function(){this.h1.text(this.h1Text),this.h2.text(this.h2Text),this.textInput?this.h3.text(this.h3Text):this.h3.text("")},gameText=new text,ui=function(){this.loadingBar=$("#loadingBar"),this.loadingBarWidth=0,this.loadingBarFiller=$("#loadingBarFiller"),this.loadingText=new text("Loading Images.. ","",!1),this.uiAll=$("#ui"),this.uiLevel=doc.getElementById("uiLevel"),this.uiScore=doc.getElementById("uiScore"),this.uiEBar=doc.getElementById("uiEBar"),this.uiHangar=doc.getElementById("uiHangarList"),this.effectDuration=800,this.loadingBarInit()},ui.prototype.loadingBarInit=function(){this.loadingText.switch("on"),this.loadingBar.show()},ui.prototype.loadingBarClose=function(){this.loadingText.switch("off"),this.loadingBar.hide()},ui.prototype.loadingBarReset=function(a){this.loadingText.h1.text(a),this.loadingBarFiller.css({width:"0"})},ui.prototype.loadingBarUpdate=function(a,b){this.loadingBarWidth=a/b*100+"%",this.loadingBarFiller.css({width:this.loadingBarWidth})},ui.prototype.updateLevel=function(){this.uiLevel.innerHTML="STAGE "+game.level},ui.prototype.updateScore=function(){this.uiScore.innerHTML="SCORE: "+game.score},ui.prototype.updateEnergy=function(){shipEnergy=playerShip.hull/playerShip.maxHull*100,shipEnergy<0&&(shipEnergy=0),shipEnergyPC=shipEnergy+"%",shipEnergy>=66?(this.uiEBar.classList.remove("eBar-red"),this.uiEBar.classList.remove("eBar-yellow"),this.uiEBar.classList.add("eBar-blue")):shipEnergy>=33&&shipEnergy<66?(this.uiEBar.classList.remove("eBar-red"),this.uiEBar.classList.add("eBar-yellow"),this.uiEBar.classList.remove("eBar-blue")):(this.uiEBar.classList.add("eBar-red"),this.uiEBar.classList.remove("eBar-yellow"),this.uiEBar.classList.remove("eBar-blue")),this.uiEBar.style.width=shipEnergyPC},ui.prototype.updateHangar=function(){switch(playerShip.lives){case 3:this.uiHangar.getElementsByTagName("li")[0].style.display="inline-block",this.uiHangar.getElementsByTagName("li")[1].style.display="inline-block",this.uiHangar.getElementsByTagName("li")[2].style.display="inline-block";break;case 2:this.uiHangar.getElementsByTagName("li")[0].style.display="none";break;case 1:this.uiHangar.getElementsByTagName("li")[1].style.display="none";break;case 0:this.uiHangar.getElementsByTagName("li")[2].style.display="none"}},ui.prototype.fade=function(a){switch(a){case"in":this.uiAll.fadeIn(this.effectDuration);break;case"out":this.uiAll.fadeOut(this.effectDuration)}},ui.prototype.updateAll=function(){this.updateLevel(),this.updateScore(),this.updateEnergy(),this.updateHangar()};var gameUI=new ui;lights=function(){this.fader=$("#fader"),this.effectDuration=2e3},lights.prototype.switch=function(a){switch(a){case"on":this.fader.hide(),game.faded=!1;break;case"off":this.fader.show(),game.faded=!0}},lights.prototype.fade=function(a){switch(a){case"in":game.fadingIn=!0,this.fader.fadeOut(this.effectDuration,function(){game.fadingIn=!1,game.faded=!1});break;case"out":game.fadingOut=!0,this.fader.fadeIn(this.effectDuration,function(){game.fadingOut=!1,game.faded=!0})}},gameLights=new lights,state=function(){},state.prototype.start=function(){vibrateDevice(15),document.getElementById("resumeGame").disabled=!0,document.getElementById("startGame").disabled=!0,gameState.pause(),gameLights.switch("off"),gameMusic.pauseAll(),removeGamePlayInput(),addStandByInput(),gameMenu.toggled&&gameMenu.toggle(),game.started?(game.score=0,game.level=1):game.started=!0,introBriefing=["Outside the galaxy","The outer space","AlphaPI 2034"],introText=new text("Stage "+game.level,introBriefing[game.level-1],!0),$(".menu-option-btn").promise().done(function(){$("#menuBackground").promise().done(function(){gameBackground.update(),introText.fade("in"),$(".all-text").promise().done(function(){removeStandByInput(),game.textFaded?(game.loaded||startGame(),addGamePlayInput(),resetGame(),gameLights.fade("in"),gameState.unPause(),document.getElementById("resumeGame").disabled=!1,document.getElementById("startGame").disabled=!1):$(document).on("mousedown touchstart keypress",function(a){$(document).off("mousedown touchstart keypress"),introText.fade("out"),$(".all-text").promise().done(function(){game.loaded||startGame(),addGamePlayInput(),resetGame(),gameLights.fade("in"),gameState.unPause(),document.getElementById("resumeGame").disabled=!1,document.getElementById("startGame").disabled=!1})})})})})},state.prototype.lvlComplete=function(){game.started=!1,removeGamePlayInput(),gameUI.fade("out"),levelUpText=new text("Stage Complete!",game.score+" enemy ships destroyed",!0),levelUpText.switch("on"),$(document).on("mousedown touchstart keypress",function(a){$(document).off("mousedown touchstart keypress"),levelUpText.fade("out"),$(".all-text").promise().done(function(){gameUI.fade("out"),gameLights.fade("out"),$("#fader").promise().done(function(){gameState.pause(),game.level++,gameState.start()})})})},state.prototype.gameOver=function(){game.started=!1,removeGamePlayInput(),gameUI.fade("out"),gameOverText=new text("Game Over",game.score+" enemy ships destroyed",!0),gameOverText.switch("on"),$(document).on("mousedown touchstart keypress",function(a){$(document).off("mousedown touchstart keypress"),gameOverText.fade("out"),$(".all-text").promise().done(function(){gameUI.fade("out"),gameLights.fade("out"),$("#fader").promise().done(function(){gameState.pause(),game.score=0,game.level=1,gameLights.fade("out"),gameMenu.toggle()})})})},state.prototype.pause=function(){game.paused=!0,gameUI.fade("out")},state.prototype.unPause=function(){game.paused=!1,gameMusic.on&&gameMusic.resumeGame(),gameUI.updateAll(),gameUI.fade("in")},gameState=new state,menu=function(){self=this,this.menuBg=$("#menuBackground"),this.resumeBtn=$("#resumeGame"),this.startBtn=$("#startGame"),this.sfxBtn=$("#toggleSound"),this.musicBtn=$("#toggleMusic"),this.ctrlsBtn=$("#toggleControls"),this.fullScrnBtn=$("#toggleFullScreen"),this.creditsBtn=$("#creditsBtn"),this.allButtons=$(".menu-option-btn"),this.animationSpeed=800,this.toggled=!1,document.getElementById("resumeGame").disabled=!1,document.getElementById("startGame").disabled=!1,document.getElementById("toggle-menu-btn").disabled=!0},menu.prototype.toggleFullScreen=function(a){vibrateDevice(15),doc.fullscreenElement||doc.mozFullScreenElement||doc.webkitFullscreenElement||doc.msFullscreenElement?doc.exitFullscreen?doc.exitFullscreen():doc.msExitFullscreen?doc.msExitFullscreen():doc.mozCancelFullScreen?doc.mozCancelFullScreen():doc.webkitExitFullscreen&&doc.webkitExitFullscreen():doc.documentElement.requestFullscreen?doc.documentElement.requestFullscreen():doc.documentElement.msRequestFullscreen?doc.documentElement.msRequestFullscreen():doc.documentElement.mozRequestFullScreen?doc.documentElement.mozRequestFullScreen():doc.documentElement.webkitRequestFullscreen&&doc.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)},menu.prototype.toggleSound=function(){vibrateDevice(15),gameSfx.on=!gameSfx.on,localStorage.prawnsSound=gameSfx.on,gameSfx.on?(this.sfxBtn.addClass("active"),this.sfxBtn.text("Sound: ON")):(this.sfxBtn.removeClass("active"),this.sfxBtn.text("Sound: OFF"))},menu.prototype.toggleMusic=function(){vibrateDevice(15),gameMusic.on=!gameMusic.on,localStorage.prawnsMusic=gameMusic.on,gameMusic.on?(this.musicBtn.addClass("active"),this.musicBtn.text("Music: ON")):(this.musicBtn.removeClass("active"),this.musicBtn.text("Music: OFF"))},menu.prototype.toggleControls=function(){game.mouseControls?(game.mouseControls=!1,game.keyboardControls=!0,this.ctrlsBtn.text("Controls: keyboard"),player.prototype.setControls=player.prototype.keyboardControls,player.prototype.setGunControls=player.prototype.setKeyboardGuns,text.prototype.h3Text="Press any key to continue"):game.keyboardControls&&(game.mouseControls=!0,game.keyboardControls=!1,this.ctrlsBtn.text("Controls: mouse"),player.prototype.setControls=player.prototype.mouseControls,player.prototype.setGunControls=player.prototype.setMouseGuns,text.prototype.h3Text=game.isMobile?"Tap screen to continue":"Click to continue"),localStorage.mouseControls=game.mouseControls,localStorage.keyboardControls=game.keyboardControls},menu.prototype.toggle=function(){var a=this;document.getElementById("toggle-menu-btn").disabled=!0,this.toggled=!this.toggled,this.toggled?(gameState.pause(),gameMusic.on&&gameMusic.pauseAll(),this.allButtons.css({display:"block"}),this.menuBg.fadeIn(this.animationSpeed),this.menuBg.promise().done(function(){game.started?("Restart"!==a.startBtn.text&&a.startBtn.text("Restart"),a.resumeBtn.animate({opacity:1,right:"-=50%"},800)):a.startBtn.text("Start"),a.startBtn.animate({opacity:1,left:"-=50%"},800),a.sfxBtn.animate({opacity:1,right:"-=50%"},800),a.musicBtn.animate({opacity:1,left:"-=50%"},800),a.fullScrnBtn.animate({opacity:1,right:"-=50%"},800),game.isMobile||a.ctrlsBtn.animate({opacity:1,left:"-=50%"},800),a.creditsBtn.animate({opacity:1,left:"-=50%"},800),document.getElementById("toggle-menu-btn").disabled=!1})):(game.started&&this.resumeBtn.animate({opacity:0,right:"+=50%"},800),this.startBtn.animate({opacity:0,left:"+=50%"},800),this.sfxBtn.animate({opacity:0,right:"+=50%"},800),this.musicBtn.animate({opacity:0,left:"+=50%"},800),this.fullScrnBtn.animate({opacity:0,right:"+=50%"},800),game.isMobile||this.ctrlsBtn.animate({opacity:0,left:"+=50%"},800),this.creditsBtn.animate({opacity:0,left:"+=50%"},800),this.allButtons.promise().done(function(){a.allButtons.hide(),a.menuBg.fadeOut(a.animationSpeed),a.menuBg.promise().done(function(){game.loaded&&!game.faded&&gameState.unPause(),document.getElementById("toggle-menu-btn").disabled=!1})}))},menu.prototype.init=function(){"true"===localStorage.prawnsSound?(this.sfxBtn.addClass("active"),this.sfxBtn.text("Sound: ON")):(this.sfxBtn.removeClass("active"),this.sfxBtn.text("Sound: OFF")),"true"===localStorage.prawnsMusic?(this.musicBtn.addClass("active"),this.musicBtn.text("Music: ON")):(this.musicBtn.removeClass("active"),this.musicBtn.text("Music: OFF")),"true"===localStorage.fullScreen?(this.fullScrnBtn.addClass("active"),this.fullScrnBtn.text("Fullscreen: ON")):(this.fullScrnBtn.removeClass("active"),this.fullScrnBtn.text("Fullscreen: OFF")),game.isMobile?this.ctrlsBtn.disabled=!0:("true"===localStorage.mouseControls&&this.ctrlsBtn.text("Controls: mouse"),"true"===localStorage.keyboardControls&&this.ctrlsBtn.text("Controls: keyboard")),this.toggle()},gameMenu=new menu;var level1={};level1.second1=function(){getNewEnemyWave("left",.3*game.width,"enemy_sectoid",1,2,1,0),getNewEnemyWave("right",.3*game.width,"enemy_sectoid",1,2,1,0)},level1.second3=function(){getNewEnemyWave("left",.5*game.height,"enemy_sectoid",1,2,1,0),getNewEnemyWave("right",.5*game.height,"enemy_sectoid",1,2,1,0)},level1.second5=function(){getNewEnemyMiniBoss(.7*game.width,game.outerTop,1,Math.PI/2,10,"enemy_floater",2)},level1.second7=function(){getNewEnemyBase(.3*game.width,game.outerTop,1,Math.PI/2,10,"enemy_base_sectoid",2)},level1.second8=function(){getNewEnemyWave("left",.3*game.height,"enemy_sectoid",4,2,1,3)},level1.second9=function(){getNewEnemyWave("right",.2*game.height,"enemy_sectoid",3,2,1,3)},level1.second10=function(){getNewEnemyWave("top",.5*game.width,"enemy_sectoid",6,2,1,3)},level1.second11=function(){getNewEnemyWave("top",.7*game.width,"enemy_sectoid",4,2,1,3)},level1.second12=function(){getNewEnemyWave("left",.2*game.height,"enemy_sectoid",3,2,1,3)},level1.second13=function(){getNewEnemyBase(.3*game.width,game.outerTop,1,Math.PI/2,10,"enemy_base_floater",2)},level1.second15=function(){gameMusic.on&&gameMusic.playTrack("tune2",!0),getNewEnemyWave("top",.2*game.width,"enemy_sectoid",2,2,1,3)},level1.second16=function(){getNewEnemyWave("top",.4*game.width,"enemy_sectoid",3,2,1,3)},level1.second17=function(){getNewEnemyWave("top",.6*game.width,"enemy_sectoid",4,2,1,3)},level1.second18=function(){getNewEnemyWave("top",.8*game.width,"enemy_sectoid",5,2,1,3)},level1.second22=function(){getNewEnemyWave("top",.3*game.width,"enemy_sectoid",4,2,1,3)},level1.second25=function(){getNewEnemyWave("left",.4*game.width,"enemy_sectoid",4,2,1,3)},level1.second27=function(){getNewEnemyWave("right",.3*game.width,"enemy_sectoid",4,2,1,3)},level1.second30=function(){getNewEnemyWave("top",.3*game.width,"enemy_sectoid",4,2,1,3)},level1.second33=function(){getNewEnemyWave("top",.6*game.width,"enemy_sectoid",4,2,1,3)},level1.second35=function(){getNewEnemyWave("right",.2*game.width,"enemy_sectoid",4,2,1,3)},level1.second37=function(){getNewEnemyMiniBoss(.2*game.width,game.outerTop,1,Math.PI/2,10,"enemy_floater",2)},level1.second38=function(){getNewEnemyMiniBoss(.4*game.width,game.outerTop,1,Math.PI/2,10,"enemy_floater",3)},level1.second39=function(){getNewEnemyMiniBoss(.6*game.width,game.outerTop,1,Math.PI/2,10,"enemy_floater",2)},level1.second40=function(){getNewEnemyMiniBoss(.8*game.width,game.outerTop,1,Math.PI/2,10,"enemy_floater",3)},level1.second41=function(){getNewEnemyMiniBoss(.5*game.width,game.outerTop,1,Math.PI/2,10,"enemy_floater",2)},level1.second42=function(){getNewEnemyMiniBoss(.2*game.width,game.outerTop,1,Math.PI/2,10,"enemy_floater",3)},level1.second43=function(){getNewEnemyMiniBoss(.4*game.width,game.outerTop,1,Math.PI/2,10,"enemy_floater",3)},level1.second44=function(){getNewEnemyMiniBoss(.6*game.width,game.outerTop,1,Math.PI/2,10,"enemy_floater",2)},level1.second45=function(){getNewEnemyMiniBoss(.8*game.width,game.outerTop,1,Math.PI/2,10,"enemy_floater",3)},level1.update=function(){game.seconds>50&&0===game.enemies.length&&!game.bossDead&&(gameMusic.on&&(gameMusic.pauseAll(),gameMusic.playTrack("boss",!0)),getNewSectoidBoss())},graphics=function(){this.self=this,this.images=[],this.doneImages=0,this.offCtx=[],this.fileExtension=!game.isMobile||game.windowHeight>900?".dkt.png":".mob.png",this.imagePaths=!game.isMobile||game.windowHeight>640?["_img/bg_level1.dkt.jpg"]:["_img/bg_level1.mob.jpg"],this.imagePaths.push("_img/player_ship"+this.fileExtension,"_img/player_ship_i"+this.fileExtension,"_img/player_shields"+this.fileExtension,"_img/enemy_sectoid"+this.fileExtension,"_img/enemy_floater"+this.fileExtension,"_img/enemy_base_sectoid"+this.fileExtension,"_img/enemy_base_floater"+this.fileExtension,"_img/boss_sectoid"+this.fileExtension,"_img/bullet_p_laser"+this.fileExtension,"_img/bullet_p_missile"+this.fileExtension,"_img/bullet_e_missile"+this.fileExtension,"_img/explosion_s0"+this.fileExtension,"_img/explosion_s1"+this.fileExtension,"_img/explosion_s2"+this.fileExtension,"_img/explosion_s3"+this.fileExtension,"_img/explosion_s4"+this.fileExtension,"_img/loot_lasers"+this.fileExtension,"_img/loot_missiles"+this.fileExtension,"_img/loot_shields"+this.fileExtension),this.requiredImages=this.imagePaths.length},graphics.prototype.loadEvent=function(a){this.removeEventListener("load",this.eventHandler,!1);var b,c,d;b=this.src.split("/").pop(),b=b.substr(0,b.indexOf("."))||b,c=doc.createElement("canvas"),c.width=Math.round(this.width),c.height=Math.round(this.height),
d=c.getContext("2d"),d.drawImage(this,0,0,c.width,c.height),a.offCtx[b]=c,a.doneImages++},graphics.prototype.checkImages=function(){var a=this.self;this.doneImages>=this.requiredImages?(gameUI.loadingBarUpdate(this.doneImages,this.requiredImages),gameUI.loadingBarReset("Loading Sfx.. "),gameSfx.init()):(gameUI.loadingBarUpdate(this.doneImages,this.requiredImages),setTimeout(function(){a.checkImages()},1))},graphics.prototype.init=function(){var a=this.self;for(var b in this.imagePaths){var c=new Image;c.eventHandler=a.loadEvent.bind(c,a),c.addEventListener("load",c.eventHandler,!1),c.src=this.imagePaths[b];var d=c.src.split("/").pop();d=d.substr(0,d.indexOf("."))||d,this.images[d]=c}this.checkImages()};var gameGfx=new graphics;soundfx=function(){this.self=this,this.on="true"===localStorage.prawnsSound,this.sfx=[],this.loadedSfx=0,this.sfxPaths=["_sounds/_sfx/laser"+fileFormat,"_sounds/_sfx/hit"+fileFormat,"_sounds/_sfx/loot_powerUp"+fileFormat,"_sounds/_sfx/explosion"+fileFormat,"_sounds/_sfx/blast"+fileFormat],this.requiredSfx=this.sfxPaths.length,this.maxPlaying=game.isMobile?3:6},soundfx.prototype.loadEvent=function(a){this.removeEventListener("canplaythrough",this.eventHandler,!1),a.loadedSfx++},soundfx.prototype.play=function(a,b){var c=b||0;c<this.maxPlaying&&(this.sfx[a+c].paused?this.sfx[a+c].play():(c++,this.play(a,c)))},soundfx.prototype.checkSfx=function(){var a=this.self;this.loadedSfx>=this.requiredSfx?(gameUI.loadingBarUpdate(this.loadedSfx,this.requiredSfx),gameUI.loadingBarReset("Loading Sound Tracks.. "),gameMusic.init()):(gameUI.loadingBarUpdate(this.loadedSfx,this.requiredSfx),setTimeout(function(){a.checkSfx()},1))},soundfx.prototype.chromiumFix=function(){for(var a in this.sfx)this.sfx[a].volume=0,this.sfx[a].play(),this.sfx[a].pause(),this.sfx[a].volume=1},soundfx.prototype.init=function(){var a=this.self;for(var b in this.sfxPaths)for(var c=0;c<this.maxPlaying;c++){var d=new Audio;d.src=this.sfxPaths[b];var e=d.src.split("/").pop();e=e.replace(/\.[^/.]+$/,""),this.sfx[e+c]=d,audiopreload?(this.sfx[e+c].eventHandler=a.loadEvent.bind(this.sfx[e+c],a),this.sfx[e+c].preload="auto",this.sfx[e+c].addEventListener("canplaythrough",this.sfx[e+c].eventHandler,!1)):this.loadedSfx++}this.checkSfx()};var gameSfx=new soundfx;music=function(){this.self=this,this.on="true"===localStorage.prawnsMusic,this.soundTracks=[],this.loadedSoundTracks=0,this.soundTrackPaths=["_sounds/_soundTracks/_lvl1/tune1"+fileFormat,"_sounds/_soundTracks/_lvl1/tune2"+fileFormat,"_sounds/_soundTracks/_lvl1/victory"+fileFormat,"_sounds/_soundTracks/_lvl1/boss"+fileFormat],this.requiredSoundTracks=this.soundTrackPaths.length},music.prototype.loadEvent=function(a){this.removeEventListener("canplaythrough",this.eventHandler,!1),a.loadedSoundTracks++},music.prototype.checkSoundTracks=function(){var a=this.self;this.loadedSoundTracks>=this.requiredSoundTracks?(gameUI.loadingBarUpdate(this.loadedSoundTracks,this.requiredSoundTracks),gameUI.loadingBarReset("Loading Assets.. "),initObjects(),checkObjects()):(gameUI.loadingBarUpdate(this.loadedSoundTracks,this.requiredSoundTracks),setTimeout(function(){a.checkSoundTracks()},1))},music.prototype.playTrack=function(a,b){this.soundTracks[a].play(),this.soundTracks[a].loop=b},music.prototype.pauseAll=function(){for(var a in this.soundTracks)this.soundTracks[a].pause()},music.prototype.resumeGame=function(){game.seconds<=14?this.playTrack("tune1",!0):game.bossUp?game.bossUp&&this.playTrack("boss",!0):(this.playTrack("tune1",!0),this.playTrack("tune2",!0))},music.prototype.chromiumFix=function(){for(var a in this.soundTracks)this.soundTracks[a].volume=0,this.soundTracks[a].play(),this.soundTracks[a].pause(),this.soundTracks[a].volume=1},music.prototype.init=function(){var a=this.self;for(var b in this.soundTrackPaths){var c=new Audio;c.src=this.soundTrackPaths[b];var d=c.src.split("/").pop();d=d.replace(/\.[^/.]+$/,""),this.soundTracks[d]=c,audiopreload?(this.soundTracks[d].eventHandler=a.loadEvent.bind(this.soundTracks[d],a),this.soundTracks[d].preload="auto",this.soundTracks[d].addEventListener("canplaythrough",this.soundTracks[d].eventHandler,!1)):this.loadedSoundTracks++}this.checkSoundTracks()};var gameMusic=new music;$(document).keydown(function(a){game.keys[a.keyCode?a.keyCode:a.which]=!0,game.keys[27]&&game.dtTimerSet&&!game.gameOver&&gameMenu.toggle(),game.keys[80]&&game.dtTimerSet&&!game.paused&&!game.gameOver?gameState.pause():game.keys[80]&&game.dtTimerSet&&game.paused&&!game.gameOver&&gameState.unPause()}),$(document).keyup(function(a){delete game.keys[a.keyCode?a.keyCode:a.which]}),win.addEventListener("load",windowLoadEvent,!1);var audiopreload=!1,timeout,waitTime=1e3,audioTest=new Audio;".mp3"===fileFormat?audioTest.src="data:audio/mpeg;base64,//MUxAAB6AXgAAAAAPP+c6nf//yi/6f3//MUxAMAAAIAAAjEcH//0fTX6C9Lf//0//MUxA4BeAIAAAAAAKX2/6zv//+IlR4f//MUxBMCMAH8AAAAABYWalVMQU1FMy45//MUxBUB0AH0AAAAADkuM1VVVVVVVVVV//MUxBgBUATowAAAAFVVVVVVVVVVVVVV":".m4a"===fileFormat?audioTest.src="data:audio/x-m4a;base64,AAAAGGZ0eXBNNEEgAAACAGlzb21pc28yAAAACGZyZWUAAAAfbWRhdN4EAABsaWJmYWFjIDEuMjgAAAFoAQBHAAACiG1vb3YAAABsbXZoZAAAAAB8JbCAfCWwgAAAA+gAAAAYAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAG0dHJhawAAAFx0a2hkAAAAD3wlsIB8JbCAAAAAAQAAAAAAAAAYAAAAAAAAAAAAAAAAAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAABUG1kaWEAAAAgbWRoZAAAAAB8JbCAfCWwgAAArEQAAAQAVcQAAAAAAC1oZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU291bmRIYW5kbGVyAAAAAPttaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAL9zdGJsAAAAW3N0c2QAAAAAAAAAAQAAAEttcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAACdlc2RzAAAAAAMZAAEABBFAFQAAAAABftAAAAAABQISCAYBAgAAABhzdHRzAAAAAAAAAAEAAAABAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAXAAAAAQAAABRzdGNvAAAAAAAAAAEAAAAoAAAAYHVkdGEAAABYbWV0YQAAAAAAAAAhaGRscgAAAAAAAAAAbWRpcmFwcGwAAAAAAAAAAAAAAAAraWxzdAAAACOpdG9vAAAAG2RhdGEAAAABAAAAAExhdmY1Mi42NC4y":".ogg"===fileFormat&&(audioTest.src="data:audio/ogg;base64,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lFJKKaWUUkoppZRSSimllFJKKaWUUkqppJRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoplVJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSCgCQinAAkHowoQwUGrISAEgFAACMUUopxpyDEDHmGGPQSSgpYsw5xhyUklLlHIQQUmktt8o5CCGk1FJtmXNSWosx5hgz56SkFFvNOYdSUoux5ppr7qS0VmuuNedaWqs115xzzbm0FmuuOdecc8sx15xzzjnnGHPOOeecc84FAOA0OACAHtiwOsJJ0VhgoSErAYBUAAACGaUYc8456BBSjDnnHIQQIoUYc845CCFUjDnnHHQQQqgYc8w5CCGEkDnnHIQQQgghcw466CCEEEIHHYQQQgihlM5BCCGEEEooIYQQQgghhBA6CCGEEEIIIYQQQgghhFJKCCGEEEIJoZRQAABggQMAQIANqyOcFI0FFhqyEgAAAgCAHJagUs6EQY5Bjw1BylEzDUJMOdGZYk5qMxVTkDkQnXQSGWpB2V4yCwAAgCAAIMAEEBggKPhCCIgxAABBiMwQCYVVsMCgDBoc5gHAA0SERACQmKBIu7iALgNc0MVdB0IIQhCCWBxAAQk4OOGGJ97whBucoFNU6iAAAAAAAAwA4AEA4KAAIiKaq7C4wMjQ2ODo8AgAAAAAABYA+AAAOD6AiIjmKiwuMDI0Njg6PAIAAAAAAAAAAICAgAAAAAAAQAAAAICAT2dnUwAE7AwAAAAAAAD/QwAAAgAAADuydfsFAQEBAQEACg4ODg=="),audioTest.preload="auto",audioTest.addEventListener("loadeddata",testpreload),timeout=setTimeout(testpreload,waitTime),win.requestAnimFrame=function(){return win.requestAnimationFrame||win.webkitRequestAnimationFrame||win.mozRequestAnimationFrame||win.oRequestAnimationFrame||win.msRequestAnimationFrame||function(a){win.setTimeout(a,1e3/30)}}();