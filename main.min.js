var vector={_x:1,_y:0,create:function(a,b){var c=Object.create(this);return c.setX(a),c.setY(b),c},setX:function(a){this._x=a},getX:function(){return this._x},setY:function(a){this._y=a},getY:function(){return this._y},setAngle:function(a){var b=this.getLength();this._x=Math.cos(a)*b,this._y=Math.sin(a)*b},getAngle:function(){return Math.atan2(this._y,this._x)},setLength:function(a){var b=this.getAngle();this._x=Math.cos(b)*a,this._y=Math.sin(b)*a},getLength:function(){return Math.sqrt(this._x*this._x+this._y*this._y)},add:function(a){return vector.create(this._x+a.getX(),this._y+a.getY())},subtract:function(a){return vector.create(this._x-a.getX(),this._y-a.getY())},multiply:function(a){return vector.create(this._x*a,this._y*a)},divide:function(a){return vector.create(this._x/a,this._y/a)},addTo:function(a){this._x+=a.getX(),this._y+=a.getY()},subtractFrom:function(a){this._x-=a.getX(),this._y-=a.getY()},multiplyBy:function(a){this._x*=a,this._y*=a},divideBy:function(a){this._x/=a,this._y/=a}},utils={norm:function(a,b,c){return(a-b)/(c-b)},lerp:function(a,b,c){return(c-b)*a+b},map:function(a,b,c,d,e){return utils.lerp(utils.norm(a,b,c),d,e)},clamp:function(a,b,c){return Math.min(Math.max(a,Math.min(b,c)),Math.max(b,c))},distance:function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)},distanceXY:function(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(e*e+f*f)},circleCollision:function(a,b){return utils.distance(a,b)<=a.radius+b.radius},circlePointCollision:function(a,b,c){return utils.distanceXY(a,b,c.x,c.y)<c.radius},pointInRect:function(a,b,c){return utils.inRange(a,c.x,c.x+c.width)&&utils.inRange(b,c.y,c.y+c.height)},inRange:function(a,b,c){return a>=Math.min(b,c)&&a<=Math.max(b,c)},rangeIntersect:function(a,b,c,d){return Math.max(a,b)>=Math.min(c,d)&&Math.min(a,b)<=Math.max(c,d)},rectIntersect:function(a,b){return utils.rangeIntersect(a.x,a.x+a.width,b.x,b.x+b.width)&&utils.rangeIntersect(a.y,a.y+a.height,b.y,b.y+b.height)},degreesToRads:function(a){return a/180*Math.PI},radsToDegrees:function(a){return 180*a/Math.PI},randomRange:function(a,b){return a+Math.random()*(b-a)},randomInt:function(a,b){return Math.floor(a+Math.random()*(b-a+1))},roundToPlaces:function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},roundNearest:function(a,b){return Math.round(a/b)*b},quadraticBezier:function(a,b,c,d,e){return e=e||{},e.x=Math.pow(1-d,2)*a.x+2*(1-d)*d*b.x+d*d*c.x,e.y=Math.pow(1-d,2)*a.y+2*(1-d)*d*b.y+d*d*c.y,e},cubicBezier:function(a,b,c,d,e,f){return f=f||{},f.x=Math.pow(1-e,3)*a.x+3*Math.pow(1-e,2)*e*b.x+3*(1-e)*e*e*c.x+e*e*e*d.x,f.y=Math.pow(1-e,3)*a.y+3*Math.pow(1-e,2)*e*b.y+3*(1-e)*e*e*c.y+e*e*e*d.y,f},multicurve:function(a,b){var c,d,e,f;b.moveTo(a[0].x,a[0].y);for(var g=1;g<a.length-2;g+=1)c=a[g],d=a[g+1],e=(c.x+d.x)/2,f=(c.y+d.y)/2,b.quadraticCurveTo(c.x,c.y,e,f);c=a[a.length-2],d=a[a.length-1],b.quadraticCurveTo(c.x,c.y,d.x,d.y)}},particle=function(a,b,c,d,e){this.x=a,this.y=b,this.vx=Math.cos(d)*c*dt,this.vy=Math.sin(d)*c*dt,this.mass=1,this.radius=0,this.bounce=-1,this.friction=1,this.gravity=e||0,this.springs=[],this.gravitations=[],this.addGravitation=function(a){this.removeGravitation(a),this.gravitations.push(a)},this.removeGravitation=function(a){for(var b=0;b<this.gravitations.length;b+=1)if(a===this.gravitations[b])return void this.gravitations.splice(b,1)},this.addSpring=function(a,b,c){this.removeSpring(a),this.springs.push({point:a,k:b,length:c||0})},this.removeSpring=function(a){for(var b=0;b<this.springs.length;b+=1)if(a===this.springs[b].point)return void this.springs.splice(b,1)},this.getSpeed=function(){return Math.sqrt(this.vx*this.vx+this.vy*this.vy)},this.setSpeed=function(a){var b=this.getHeading();this.vx=Math.cos(b)*a,this.vy=Math.sin(b)*a},this.getHeading=function(){return Math.atan2(this.vy,this.vx)},this.setHeading=function(a){var b=this.getSpeed();this.vx=Math.cos(a)*b,this.vy=Math.sin(a)*b},this.accelerate=function(a,b){this.vx+=a,this.vy+=b},this.update=function(){0===dt&&(this.vx=Math.cos(d)*c*dt,this.vy=Math.sin(d)*c*dt),this.handleSprings(),this.handleGravitations(),this.vx*=this.friction,this.vy*=this.friction,this.vy+=this.gravity,this.x+=this.vx,this.y+=this.vy},this.handleGravitations=function(){for(var a=0;a<this.gravitations.length;a+=1)this.gravitateTo(this.gravitations[a])},this.handleSprings=function(){for(var a=0;a<this.springs.length;a+=1){var b=this.springs[a];this.springTo(b.point,b.k,b.length)}},this.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)},this.distanceTo=function(a){var b=a.x-this.x,c=a.y-this.y;return Math.sqrt(b*b+c*c)},this.gravitateTo=function(a){var b=a.x-this.x,c=a.y-this.y,d=b*b+c*c,e=Math.sqrt(d),f=a.mass/d,g=b/e*f,h=c/e*f;this.vx+=g,this.vy+=h},this.springTo=function(a,b,c){var d=a.x-this.x,e=a.y-this.y,f=Math.sqrt(d*d+e*e),g=(f-c||0)*b;this.vx+=d/f*g,this.vy+=e/f*g}};!function(){$(document).ready(function(){function a(){if(F.attr("height",$(J).height()),G.attr("height",$(J).height()),H.attr("height",$(J).height()),I.attr("height",$(J).height()),$(J).width()<1080)F.attr("width",$(J).width()),G.attr("width",$(J).width()),H.attr("width",$(J).width()),I.attr("width",$(J).width()),E.width=$(J).width();else{var a=9*$(J).height()/16;F.attr("width",a),G.attr("width",a),H.attr("width",a),I.attr("width",a),F.css({left:.5*($(J).width()-a)}),G.css({left:.5*($(J).width()-a)}),H.css({left:.5*($(J).width()-a)}),I.css({left:.5*($(J).width()-a)}),E.width=a}E.height=$(J).height(),dtSize=.001*E.height,E.enemySpeed=X_EnemySpeed*E.height/2500,E.EnBulletSpeed=X_EnBulletSpeed*E.height/1e3,E.fullShootTimer=X_GunSpeed,E.enfullShootTimer=X_EnGunSpeed,E.shootTimer=E.fullShootTimer,E.enshootTimer=E.enfullShootTimer,E.contextText.font="bold "+.08*E.width+"px "+E.font,E.contextText.fillStyle="white",E.contextText.fillText("Loading...",.3*E.width,.47*E.height)}function b(a,c,d){particle.call(this,a),this.direction=Math.PI/2,this.section=d,this.width=E.width,this.height=E.width*(16/9)*4,this.x=0,this.y=0===this.section?-(this.height-E.height):this.y=-this.height,this.image=20+E.level,this.limits=.02*-E.height,this.update=function(){this.vx=Math.cos(this.direction)*a*dt,this.vy=Math.sin(this.direction)*a*dt,this.x+=this.vx,this.y+=this.vy},this.draw=function(){E.contextBackground.drawImage(E.images[this.image],this.x,this.y,this.width,this.height)},this.load=function(){E.background.length<1&&E.background.push(new b(150,this.image,0));for(var a in E.background)E.background[a].y>this.limits&&E.background.length<2&&E.background.push(new b(150,this.image,1)),E.background[a].y>E.height&&E.background.splice(a,1),E.background[a].update(),E.background[a].draw()}}function c(a,b,c,d,e){particle.call(this,a,b,c,d),this.x=a-.2*e,this.y=b-.2*e,this.speed=c,this.size=1.5*e,this.hitTimer=0,this.dead=!1,this.deadTime=60,this.image=3,this.frameWidth=96,this.frameHeight=96,this.startFrame=0,this.endFrame=19,this.frameSpeed=2,this.animationSequence=[],this.currentFrame=0,this.counter=0,this.fpr=Math.floor(E.images[this.image].width/this.frameWidth),this.ctx=E.contextPlayer,this.update=function(){for(this.vx=Math.cos(d)*this.speed*dt,this.vy=Math.sin(d)*this.speed*dt,this.x+=this.vx,this.y+=this.vy,this.FrameNum=this.startFrame;this.FrameNum<=this.endFrame;this.FrameNum++)this.animationSequence.push(this.FrameNum);this.counter==this.frameSpeed-1&&(this.currentFrame=(this.currentFrame+1)%this.animationSequence.length),this.counter=(this.counter+1)%this.frameSpeed,this.spriteRow=Math.floor(this.animationSequence[this.currentFrame]/this.fpr),this.spriteCol=Math.floor(this.animationSequence[this.currentFrame]%this.fpr)},this.draw=function(){this.currentFrame<=19&&this.ctx.drawImage(E.images[this.image],this.spriteCol*this.frameWidth,this.spriteRow*this.frameHeight,this.frameWidth,this.frameHeight,this.x,this.y,this.size,this.size)}}function d(a,b){particle.call(this),this.x=.46*E.width,this.y=.9*E.height,this.speed=0,this.maxSpeed=400,this.direction=-Math.PI/2,this.size=100*dtSize,this.hull=a,this.bulletspeed=X_BulletSpeed*E.height/1e3,this.image=0,this.rendered=!1,this.hit=!1,this.hitTimer=0,this.imune=!1,this.imuneTimer=0,this.dead=!1,this.deadTimer=0,this.bullets=[],this.bulletTimer=1,this.bulletDivision=b,this.laserLevel=1,this.missileLevel=0,this.lives=X_Lives,this.ctx=E.contextPlayer,this.incline=[.004*E.width,.008*E.width,.01*E.width,.012*E.width],this.steering=.08*E.width,this.update=function(){if(!N||E.levelComplete||E.paused||E.gameOver||E.gameWon?N||E.gameOver||(this.image=0,this.rendered=!1):canvasX>.25*this.size&&canvasX<=E.width-.25*this.size&&canvasY>this.size&&canvasY<=E.height-.16*this.size&&(moveRight1=canvasX>moveX&&canvasX<=moveX+this.incline[0]?!0:!1,moveRight2=canvasX>moveX+this.incline[0]&&canvasX<=moveX+this.incline[1]?!0:!1,moveRight3=canvasX>moveX+this.incline[1]&&canvasX<=moveX+this.incline[2]?!0:!1,moveRight4=canvasX>moveX+this.incline[2]&&canvasX<=moveX+this.incline[3]?!0:!1,moveRight5=canvasX>moveX+this.incline[3]?!0:!1,moveLeft1=canvasX<moveX&&canvasX>=moveX-this.incline[0]?!0:!1,moveLeft2=canvasX<moveX-this.incline[0]&&canvasX>=moveX-this.incline[1]?!0:!1,moveLeft3=canvasX<moveX-this.incline[1]&&canvasX>=moveX-this.incline[2]?!0:!1,moveLeft4=canvasX<moveX-this.incline[2]&&canvasX>=moveX-this.incline[3]?!0:!1,moveLeft5=canvasX<moveX-this.incline[3]?!0:!1,(canvasX!=moveX||canvasY!=moveY)&&(distX=moveX-canvasX,distY=moveY-canvasY,distX<this.steering&&distX>-this.steering&&(this.speed=this.maxSpeed,this.x-=distX),distX>=this.steering&&(this.speed=this.maxSpeed,this.x-=this.speed*dt),distX<=-this.steering&&(this.speed=this.maxSpeed,this.x+=this.speed*dt),distY<this.steering&&distY>-this.steering&&(this.speed=this.maxSpeed,this.y-=distY),distY>=this.steering&&(this.speed=this.maxSpeed,this.y-=this.speed*dt),distY<=-this.steering&&(this.speed=this.maxSpeed,this.y+=this.speed*dt)),this.image=moveRight1?4:moveRight2?5:moveRight3?6:moveRight4?7:moveRight5?8:moveLeft1?9:moveLeft2?10:moveLeft3?11:moveLeft4?12:moveLeft5?13:0,this.rendered=!1,moveX=this.x+.5*this.size,moveY=navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?this.y+1.7*this.size:this.y+this.size),(E.keys[37]||E.keys[65]&&!E.gameOver&&!E.gameWon)&&this.x>0&&(this.speed=this.maxSpeed,this.direction=Math.PI,this.image=13,this.rendered=!1,this.x-=this.speed*dt),(E.keys[39]||E.keys[68]&&!E.gameOver&&!E.gameWon)&&this.x<=E.width-this.size&&(this.speed=this.maxSpeed,this.direction=0,this.image=8,this.rendered=!1,this.x+=this.speed*dt),(E.keys[38]||E.keys[87]&&!E.gameOver&&!E.gameWon||E.levelComplete)&&(this.y>0||E.levelComplete)&&(this.speed=this.maxSpeed,this.direction=-Math.PI/2,this.rendered=!1,this.y-=this.speed*dt),E.keys[40]||E.keys[83]&&!E.gameOver&&!E.gameWon?this.y<=E.height-this.size&&(this.speed=this.maxSpeed,this.direction=Math.PI/2,this.rendered=!1,this.y+=this.speed*dt):this.speed=0,!E.keys[32]&&!N||this.dead||E.gameOver)this.bulletTimer=1;else if(this.bulletTimer++,this.bulletTimer%this.bulletDivision===0){switch(this.laserLevel){case 1:E.playerBullets.push(new e(this.x+.5*this.size,this.y-.2*this.size,600,-Math.PI/2,45,1,1,2,48,11)),E.sound&&E.sounds.push(new Audio("_sounds/_sfx/laser.wav"));break;case 2:E.playerBullets.push(new e(this.x+.25*this.size,this.y-.2*this.size,600,-Math.PI/2,45,1,1,2,48,11)),E.playerBullets.push(new e(this.x+.75*this.size,this.y-.2*this.size,600,-Math.PI/2,45,1,1,2,48,11)),E.sound&&E.sounds.push(new Audio("_sounds/_sfx/laser.wav"));break;default:E.playerBullets.push(new e(this.x+.25*this.size,this.y-.2*this.size,600,-Math.PI/2,45,1,1,2,48,11)),E.playerBullets.push(new e(this.x+.5*this.size,this.y-.2*this.size,600,-Math.PI/2,45,1,1,2,48,11)),E.playerBullets.push(new e(this.x+.75*this.size,this.y-.2*this.size,600,-Math.PI/2,45,1,1,2,48,11)),E.sound&&E.sounds.push(new Audio("_sounds/_sfx/laser.wav"))}switch(this.missileLevel){case 0:break;case 1:E.playerBullets.push(new e(this.x+.5*this.size,this.y+this.size,100,-Math.PI/2,45,2,1.03,20,64,2));break;case 2:E.playerBullets.push(new e(this.x,this.y+this.size,100,-Math.PI/2,45,2,1.03,20,64,2)),E.playerBullets.push(new e(this.x+this.size,this.y+this.size,100,-Math.PI/2,45,2,1.03,20,64,2));break;default:E.playerBullets.push(new e(this.x,this.y+this.size,100,-Math.PI/2,45,2,1.03,20,64,2)),E.playerBullets.push(new e(this.x+this.size,this.y+this.size,100,-Math.PI/2,45,2,1.03,20,64,2)),E.playerBullets.push(new e(this.x+.5*this.size,this.y+this.size,100,-Math.PI/2,45,2,1.03,20,64,2))}}this.hull<=0&&!this.dead&&(this.dead=!0,this.lives-=1,E.explosions.push(new c(this.x,this.y,.5*this.speed,this.direction,this.size)),E.sound&&E.sounds.push(new Audio("_sounds/blast.mp3")),gameUI.updateHangar()),this.dead&&this.deadTimer<=100&&E.lives>0&&(this.deadTimer++,this.deadTimer>100&&this.lives>0?(N=0,this.hull=a,this.dead=!1,this.x=.46*E.width,this.y=.9*E.height,this.image=0,this.rendered=!1,this.hit=!1,this.hitTimer=0,this.friction=0,this.laserLevel=1,this.missileLevel=0,gameUI.updateEnergy(),this.deadTimer=0,this.imune=!0,this.imuneTimer=0):this.deadTimer>100&&0===this.lives?(N=0,E.keys[13]=!1,this.deadTimer=0,E.gameOver=!0):(this.x=-E.width,this.y=-E.height)),this.imune&&(this.imuneTimer++,this.imuneTimer>250&&(this.imune=!1,this.imuneTimer=0))},this.draw=function(){this.dead||(!this.imune||E.faded||E.starting||E.levelComplete||(this.ctx.globalAlpha=.8,(this.imuneTimer>=0&&this.imuneTimer<15||this.imuneTimer>=20&&this.imuneTimer<35||this.imuneTimer>=40&&this.imuneTimer<55||this.imuneTimer>=70&&this.imuneTimer<75||this.imuneTimer>=90&&this.imuneTimer<95||this.imuneTimer>=110&&this.imuneTimer<115||this.imuneTimer>=130&&this.imuneTimer<135||this.imuneTimer>=150&&this.imuneTimer<155||this.imuneTimer>=160&&this.imuneTimer<175||this.imuneTimer>180)&&this.ctx.drawImage(E.images[this.image],this.x,this.y,this.size,this.size)),this.imune||(this.ctx.globalAlpha<1&&!E.faded&&!E.levelComplete&&(this.ctx.globalAlpha+=.1),this.ctx.drawImage(E.images[this.image],this.x,this.y,this.size,this.size)),this.hit&&!this.imune&&(navigator.userAgent.match(/(iPhone|Android)/)&&navigator.vibrate(30),this.hit=!1))},this.reset=function(){this.dead=!1,this.x=.46*E.width,this.y=.9*E.height,this.image=0,this.hull=a,this.rendered=!1,this.hit=!1,this.hitTimer=0,this.dead=!1,E.gameOver=!1,this.friction=0,this.bullets=[],this.laserLevel=1,this.missileLevel=0,this.lives=X_Lives}}function e(a,b,c,d,e,f,g,h,i,j){particle.call(this,a,b,c,d),this.size=e*dtSize,this.power=f,this.image=h,this.dead=!1,this.deadTime=60,this.frameWidth=i,this.frameHeight=i,this.startFrame=0,this.endFrame=j,this.frameSpeed=4,this.animationSequence=[],this.currentFrame=0,this.counter=0,this.fpr=Math.floor(E.images[this.image].width/this.frameWidth),this.image=h,this.friction=g,this.dtSet=!1,this.ctx=E.contextEnemies,this.update=function(){for(0===dt||this.dtSet||(this.vx=Math.cos(d)*c*dt,this.vy=Math.sin(d)*c*dt,this.dtSet=!0),this.vx*=this.friction,this.vy*=this.friction,this.x+=this.vx,this.y+=this.vy,this.FrameNum=this.startFrame;this.FrameNum<=this.endFrame;this.FrameNum++)this.animationSequence.push(this.FrameNum);this.counter==this.frameSpeed-1&&(this.currentFrame=(this.currentFrame+1)%this.animationSequence.length),this.counter=(this.counter+1)%this.frameSpeed,this.spriteRow=Math.floor(this.animationSequence[this.currentFrame]/this.fpr),this.spriteCol=Math.floor(this.animationSequence[this.currentFrame]%this.fpr)},this.draw=function(){this.dead||(this.ctx.save(),this.ctx.translate(this.x,this.y),this.ctx.rotate(d-Math.PI/2),this.ctx.drawImage(E.images[this.image],this.spriteCol*this.frameWidth,this.spriteRow*this.frameHeight,this.frameWidth,this.frameHeight,-this.size/2,-this.size/2,this.size,this.size),this.ctx.restore())}}function f(a,b,d,e,f,g,i,j,k){switch(particle.call(this,a,b,d,e),this.type=g,this.type){case"pawn":this.size=65*dtSize;break;case"miniboss":this.size=120*dtSize;break;case"base":this.size=170*dtSize,this.rotation=0}this.hull=f,this.image=i,this.hit=!1,this.hitTimer=0,this.dead=!1,this.bulletTimer=1,this.sheep=k||!1,this.fireRate=60*j,this.bulletDivision=this.sheep?2*this.fireRate-Math.floor(Math.random()*this.fireRate)||99999:this.bulletDivision=this.fireRate||99999,this.ctx=E.contextEnemies,this.inCanvas=!1,this.speed=d,this.direction=e,this.collided=!1,this.update=function(){this.vx=Math.cos(this.direction)*this.speed*dt,this.vy=Math.sin(this.direction)*this.speed*dt,this.x+=this.vx,this.y+=this.vy,this.hit&&this.hull>0&&(E.sound&&E.sounds.push(new Audio("_sounds/_sfx/hit.mp3")),this.hit=!1),this.hull<=0&&(this.dead=!0,E.explosions.push(new c(this.x,this.y,this.speed,this.direction,this.size)),E.sound&&E.sounds.push(new Audio("_sounds/explosion.mp3")),playerShip.crashed||(E.score++,E.levelScore++,gameUI.updateScore())),0!==this.fireRate&&(this.bulletTimer++,this.bulletTimer%this.bulletDivision==1&&(this.bulletTimer=1,bulletX=this.x+.42*this.size,bulletY=this.y+this.size,bulletDirection=this.angleTo(playerShip),E.enemyBullets.push(new h(bulletX,bulletY,50,bulletDirection,1,20)))),"base"!=this.type&&(this.direction-=utils.randomRange(-.05,.05))},this.draw=function(){"base"==this.type?this.dead||(this.rotation+=.01,this.ctx.save(),this.ctx.translate(this.x+.5*this.size,this.y+.5*this.size),this.ctx.rotate(this.rotation),this.ctx.drawImage(E.images[this.image],.5*-this.size,.5*-this.size,this.size,this.size),this.ctx.restore()):this.dead||this.ctx.drawImage(E.images[this.image],this.x,this.y,this.size,this.size)}}function g(a,b,d,e,f,g){particle.call(this,a,b,d,e),this.hull=f,this.image=g,this.size=200*dtSize,this.hit=!1,this.hitTimer=0,this.dead=!1,this.deadTimer=0,this.bulletTimer1=1,this.bulletTimer2=1,this.bulletDivision1=50,this.bulletDivision2=30,this.fireRate=0,this.context=E.contextEnemies,this.update=function(){this.bulletDirection=this.angleTo(playerShip),this.vx=Math.cos(e)*d*dt,this.vy=Math.sin(e)*d*dt,this.x+=this.vx,this.y+=this.vy,this.hit&&this.hull>0&&(E.sound&&E.sounds.push(new Audio("_sounds/_sfx/hit.mp3")),this.hit=!1),!z(playerShip,this)||this.dead||E.gameOver||(playerShip.hull-=this.hull,playerShip.hit=!0,this.hit=!0,this.hull-=playerShip.hull),this.hull<=0&&(E.explosions.push(new c(this.x,this.y,d,e,this.size)),E.sound&&E.sounds.push(new Audio("_sounds/blast.mp3")),E.music&&E.songs.push(new Audio("_sounds/victory.mp3")),playerShip.crashed||(E.score++,E.levelScore++,E.bossDead=!0,this.dead=!0)),this.bulletTimer1++,this.bulletTimer2++,this.bulletTimer1%this.bulletDivision1==1&&(this.bulletTimer1=1,E.enemyBullets.push(new h(this.x,this.y+.6*this.size,50,this.bulletDirection,1,20)),E.enemyBullets.push(new h(this.x+this.size,this.y+.6*this.size,50,this.bulletDirection,1,20))),this.bulletTimer2%this.bulletDivision2==1&&(this.bulletTimer2=1,bulletX=this.x+.48*this.size,bulletY=this.y+this.size,E.enemyBullets.push(new h(bulletX,bulletY,250,Math.PI/2,1.5,2)),E.enemyBullets.push(new h(bulletX,bulletY,250,Math.PI/2,1.5,2))),this.y>.1*E.height&&(d=0,this.x>0&&this.x<=E.width-this.size/4&&(this.x<playerShip.x?this.x+=1:this.x>playerShip.x&&(this.x-=1)))},this.draw=function(){E.contextEnemies.clearRect(this.x-this.vx,this.y-this.vy,this.size,this.size),this.dead||E.contextEnemies.drawImage(E.images[this.image],this.x,this.y,this.size,this.size)}}function h(a,b,c,d,e,f){particle.call(this,a,b,c,d),this.size=30*dtSize,this.power=e,this.image=f,this.dead=!1,this.deadTime=60,this.frameWidth=64,this.frameHeight=64,this.startFrame=0,this.endFrame=2,this.frameSpeed=5,this.animationSequence=[],this.currentFrame=0,this.counter=0,this.fpr=Math.floor(E.images[this.image].width/this.frameWidth),this.image=f,this.friction=1.02,this.dtSet=!1,this.ctx=E.contextEnemies,this.update=function(){for(0===dt||this.dtSet||(this.vx=Math.cos(d)*c*dt,this.vy=Math.sin(d)*c*dt,this.dtSet=!0),this.vx*=this.friction,this.vy*=this.friction,this.x+=this.vx,this.y+=this.vy,this.FrameNum=this.startFrame;this.FrameNum<=this.endFrame;this.FrameNum++)this.animationSequence.push(this.FrameNum);this.counter==this.frameSpeed-1&&(this.currentFrame=(this.currentFrame+1)%this.animationSequence.length),this.counter=(this.counter+1)%this.frameSpeed,this.spriteRow=Math.floor(this.animationSequence[this.currentFrame]/this.fpr),this.spriteCol=Math.floor(this.animationSequence[this.currentFrame]%this.fpr)},this.draw=function(){this.dead||(this.ctx.save(),this.ctx.translate(this.x,this.y),this.ctx.rotate(d-Math.PI/2),this.ctx.drawImage(E.images[this.image],this.spriteCol*this.frameWidth,this.spriteRow*this.frameHeight,this.frameWidth,this.frameHeight,-this.size/2,-this.size/2,this.size,this.size),this.ctx.restore())}}function j(a,b){particle.call(this,a,b),this.speed=250,this.direction=Math.PI/2,this.size=45*dtSize,this.dead=!1,this.drops=["health","laser","missile"];var c=Math.floor(Math.random()*this.drops.length);switch(this.type=this.drops[c],this.type){case"health":this.image=0;break;case"laser":this.image=2;break;case"missile":this.image=20}this.context=E.contextPlayer,this.update=function(){if(this.vx=Math.cos(this.direction)*this.speed*dt,this.vy=Math.sin(this.direction)*this.speed*dt,this.x+=this.vx,this.y+=this.vy,z(this,playerShip)&&!this.dead&&!E.gameOver){switch(this.type){case"health":this.hull<=7.5?playerShip.hull+=2.5:playerShip.hull=10,gameUI.updateEnergy();break;case"laser":playerShip.laserLevel+=1;break;case"missile":playerShip.missileLevel+=1}E.sound&&E.sounds.push(new Audio("_sounds/_sfx/loot_powerUp.mp3")),this.dead=!0}},this.draw=function(){E.contextPlayer.clearRect(this.x-this.vx,this.y-this.vy,this.size,this.size),this.dead||E.contextPlayer.drawImage(E.images[this.image],this.x,this.y,this.size,this.size)}}function k(){this.width=E.width,this.height=.04*E.height,this.enContainerWidth=.3*E.width,this.enContainerHeight=.04*E.height,this.enBarHeight=.019*E.height,this.enBarVol=.2*E.width,this.hangarShipSize=.03*E.height,this.level=E.level,this.updateLevel=function(){this.level=E.level,E.contextText.fillStyle="#FFD455",E.contextText.font=15*dtSize+"px helvetica",E.contextText.clearRect(.02*this.width,.3*this.height,.05*this.width,.35*this.height),E.contextText.fillText("S"+this.level,.02*this.width,.6*this.height)},this.updateScore=function(){this.score=E.score,E.contextText.fillStyle="#FFD455",E.contextText.font=15*dtSize+"px helvetica",E.contextText.clearRect(.1*this.width,.3*this.height,.14*this.width,.35*this.height),E.contextText.fillText("Score: "+this.score,.1*this.width,.6*this.height)},this.updateSound=function(){this.soundFx=E.sound?"ON":"OFF",navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)||(E.contextText.fillStyle="#FFD455",E.contextText.font=15*dtSize+"px helvetica",E.contextText.clearRect(.25*this.width,.3*this.height,.2*this.width,.35*this.height),E.contextText.fillText("Sound(F8): "+this.soundFx,.25*this.width,.6*this.height))},this.updateEnergy=function(){this.hull=playerShip.hull>0?playerShip.hull*E.width*.02:0,E.contextText.clearRect(.55*this.width,.2*this.height,this.enBarVol,this.enBarHeight),E.contextText.drawImage(E.images[26],.55*this.width,.18*this.height,this.hull,this.enBarHeight)},this.updateHangar=function(){for(this.hangar=playerShip.lives,E.contextText.clearRect(.83*this.width,.2*this.height,3*this.hangarShipSize,this.hangarShipSize),i=0;i<this.hangar;i++)E.contextText.drawImage(E.images[0],.82*this.width+.05*this.width*i,.2*this.height,this.hangarShipSize,this.hangarShipSize)},this.updateAll=function(){E.contextText.clearRect(0,0,this.width,1.5*this.height),E.contextText.drawImage(E.images[25],.5*this.width,.1*-this.height,this.enContainerWidth,this.enContainerHeight),this.updateLevel(),this.updateScore(),this.updateSound(),this.updateEnergy(),this.updateHangar()}}function l(){this.backgroundAlpha=0,this.enemiesAlpha=0,this.playerAlpha=0,this.textAlpha=0,this.alphaDelta=.01,this.on=function(a){switch(a=a){case"all":E.contextText.globalAlpha=1,E.contextBackground.globalAlpha=1,E.contextEnemies.globalAlpha=1,E.contextPlayer.globalAlpha=1,E.textFaded=!1,E.backgroundFaded=!1,E.enemiesFaded=!1,E.playerFaded=!1,E.faded=!1;break;case"text":E.contextText.globalAlpha=1,E.textFaded=!1;break;case"background":E.contextBackground.globalAlpha=1,E.backgroundFaded=!1;break;case"enemies":E.contextEnemies.globalAlpha=1,E.enemiesFaded=!1;break;case"player":E.contextPlayer.globalAlpha=1,E.playerFaded=!1}},this.off=function(a){switch(a=a){case"all":E.contextText.globalAlpha=0,E.contextBackground.globalAlpha=0,E.contextEnemies.globalAlpha=0,E.contextPlayer.globalAlpha=0,E.textFaded=!0,E.backgroundFaded=!0,E.enemiesFaded=!0,E.playerFaded=!0,E.faded=!0;break;case"text":E.contextText.globalAlpha=0,E.textFaded=!0;break;case"background":E.contextBackground.globalAlpha=0,E.backgroundFaded=!0;break;case"enemies":E.contextEnemies.globalAlpha=0,E.enemiesFaded=!0;break;case"player":E.contextPlayer.globalAlpha=0,E.playerFaded=!0}},this.fadeIn=function(a){switch(a=a){case"all":this.backgroundAlpha<1||this.enemiesAlpha<1||this.playerAlpha<1||this.textAlpha<1?(this.backgroundAlpha+=this.alphaDelta,this.enemiesAlpha+=this.alphaDelta,this.playerAlpha+=this.alphaDelta,this.textAlpha+=this.alphaDelta):this.backgroundAlpha>=1&&this.enemiesAlpha>=1&&this.playerAlpha>=1&&this.textAlpha>=1&&(E.contextBackground.globalAlpha=1,E.contextEnemies.globalAlpha=1,E.contextPlayer.globalAlpha=1,E.contextText.globalAlpha=1,E.backgroundFaded=!1,E.enemiesFaded=!1,E.playerFaded=!1,E.textFaded=!1,E.faded=!1),E.contextBackground.globalAlpha=this.backgroundAlpha,E.contextEnemies.globalAlpha=this.enemiesAlpha,E.contextPlayer.globalAlpha=this.playerAlpha,E.contextText.globalAlpha=this.textAlpha;break;case"text":this.textAlpha<1?this.textAlpha+=this.alphaDelta:this.textAlpha>=1&&(E.contextText.globalAlpha=1,E.textFaded=!1),E.contextText.globalAlpha=this.textAlpha;break;case"background":this.backgroundAlpha<1?this.backgroundAlpha+=this.alphaDelta:this.backgroundAlpha>=1&&(E.contextBackground.globalAlpha=1,E.backgroundFaded=!1),E.contextBackground.globalAlpha=this.backgroundAlpha;break;case"enemies":this.enemiesAlpha<1?this.enemiesAlpha+=this.alphaDelta:E.enemiesApha>=1&&(E.contextEnemies.globalAlpha=1,E.enemiesFaded=!1),E.contextEnemies.globalAlpha=this.enemiesAlpha;break;case"player":this.playerAlpha<1?this.playerAlpha+=this.alphaDelta:this.playerAlpha>=1&&(E.contextPlayer.globalAlpha=1,E.playerFaded=!1),E.contextPlayer.globalAlpha=this.playerAlpha}},this.fadeOut=function(a){switch(a=a){case"all":this.backgroundAlpha>0||this.enemiesAlpha>0||this.playerAlpha>0||this.textAlpha>0?(this.backgroundAlpha-=this.alphaDelta,this.enemiesAlpha-=this.alphaDelta,this.playerAlpha-=this.alphaDelta,this.textAlpha-=this.alphaDelta):this.backgroundAlpha<=0&&this.enemiesAlpha<=0&&this.playerAlpha<=0&&this.textAlpha<=0&&(E.contextBackground.globalAlpha=0,E.contextEnemies.globalAlpha=0,E.contextPlayer.globalAlpha=0,E.contextText.globalAlpha=0,E.backgroundFaded=!0,E.enemiesFaded=!0,E.playerFaded=!0,E.textFaded=!0,E.faded=!0),E.contextBackground.globalAlpha=this.backgroundAlpha,E.contextEnemies.globalAlpha=this.enemiesAlpha,E.contextPlayer.globalAlpha=this.playerAlpha,E.contextText.globalAlpha=this.textAlpha;break;case"text":this.textAlpha>0?this.textAlpha-=this.alphaDelta:this.textAlpha<=0&&(E.contextText.globalAlpha=0,E.textFaded=!0),E.contextText.globalAlpha=this.textAlpha;break;case"background":this.backgroundAlpha>0?this.backgroundAlpha-=this.alphaDelta:this.backgroundAlpha<=0&&(E.contextBackground.globalAlpha=0,E.backgroundFaded=!0),E.contextBackground.globalAlpha=this.backgroundAlpha;break;case"enemies":this.enemiesAlpha>0?this.enemiesAlpha-=this.alphaDelta:E.enemiesApha<=0&&(E.contextEnemies.globalAlpha=0,E.enemiesFaded=!0),E.contextEnemies.globalAlpha=this.enemiesAlpha;break;case"player":this.playerAlpha>0?this.playerAlpha-=this.alphaDelta:this.playerAlpha<=0&&(E.contextPlayer.globalAlpha=0,E.playerFaded=!0),E.contextPlayer.globalAlpha=this.playerAlpha}}}function m(){this.font="Helvetica",this.fontWeight="bold",this.fontColor0="purple",this.fontColor1="#FFD455",this.fontColor2="#FFFFFF",this.levelBriefing=["Outside the galaxy","The outer space","AlphaPI 2034"],this.gameIntro=function(){E.contextText.clearRect(0,0,E.width,E.height),A("10,000 AD",1,this.font,.06*E.width,this.fontColor0,this.fontWeight),A("No one knew they were coming",2,this.font,.05*E.width,this.fontColor1,this.fontWeight),navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?A("Tap screen to continue",3,this.font,.04*E.width,this.fontColor2,this.fontWeight):A("Press ENTER or LMB to continue",3,this.font,.04*E.width,this.fontColor2,this.fontWeight)},this.lvlIntro=function(){E.contextText.clearRect(0,0,E.width,E.height),A("Stage "+E.level,1,this.font,.06*E.width,this.fontColor1,this.fontWeight),A(this.levelBriefing[E.level-1],2,this.font,.05*E.width,this.fontColor1,this.fontWeight),navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?A("Tap screen to continue",3,this.font,.04*E.width,this.fontColor2,this.fontWeight):A("Press ENTER or LMB to continue",3,this.font,.04*E.width,this.fontColor2,this.fontWeight)},this.lvlComplete=function(){E.contextText.clearRect(0,0,E.width,E.height),A("Stage Complete!",1,this.font,.06*E.width,this.fontColor1,this.fontWeight),A(E.score+" enemy ships destroyed",2,this.font,.05*E.width,this.fontColor1,this.fontWeight),navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?A("Tap screen to continue",3,this.font,.04*E.width,this.fontColor2,this.fontWeight):A("Press ENTER or LMB to continue",3,this.font,.04*E.width,this.fontColor2,this.fontWeight)},this.gameOver=function(){E.contextText.clearRect(0,0,E.width,E.height),A("Game Over",1,this.font,.06*E.width,this.fontColor1,this.fontWeight),A(E.score+" enemy ships destroyed",2,this.font,.05*E.width,this.fontColor1,this.fontWeight),navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?A("Tap screen to restart",3,this.font,.04*E.width,this.fontColor2,this.fontWeight):A("Press ENTER or LMB to restart",3,this.font,.04*E.width,this.fontColor2,this.fontWeight)}}function n(){this.keyframe0=!0,this.keyframe1=!1,this.keyframe2=!1,this.lvlIntro=function(){gameText.lvlIntro(),this.keyframe0?(gameLights.fadeIn("text"),(!E.textFaded||E.keys[13]||N)&&(N=0,E.keys[13]=!1,E.textFaded||(this.keyframe0=!1,this.keyframe1=!0),gameLights.on("text"))):this.keyframe1?(E.keys[13]||N)&&(N=0,E.keys[13]=!1,this.keyframe1=!1,this.keyframe2=!0):this.keyframe2&&(gameLights.fadeOut("text"),(E.textFaded||E.keys[13]||N)&&(N=0,E.keys[13]=!1,E.textFaded&&(this.keyframe2=!1,this.keyframe0=!0,y(),E.lvlIntro=!1,E.lvlStart=!0),gameLights.off("text")))},this.lvlStart=function(){gameLights.fadeIn("all"),E.faded||(gameUI.updateAll(),E.lvlStart=!1)},this.lvlComplete=function(){gameText.lvlComplete(),this.keyframe0?(E.keys[13]||N)&&(N=0,E.keys[13]=!1,this.keyframe0=!1,this.keyframe1=!0):this.keyframe1&&(gameLights.fadeOut("all"),(E.faded||E.keys[13]||N)&&(N=0,E.keys[13]=!1,E.faded&&(E.lvlIntro=!0,this.keyframe0=!0,this.keyframe1=!1,E.levelComplete=!1,E.level++),gameLights.off("all")))},this.gameOver=function(){gameText.gameOver(),this.keyframe0?(E.keys[13]||N)&&(N=0,E.keys[13]=!1,this.keyframe0=!1,this.keyframe1=!0):this.keyframe1&&(gameLights.fadeOut("all"),(E.faded||E.keys[13]||N)&&(N=0,E.keys[13]=0,E.faded&&(this.keyframe0=!0,this.keyframe1=!1,E.start=!0,gameLights.on("text"),gameText.gameIntro(),E.gameOver=!1,E.paused=!0),gameLights.off("all")))},this.reset=function(){this.keyframe0=!0,this.keyframe1=!1,this.keyframe2=!1}}function o(){if(!E.keys[13]&&!N||!E.start||E.gameOver||E.gameWon||(y(),N=0,E.keys[13]=!1,E.music&&E.songs.length<1&&(E.songs.push(new Audio("_sounds/_lvl1/tune1.mp3")),E.songs[0].play(),E.songs[0].loop=!0),gameLights.off("all"),E.start=!1,E.paused=!1,gameUI.updateAll()),E.keys[27]&&(N=0,E.keys[27]=!1,playerShip.hull=0,playerShip.lives=0,E.gameOver=!0),E.keys[119]&&(E.sound=E.sound?!1:!0,gameUI.updateSound(),E.keys[119]=!1),E.keys[120])if(E.music=E.music?!1:!0,gameUI.updateSound(),E.keys[120]=!1,E.songs.length>0){for(var a in E.songs)E.songs[a].pause();E.songs=[]}else if(E.songs.length<1){E.songs.push(new Audio("_sounds/_lvl1/tune1.mp3"));for(var b in E.songs)E.songs[b].play(),E.songs[b].loop=!0
}!E.keys[80]||E.gameWon||E.gameOver||(E.paused=E.paused?!1:!0,E.keys[80]=!1),(E.keys[27]||(E.keys[13]||N)&&E.paused&&!E.start&&E.gameOver&&!E.gameWon||(E.keys[13]||N)&&E.paused&&!E.start&&E.level>=7)&&((E.lives<1||E.level>=7)&&(E.level=X_Level,E.score=0,playerShip.lives=X_Lives),y())}function p(){if(dtTimer<=30){var a=(new Date).getTime(),b=a-timeThen;dtArray.push(b),timeThen=a,dtTimer++}if(30==dtTimer){for(var d=0,e=0;e<dtArray.length-2;e++)d+=dtArray[e+2];dt=Math.round(d/dtArray.length)/1e3}if(E.timer++,E.seconds=E.timer/60||0,E.contextEnemies.clearRect(0,0,E.width,E.height),E.contextPlayer.clearRect(0,0,E.width,E.height),playerShip.update(),playerShip.draw(),E.contextBackground.clearRect(0,0,E.width,E.height),gameBackground.load(),1==E.level?q():2==E.level?q():3==E.level&&lvl3(),E.bossDead&&E.levelUpTimer<=100&&(E.levelUpTimer++,100==E.levelUpTimer&&(E.levelComplete=!0,N=0)),E.lvlIntro?gameTransition.lvlIntro():E.lvlStart?gameTransition.lvlStart():E.levelComplete?gameTransition.lvlComplete():E.gameOver&&gameTransition.gameOver(),E.playerBullets.length>=1)for(var f in E.playerBullets)E.playerBullets[f].dead||(E.playerBullets[f].update(),E.playerBullets[f].draw()),(E.playerBullets[f].dead||E.playerBullets[f].x>E.width+E.playerBullets[f].size||E.playerBullets[f].x<0-E.playerBullets[f].size||E.playerBullets[f].y>E.height+E.playerBullets[f].size||E.playerBullets[f].y<-30)&&E.playerBullets.splice(f,1);if(E.enemies.length>0){for(var g in E.enemies)E.enemies[g].update(),E.enemies[g].draw();if(E.playerBullets.length>=1)for(var h in E.enemies)for(var i in E.playerBullets)z(E.enemies[h],E.playerBullets[i])&&!E.enemies[h].dead&&(E.enemies[h].hit=!0,E.enemies[h].hull-=E.playerBullets[i].power,E.enemies[h].hull>0&&E.explosions.push(new c(E.enemies[h].x+.5*E.enemies[h].size,E.enemies[h].y+.5*E.enemies[h].size,0,1,.25*E.enemies[h].size)),E.playerBullets[i].dead=!0);for(var k in E.enemies)!z(E.enemies[k],playerShip)||E.enemies[k].dead||playerShip.imune||E.gameOver||(playerShip.hull-=E.enemies[k].hull,gameUI.updateEnergy(),playerShip.hit=!0,E.enemies[k].hit=!0,E.enemies[k].hull-=playerShip.hull);for(var l in E.enemies)(E.enemies[l].dead||E.enemies[l].y>E.height+E.enemies[l].size||E.enemies[l].x<.3*-E.width||E.enemies[l].x>1.3*E.width)&&(E.enemies[l].dead&&(lootchance=Math.random(),lootchance<.05&&E.loot.push(new j(E.enemies[l].x,E.enemies[l].y))),E.enemies.splice(l,1))}if(E.waves.length>0)for(var m in E.waves)E.waves[m].update(),E.waves[m].over&&E.waves.splice(m,1);if(E.loot.length>=1)for(var n in E.loot)E.loot[n].update(),E.loot[n].draw(),(E.loot[n].dead||E.loot[n].x>E.width+E.loot[n].size||E.loot[n].x<0-E.loot[n].size||E.loot[n].y>E.height+E.loot[n].size||E.loot[n].y<-30)&&E.loot.splice(n,1);if(E.enemyBullets.length>=1)for(var o in E.enemyBullets)E.enemyBullets[o].update(),E.enemyBullets[o].draw(),!z(E.enemyBullets[o],playerShip)||playerShip.imune||E.gameOver||(playerShip.hull-=E.enemyBullets[o].power,gameUI.updateEnergy(),playerShip.hit=!0,E.enemyBullets[o].dead=!0),(E.enemyBullets[o].dead||E.enemyBullets[o].x>E.width+E.enemyBullets[o].size||E.enemyBullets[o].x<0-E.enemyBullets[o].size||E.enemyBullets[o].y>E.height+E.enemyBullets[o].size||E.enemyBullets[o].y<-30)&&E.enemyBullets.splice(o,1);if(E.explosions.length>0){for(var p in E.explosions)E.explosions[p].update(),E.explosions[p].draw();for(var r in E.explosions)19==E.explosions[r].currentFrame&&E.explosions.splice(r,1)}if(E.sounds.length>0)for(var s in E.sounds)E.sounds[s].play(),E.sounds[s].addEventListener("ended",E.sounds.splice(s,1))}function q(){1==E.seconds&&E.waves.push(new K("left",.3*E.width,1,"pawn",1,300,1,0,!0)),1==E.seconds&&E.waves.push(new K("right",.3*E.width,1,"pawn",1,250,1,0,!0)),3==E.seconds&&E.waves.push(new K("left",.5*E.height,1,"pawn",1,250,1,0,!0)),3==E.seconds&&E.waves.push(new K("right",.5*E.height,1,"pawn",1,300,1,0,!0)),5==E.seconds&&E.enemies.push(new f(.7*E.width,.1*-E.height,80,Math.PI/2,10,"miniboss",24,2)),7==E.seconds&&E.enemies.push(new f(.3*E.width,.1*-E.height,155,Math.PI/2,10,"base",22,1)),8==E.seconds&&E.waves.push(new K("left",.3*E.height,1,"pawn",4,250,1,2,!0)),9==E.seconds&&E.waves.push(new K("right",.2*E.height,1,"pawn",3,300,1,2,!0)),10==E.seconds&&E.waves.push(new K("top",.5*E.width,1,"pawn",6,300,1,2,!0)),11==E.seconds&&E.waves.push(new K("top",.7*E.width,1,"pawn",4,300,1,2,!0)),12==E.seconds&&E.waves.push(new K("left",.2*E.height,1,"pawn",3,300,1,2,!0)),13==E.seconds&&(E.music&&(E.songs.push(new Audio("_sounds/_lvl1/tune2.mp3")),E.songs[1].play(),E.songs[1].loop=!0),E.enemies.push(new f(.3*E.width,.1*-E.height,155,Math.PI/2,10,"base",23,1))),15==E.seconds&&E.waves.push(new K("top",.2*E.width,1,"pawn",2,300,1,2,!0)),16==E.seconds&&E.waves.push(new K("top",.4*E.width,1,"pawn",3,300,1,2,!0)),17==E.seconds&&E.waves.push(new K("top",.6*E.width,1,"pawn",4,300,1,2,!0)),18==E.seconds&&E.waves.push(new K("top",.8*E.width,1,"pawn",5,300,1,2,!0)),22==E.seconds&&E.waves.push(new K("top",.3*E.width,1,"pawn",4,300,1,2,!0)),25==E.seconds&&E.waves.push(new K("left",.4*E.width,1,"pawn",4,300,1,2,!0)),27==E.seconds&&E.waves.push(new K("right",.3*E.width,1,"pawn",4,300,1,2,!0)),30==E.seconds&&E.waves.push(new K("top",.3*E.width,1,"pawn",4,300,1,2,!0)),33==E.seconds&&E.waves.push(new K("top",.6*E.width,1,"pawn",4,300,1,2,!0)),35==E.seconds&&E.waves.push(new K("right",.2*E.width,1,"pawn",4,300,1,2,!0)),37==E.seconds&&E.enemies.push(new f(.2*E.width,.1*-E.height,80,Math.PI/2,10,"miniboss",24,2)),38==E.seconds&&E.enemies.push(new f(.4*E.width,.1*-E.height,80,Math.PI/2,10,"miniboss",24,2)),39==E.seconds&&E.enemies.push(new f(.6*E.width,.1*-E.height,80,Math.PI/2,10,"miniboss",24,2)),40==E.seconds&&E.enemies.push(new f(.8*E.width,.1*-E.height,80,Math.PI/2,10,"miniboss",24,2)),41==E.seconds&&E.enemies.push(new f(.5*E.width,.1*-E.height,80,Math.PI/2,10,"miniboss",24,2)),42==E.seconds&&E.enemies.push(new f(.2*E.width,.1*-E.height,80,Math.PI/2,10,"miniboss",24,2)),43==E.seconds&&E.enemies.push(new f(.4*E.width,.1*-E.height,80,Math.PI/2,10,"miniboss",24,2)),44==E.seconds&&E.enemies.push(new f(.6*E.width,.1*-E.height,80,Math.PI/2,10,"miniboss",24,2)),45==E.seconds&&E.enemies.push(new f(.8*E.width,.1*-E.height,80,Math.PI/2,10,"miniboss",24,2)),E.seconds>50&&0===E.enemies.length&&!E.bossDead&&(E.music&&(E.songs.push(new Audio("_sounds/_lvl1/boss.mp3")),E.songs[2].play()),E.enemies.push(new g(.3*E.width,.1*-E.height,150,Math.PI/2,100,27)))}function r(){L=document.getElementById("textCanvas"),M=L.getContext("2d"),L.addEventListener("mousedown",u,!1),L.addEventListener("mouseup",s,!1),L.addEventListener("mousemove",w,!1),L.addEventListener("touchstart",v,!1),L.addEventListener("touchend",t,!1),L.addEventListener("touchcancel",t,!1),L.addEventListener("touchleave",t,!1),L.addEventListener("touchmove",x,!1)}function s(a){a&&(a.preventDefault(),N=0,w())}function t(a){a&&(a.preventDefault(),N=0)}function u(a){a&&(a.preventDefault(),N=1,w())}function v(a){a&&(a.preventDefault(),N=1,x())}function w(a){a&&(a.preventDefault(),canvasX=a.pageX-L.offsetLeft,canvasY=a.pageY-L.offsetTop)}function x(a){a&&(a.preventDefault(),canvasX=a.targetTouches[0].pageX-L.offsetLeft,canvasY=a.targetTouches[0].pageY-L.offsetTop)}function y(){gameLights.off("all"),gameTransition.reset(),N=0,E.gameOver=!1,E.gameWon=!1,E.level=E.lvlIntro?E.level:1,E.bossDead=!1,E.levelComplete=!1,E.lvlStart=!1,E.lvlIntro=!0,E.levelUpTimer=0,E.contextBackground.clearRect(0,0,E.width,E.height),E.contextPlayer.clearRect(0,0,E.width,E.height),E.contextEnemies.clearRect(0,0,E.width,E.height),E.contextText.clearRect(0,0,E.width,E.height),playerShip.reset(),gameUI.updateAll(),E.background=[],E.enemies=[],E.waves=[],E.enemyBullets=[],E.loot=[],E.delayTimer=0,E.timer=0,E.sounds=[];for(var a in E.songs)E.songs[a].pause();E.songs=[],E.music&&(E.songs.push(new Audio("_sounds/_lvl1/tune1.mp3")),E.songs[0].play(),E.songs[0].loop=!0),E.paused=!1}function z(a,b){return!(a.x>b.x+b.size||a.x+a.size<b.x||a.y>b.y+b.size||a.y+a.size<b.y)}function A(a,b,c,d,e,f){var g=a,h=g.length,i=h*d/2,j=.1*E.height,k=.5*(E.width-i),l=E.height/3.5+j*b;E.contextText.font=f+" "+d+"px "+c,E.contextText.fillStyle=e,E.contextText.fillText(g,k,l)}function B(){requestAnimFrame(B),o(),E.paused||p()}function C(a){E.requiredImages=a.length;for(var b in a){var c=new Image;c.src=a[b],E.images[b]=c,E.images[b].onload=function(){E.doneImages++}}}function D(){E.doneImages>=E.requiredImages?(gameText.gameIntro(),B()):setTimeout(function(){D()},1)}window.addEventListener("load",function(){window.applicationCache.addEventListener("updateready",function(){window.applicationCache.status==window.applicationCache.UPDATEREADY&&confirm("A new version of InVaDeRs is available. Load it?")&&window.location.reload()},!1)},!1),window.addEventListener("load",r,!1),$.ajax({type:"GET",url:"game.xml",dataType:"xml",async:!1,success:function(a){$(a).find("data").each(function(){X_Sound=parseInt($(this).find("sound").text()),X_Music=parseInt($(this).find("music").text()),X_Level=parseInt($(this).find("level").text()),X_Lives=parseInt($(this).find("player-lives").text()),X_PlayerSpeed=parseInt($(this).find("player-speed").text()),X_EnemySpeed=parseInt($(this).find("enemy-speed").text()),X_GunSpeed=parseInt($(this).find("reload-time").text()),X_EnGunSpeed=parseInt($(this).find("enreload-time").text()),X_BulletSpeed=parseInt($(this).find("bullet-speed").text()),X_EnBulletSpeed=parseInt($(this).find("enbullet-speed").text()),X_Title=$(this).find("title").text(),X_Subtitle=$(this).find("subtitle").text(),X_dt_Start=$(this).find("dt-start").text(),X_mb_Start=$(this).find("mb-start").text()})},error:function(){alert("The XML File could not be processed correctly.")}});var E={};E.stars=[],E.faded=!0,E.backgroundFaded=!0,E.enemiesFaded=!0,E.playerFaded=!0,E.textFaded=!0,E.background=[],E.score=0,E.levelScore=0,E.level=X_Level,E.bossDead=!1,E.levelComplete=!1,E.levelUpTimer=0,E.lives=X_Lives,E.keys=[],E.playerBullets=[],E.enemyBullets=[],E.enemies=[],E.waves=[],E.loot=[],E.explosions=[],dt=0,dtTimer=0,dtArray=[],timeThen=(new Date).getTime(),E.start=!0,E.lvlIntro=!0,E.lvlStart=!1,E.paused=!0,E.escaped=!1,E.gameWon=!1,E.gameOver=!1,E.delayTimer=0,E.timer=0,E.sound=X_Sound,E.music=X_Music,E.sounds=[],E.songs=[],E.images=[],E.doneImages=0,E.requiredImages=0,E.contextBackground=document.getElementById("backgroundCanvas").getContext("2d"),E.contextEnemies=document.getElementById("enemiesCanvas").getContext("2d"),E.contextPlayer=document.getElementById("playerCanvas").getContext("2d"),E.contextText=document.getElementById("textCanvas").getContext("2d");var F=$("#backgroundCanvas"),G=$("#enemiesCanvas"),H=$("#playerCanvas"),I=$("#textCanvas"),J=(F.get(0).getContext("2d"),$(F).parent());$(window).resize(a),a(),b.prototype=Object.create(particle.prototype),b.prototype.constructor=b,gameBackground=new b,c.prototype=Object.create(particle.prototype),c.prototype.constructor=c,d.prototype=Object.create(particle.prototype),d.prototype.constructor=d,playerShip=new d(10,15),e.prototype=Object.create(particle.prototype),e.prototype.constructor=e,f.prototype=Object.create(particle.prototype),f.prototype.constructor=f,g.prototype=Object.create(particle.prototype),g.prototype.constructor=g,h.prototype=Object.create(particle.prototype),h.prototype.constructor=h,j.prototype=Object.create(particle.prototype),j.prototype.constructor=j;var K=function(a,b,c,d,e,g,h,i){switch(this.side=a,this.spawnedShips=0,this.race=c,this.type=d,this.fleetSize=e,this.speed=g,this.hull=h,this.fireRate=i||0,this.spawnTimer=1,this.spawnDivision=Math.round(1500*dt),this.side){case"top":this.x=b,this.y=.1*-E.height,this.direction=Math.PI/2;break;case"left":this.x=.2*-E.width,this.y=b,this.direction=0;break;case"right":this.x=1.2*E.width,this.y=b,this.direction=Math.PI}this.over=!1,this.update=function(){this.spawnTimer++,this.spawnedShips<=this.fleetSize&&this.spawnTimer%this.spawnDivision==1&&(this.spawnTimer=1,E.enemies.push(new f(this.x,this.y,this.speed,this.direction,this.hull,this.type,this.race,this.fireRate,!0)),this.spawnedShips++),this.spawnedShips==this.fleetSize&&(this.over=!0)}};gameUI=new k,gameLights=new l,gameText=new m,gameTransition=new n,$(document).keydown(function(a){E.keys[a.keyCode?a.keyCode:a.which]=!0}),$(document).keyup(function(a){delete E.keys[a.keyCode?a.keyCode:a.which]});var L,M;canvasX=playerShip.x,canvasY=playerShip.y;var N=0;moveX=canvasX,moveY=canvasY,C(["_img/_dist/fighter/fighter.png","_img/_dist/enemies/sectoid.png","_img/_dist/laser.png","_img/_dist/explosion.png","_img/_dist/fighter/fighter_right1.png","_img/_dist/fighter/fighter_right2.png","_img/_dist/fighter/fighter_right3.png","_img/_dist/fighter/fighter_right4.png","_img/_dist/fighter/fighter_right5.png","_img/_dist/fighter/fighter_left1.png","_img/_dist/fighter/fighter_left2.png","_img/_dist/fighter/fighter_left3.png","_img/_dist/fighter/fighter_left4.png","_img/_dist/fighter/fighter_left5.png","_img/_dist/stars/star1.png","_img/_dist/stars/star2.png","_img/_dist/stars/star3.png","_img/_dist/stars/star4.png","_img/_dist/stars/star5.png","_img/_dist/stars/star6.png","_img/_dist/missile.png","_img/_dist/background/level_1.jpg","_img/_dist/enemies/_alienbase/alienbase1.png","_img/_dist/enemies/_alienbase/alienbase2.png","_img/_dist/enemies/_miniboss/floater.png","_img/_dist/ui/energyBar.png","_img/_dist/ui/energyPoint.png","_img/_dist/enemies/_bigboss/sectoidBoss.png"]),D()})}(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();