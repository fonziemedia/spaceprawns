var vector={_x:1,_y:0,create:function(a,b){var c=Object.create(this);return c.setX(a),c.setY(b),c},setX:function(a){this._x=a},getX:function(){return this._x},setY:function(a){this._y=a},getY:function(){return this._y},setAngle:function(a){var b=this.getLength();this._x=Math.cos(a)*b,this._y=Math.sin(a)*b},getAngle:function(){return Math.atan2(this._y,this._x)},setLength:function(a){var b=this.getAngle();this._x=Math.cos(b)*a,this._y=Math.sin(b)*a},getLength:function(){return Math.sqrt(this._x*this._x+this._y*this._y)},add:function(a){return vector.create(this._x+a.getX(),this._y+a.getY())},subtract:function(a){return vector.create(this._x-a.getX(),this._y-a.getY())},multiply:function(a){return vector.create(this._x*a,this._y*a)},divide:function(a){return vector.create(this._x/a,this._y/a)},addTo:function(a){this._x+=a.getX(),this._y+=a.getY()},subtractFrom:function(a){this._x-=a.getX(),this._y-=a.getY()},multiplyBy:function(a){this._x*=a,this._y*=a},divideBy:function(a){this._x/=a,this._y/=a}},utils={norm:function(a,b,c){return(a-b)/(c-b)},lerp:function(a,b,c){return(c-b)*a+b},map:function(a,b,c,d,e){return utils.lerp(utils.norm(a,b,c),d,e)},clamp:function(a,b,c){return Math.min(Math.max(a,Math.min(b,c)),Math.max(b,c))},distance:function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)},distanceXY:function(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(e*e+f*f)},circleCollision:function(a,b){return utils.distance(a,b)<=a.radius+b.radius},circlePointCollision:function(a,b,c){return utils.distanceXY(a,b,c.x,c.y)<c.radius},pointInRect:function(a,b,c){return utils.inRange(a,c.x,c.x+c.width)&&utils.inRange(b,c.y,c.y+c.height)},inRange:function(a,b,c){return a>=Math.min(b,c)&&a<=Math.max(b,c)},rangeIntersect:function(a,b,c,d){return Math.max(a,b)>=Math.min(c,d)&&Math.min(a,b)<=Math.max(c,d)},rectIntersect:function(a,b){return utils.rangeIntersect(a.x,a.x+a.width,b.x,b.x+b.width)&&utils.rangeIntersect(a.y,a.y+a.height,b.y,b.y+b.height)},degreesToRads:function(a){return a/180*Math.PI},radsToDegrees:function(a){return 180*a/Math.PI},randomRange:function(a,b){return a+Math.random()*(b-a)},randomInt:function(a,b){return Math.floor(a+Math.random()*(b-a+1))},roundToPlaces:function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},roundNearest:function(a,b){return Math.round(a/b)*b},quadraticBezier:function(a,b,c,d,e){return e=e||{},e.x=Math.pow(1-d,2)*a.x+2*(1-d)*d*b.x+d*d*c.x,e.y=Math.pow(1-d,2)*a.y+2*(1-d)*d*b.y+d*d*c.y,e},cubicBezier:function(a,b,c,d,e,f){return f=f||{},f.x=Math.pow(1-e,3)*a.x+3*Math.pow(1-e,2)*e*b.x+3*(1-e)*e*e*c.x+e*e*e*d.x,f.y=Math.pow(1-e,3)*a.y+3*Math.pow(1-e,2)*e*b.y+3*(1-e)*e*e*c.y+e*e*e*d.y,f},multicurve:function(a,b){var c,d,e,f;b.moveTo(a[0].x,a[0].y);for(var g=1;g<a.length-2;g+=1)c=a[g],d=a[g+1],e=(c.x+d.x)/2,f=(c.y+d.y)/2,b.quadraticCurveTo(c.x,c.y,e,f);c=a[a.length-2],d=a[a.length-1],b.quadraticCurveTo(c.x,c.y,d.x,d.y)}},particle=function(a,b,c,d,e){this.x=a,this.y=b,this.vx=Math.cos(d)*c*dt,this.vy=Math.sin(d)*c*dt,this.mass=1,this.radius=0,this.bounce=-1,this.friction=1,this.gravity=e||0,this.springs=[],this.gravitations=[],this.addGravitation=function(a){this.removeGravitation(a),this.gravitations.push(a)},this.removeGravitation=function(a){for(var b=0;b<this.gravitations.length;b+=1)if(a===this.gravitations[b])return void this.gravitations.splice(b,1)},this.addSpring=function(a,b,c){this.removeSpring(a),this.springs.push({point:a,k:b,length:c||0})},this.removeSpring=function(a){for(var b=0;b<this.springs.length;b+=1)if(a===this.springs[b].point)return void this.springs.splice(b,1)},this.getSpeed=function(){return Math.sqrt(this.vx*this.vx+this.vy*this.vy)},this.setSpeed=function(a){var b=this.getHeading();this.vx=Math.cos(b)*a,this.vy=Math.sin(b)*a},this.getHeading=function(){return Math.atan2(this.vy,this.vx)},this.setHeading=function(a){var b=this.getSpeed();this.vx=Math.cos(a)*b,this.vy=Math.sin(a)*b},this.accelerate=function(a,b){this.vx+=a,this.vy+=b},this.update=function(){0===dt&&(this.vx=Math.cos(d)*c*dt,this.vy=Math.sin(d)*c*dt),this.handleSprings(),this.handleGravitations(),this.vx*=this.friction,this.vy*=this.friction,this.vy+=this.gravity,this.x+=this.vx,this.y+=this.vy},this.handleGravitations=function(){for(var a=0;a<this.gravitations.length;a+=1)this.gravitateTo(this.gravitations[a])},this.handleSprings=function(){for(var a=0;a<this.springs.length;a+=1){var b=this.springs[a];this.springTo(b.point,b.k,b.length)}},this.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)},this.distanceTo=function(a){var b=a.x-this.x,c=a.y-this.y;return Math.sqrt(b*b+c*c)},this.gravitateTo=function(a){var b=a.x-this.x,c=a.y-this.y,d=b*b+c*c,e=Math.sqrt(d),f=a.mass/d,g=b/e*f,h=c/e*f;this.vx+=g,this.vy+=h},this.springTo=function(a,b,c){var d=a.x-this.x,e=a.y-this.y,f=Math.sqrt(d*d+e*e),g=(f-c||0)*b;this.vx+=d/f*g,this.vy+=e/f*g}};!function(){$(document).ready(function(){function a(){if(B.attr("height",$(F).height()),C.attr("height",$(F).height()),D.attr("height",$(F).height()),E.attr("height",.1*$(F).height()),$(F).width()<1080)B.attr("width",$(F).width()),C.attr("width",$(F).width()),D.attr("width",$(F).width()),E.attr("width",$(F).width()),A.width=$(F).width();else{var a=9*$(F).height()/16;B.attr("width",a),C.attr("width",a),D.attr("width",a),E.attr("width",a),B.css({left:.5*($(F).width()-a)}),C.css({left:.5*($(F).width()-a)}),D.css({left:.5*($(F).width()-a)}),E.css({left:.5*($(F).width()-a)}),A.width=a}A.height=$(F).height(),dtSize=.001*A.height,A.enemySpeed=X_EnemySpeed*A.height/2500,A.EnBulletSpeed=X_EnBulletSpeed*A.height/1e3,A.fullShootTimer=X_GunSpeed,A.enfullShootTimer=X_EnGunSpeed,A.shootTimer=A.fullShootTimer,A.enshootTimer=A.enfullShootTimer,A.contextBackground.font="bold "+.08*A.width+"px "+A.font,A.contextBackground.fillStyle="white",A.contextBackground.fillText("Loading...",.3*A.width,.47*A.height)}function b(a,b,c){switch(particle.call(this,a),this.direction=Math.PI/2,this.section=c,this.width=A.width,this.height=A.width*(16/9)*4,this.x=0,this.section){case 0:this.y=-(this.height-A.height);break;case 1:this.y=-this.height}this.image=b,this.update=function(){this.vx=Math.cos(this.direction)*a*dt,this.vy=Math.sin(this.direction)*a*dt,this.handleSprings(),this.handleGravitations(),this.vx*=this.friction,this.vy*=this.friction,this.vy+=this.gravity,this.x+=this.vx,this.y+=this.vy},this.draw=function(){A.contextBackground.drawImage(A.images[this.image],this.x,this.y,this.width,this.height)}}function c(a,b,c,d,e){particle.call(this,a,b,c,d),this.x=a-.2*e,this.y=b-.2*e,this.speed=c,this.size=1.5*e,this.hitTimer=0,this.dead=!1,this.deadTime=60,this.image=3,this.frameWidth=96,this.frameHeight=96,this.startFrame=0,this.endFrame=19,this.frameSpeed=2,this.animationSequence=[],this.currentFrame=0,this.counter=0,this.fpr=Math.floor(A.images[this.image].width/this.frameWidth),this.update=function(){for(this.vx=Math.cos(d)*this.speed*dt,this.vy=Math.sin(d)*this.speed*dt,this.vx*=this.friction,this.vy*=this.friction,this.vy+=this.gravity,this.x+=this.vx,this.y+=this.vy,this.FrameNum=this.startFrame;this.FrameNum<=this.endFrame;this.FrameNum++)this.animationSequence.push(this.FrameNum);this.counter==this.frameSpeed-1&&(this.currentFrame=(this.currentFrame+1)%this.animationSequence.length),this.counter=(this.counter+1)%this.frameSpeed,this.spriteRow=Math.floor(this.animationSequence[this.currentFrame]/this.fpr),this.spriteCol=Math.floor(this.animationSequence[this.currentFrame]%this.fpr)},this.draw=function(){this.currentFrame<=19&&A.contextPlayer.drawImage(A.images[this.image],this.spriteCol*this.frameWidth,this.spriteRow*this.frameHeight,this.frameWidth,this.frameHeight,this.x,this.y,this.size,this.size)}}function d(a,b){particle.call(this),this.x=.46*A.width,this.y=.9*A.height,this.speed=400,this.direction=-Math.PI/2,this.size=100*dtSize,this.hull=a,this.bulletspeed=X_BulletSpeed*A.height/1e3,this.image=0,this.rendered=!1,this.hit=!1,this.hitTimer=0,this.dead=!1,this.deadTime=60,this.friction=0,this.bullets=[],this.bulletTimer=b-1,this.bulletDivision=b,this.laserLevel=1,this.missileLevel=0,this.lives=3,this.update=function(){if(this.vx=Math.cos(this.direction)*this.speed*dt,this.vy=Math.sin(this.direction)*this.speed*dt,this.handleSprings(),this.handleGravitations(),this.vx*=this.friction,this.vy*=this.friction,this.vy+=this.gravity,!P||A.paused||A.gameOver||A.gameWon||canvasX>this.size/4&&canvasX<=A.width-this.size/4&&canvasY>this.size&&canvasY<=A.height-this.size/6&&(moveRight1=canvasX>moveX&&canvasX<=moveX+2?!0:!1,moveRight2=canvasX>moveX+2&&canvasX<=moveX+4?!0:!1,moveRight3=canvasX>moveX+4&&canvasX<=moveX+6?!0:!1,moveRight4=canvasX>moveX+6&&canvasX<=moveX+8?!0:!1,moveRight5=canvasX>moveX+8?!0:!1,moveLeft1=canvasX<moveX&&canvasX>=moveX-2?!0:!1,moveLeft2=canvasX<moveX-2&&canvasX>=moveX-4?!0:!1,moveLeft3=canvasX<moveX-4&&canvasX>=moveX-6?!0:!1,moveLeft4=canvasX<moveX-6&&canvasX>=moveX-8?!0:!1,moveLeft5=canvasX<moveX-8?!0:!1,(canvasX!=moveX||canvasY!=moveY)&&(distX=moveX-canvasX,distY=moveY-canvasY,distX<10&&distX>-10?this.x-=distX:distX>=10?this.x-=this.speed*dt:distX<=-10&&(this.x+=this.speed*dt),distY<10&&distY>-10?this.y-=distY:distY>=10?this.y-=this.speed*dt:distY<=-10&&(this.y+=this.speed*dt)),this.image=moveRight1?4:moveRight2?5:moveRight3?6:moveRight4?7:moveRight5?8:moveLeft1?9:moveLeft2?10:moveLeft3?11:moveLeft4?12:moveLeft5?13:0,this.rendered=!1,moveX=this.x+.5*this.size,moveY=this.y+1.5*this.size),P||A.gameOver||(this.image=0,this.rendered=!1),A.keys[37]||A.keys[65]&&!A.gameOver&&!A.gameWon?this.x>this.size/50&&(this.friction=1,this.direction=Math.PI,this.image=13,this.rendered=!1):A.keys[39]||A.keys[68]&&!A.gameOver&&!A.gameWon?this.x<=A.width-this.size&&(this.friction=1,this.direction=0,this.image=8,this.rendered=!1):A.keys[38]||A.keys[87]&&!A.gameOver&&!A.gameWon?this.y>this.size/12&&(this.friction=1,this.direction=-Math.PI/2,this.rendered=!1):A.keys[40]||A.keys[83]&&!A.gameOver&&!A.gameWon?this.y<=A.height-this.size&&(this.friction=1,this.direction=Math.PI/2,this.rendered=!1):this.friction=0,!A.keys[32]&&!P||A.gameOver)this.bulletTimer=b-1;else if(this.bulletTimer++,this.bulletTimer%this.bulletDivision===0){switch(this.laserLevel){case 1:this.bullets.push(new e(playerShip.x+.5*playerShip.size,playerShip.y-.2*playerShip.size,600,-Math.PI/2,45,100,1,2,48,11));break;case 2:this.bullets.push(new e(playerShip.x+.25*playerShip.size,playerShip.y-.2*playerShip.size,600,-Math.PI/2,45,100,1,2,48,11)),this.bullets.push(new e(playerShip.x+.75*playerShip.size,playerShip.y-.2*playerShip.size,600,-Math.PI/2,45,100,1,2,48,11));break;default:this.bullets.push(new e(playerShip.x+.25*playerShip.size,playerShip.y-.2*playerShip.size,600,-Math.PI/2,45,100,1,2,48,11)),this.bullets.push(new e(playerShip.x+.5*playerShip.size,playerShip.y-.2*playerShip.size,600,-Math.PI/2,45,100,1,2,48,11)),this.bullets.push(new e(playerShip.x+.75*playerShip.size,playerShip.y-.2*playerShip.size,600,-Math.PI/2,45,100,1,2,48,11))}switch(this.missileLevel){case 0:break;case 1:this.bullets.push(new e(playerShip.x+.5*playerShip.size,playerShip.y+playerShip.size,100,-Math.PI/2,45,200,1.03,20,64,2));break;case 2:this.bullets.push(new e(playerShip.x,playerShip.y+playerShip.size,100,-Math.PI/2,45,200,1.03,20,64,2)),this.bullets.push(new e(playerShip.x+playerShip.size,playerShip.y+playerShip.size,100,-Math.PI/2,45,200,1.03,20,64,2));break;default:this.bullets.push(new e(playerShip.x,playerShip.y+playerShip.size,100,-Math.PI/2,45,200,1.03,20,64,2)),this.bullets.push(new e(playerShip.x+playerShip.size,playerShip.y+playerShip.size,100,-Math.PI/2,45,200,1.03,20,64,2)),this.bullets.push(new e(playerShip.x+.5*playerShip.size,playerShip.y+playerShip.size,100,-Math.PI/2,45,200,1.03,20,64,2))}"ON"==gameUI.soundFx&&A.shootSound.play(),this.bulletTimer=1}if(this.bullets.length>=1)for(var d in this.bullets)this.bullets[d].update(),(this.bullets.dead||this.bullets[d].x>A.width+this.bullets[d].size||this.bullets[d].x<0-this.bullets[d].size||this.bullets[d].y>A.height+this.bullets[d].size||this.bullets[d].y<-30)&&this.bullets.splice(d,1);this.hull<=0?(A.explosions.push(new c(this.x,this.y,.5*this.speed,this.direction,this.size)),this.dead=!0,"ON"==gameUI.soundFx&&A.playerexplodeSound.play(),v(),this.lives-=1,this.hull=a):this.hull>1e3&&(this.hull=1e3),this.vx=Math.cos(this.direction)*this.speed,this.vy=Math.sin(this.direction)*this.speed},this.draw=function(){for(var a in this.bullets)this.bullets[a].draw();if(!this.dead&&(A.contextPlayer.drawImage(A.images[this.image],this.x,this.y,this.size,this.size),this.hit)){this.hitTimer++,navigator.vibrate(30);for(var b=A.contextPlayer.getImageData(this.x,this.y,this.size,this.size),c=b.data,d=0;d<c.length;d+=4){{c[d],c[d+1],c[d+2]}c[d]=c[d+1]=c[d+2]=255}A.contextPlayer.putImageData(b,this.x,this.y),this.hitTimer>4&&(this.hit=!1,this.hitTimer=0)}},this.reset=function(){playerShip.dead=!1,this.x=.46*A.width,this.y=.9*A.height,this.image=0,this.hull=a,this.rendered=!1,this.hit=!1,this.hitTimer=0,this.dead=!1,this.deadTime=60,this.friction=0,this.bullets=[],this.laserLevel=1,this.missileLevel=0,this.lives=3}}function e(a,b,c,d,e,f,g,h,i,j){particle.call(this,a,b,c,d),this.size=e*dtSize,this.power=f,this.image=h,this.dead=!1,this.deadTime=60,this.frameWidth=i,this.frameHeight=i,this.startFrame=0,this.endFrame=j,this.frameSpeed=4,this.animationSequence=[],this.currentFrame=0,this.counter=0,this.fpr=Math.floor(A.images[this.image].width/this.frameWidth),this.image=h,this.friction=g,this.dtSet=!1,this.update=function(){for(0===dt||this.dtSet||(this.vx=Math.cos(d)*c*dt,this.vy=Math.sin(d)*c*dt,this.dtSet=!0),this.vx*=this.friction,this.vy*=this.friction,this.x+=this.vx,this.y+=this.vy,this.FrameNum=this.startFrame;this.FrameNum<=this.endFrame;this.FrameNum++)this.animationSequence.push(this.FrameNum);this.counter==this.frameSpeed-1&&(this.currentFrame=(this.currentFrame+1)%this.animationSequence.length),this.counter=(this.counter+1)%this.frameSpeed,this.spriteRow=Math.floor(this.animationSequence[this.currentFrame]/this.fpr),this.spriteCol=Math.floor(this.animationSequence[this.currentFrame]%this.fpr)},this.draw=function(){this.dead||(A.contextPlayer.save(),A.contextPlayer.translate(this.x,this.y),A.contextPlayer.rotate(d-Math.PI/2),A.contextPlayer.drawImage(A.images[this.image],this.spriteCol*this.frameWidth,this.spriteRow*this.frameHeight,this.frameWidth,this.frameHeight,-this.size/2,-this.size/2,this.size,this.size),A.contextPlayer.restore())}}function f(a,b,d,e,f,g){particle.call(this,a,b,d,e),this.size=65*dtSize,this.hull=f,this.image=g,this.hit=!1,this.hitTimer=0,this.dead=!1,this.deadTime=60,this.update=function(){this.vx=Math.cos(e)*d*dt,this.vy=Math.sin(e)*d*dt,this.handleSprings(),this.handleGravitations(),this.vx*=this.friction,this.vy*=this.friction,this.vy+=this.gravity,this.x+=this.vx,this.y+=this.vy,!u(playerShip,this)||this.dead||A.gameOver||(playerShip.hull-=this.hull,playerShip.hit=!0,this.hit=!0,this.hull-=playerShip.hull),this.hull<=0&&(this.dead=!0,A.explosions.push(new c(this.x,this.y,d,e,this.size)),"ON"==A.soundStatus&&A.enemyexplodeSound.play(),playerShip.crashed||(A.score++,A.levelScore++))},this.draw=function(){if(A.contextEnemies.clearRect(this.x-this.vx,this.y-this.vy,this.size,this.size),!this.dead&&(A.contextEnemies.drawImage(A.images[this.image],this.x,this.y,this.size,this.size),this.hit)){this.hitTimer++;for(var a=A.contextEnemies.getImageData(this.x,this.y,this.size,this.size),b=a.data,c=0;c<b.length;c+=4){{b[c],b[c+1],b[c+2]}b[c]=b[c+1]=b[c+2]=255}A.contextEnemies.putImageData(a,this.x,this.y),this.hitTimer>4&&(this.hit=!1,this.hitTimer=0)}}}function g(a,b,c,d,e,f){particle.call(this,a,b,c,d),this.size=30*dtSize,this.power=e,this.image=f,this.dead=!1,this.deadTime=60,this.frameWidth=64,this.frameHeight=64,this.startFrame=0,this.endFrame=2,this.frameSpeed=5,this.animationSequence=[],this.currentFrame=0,this.counter=0,this.fpr=Math.floor(A.images[this.image].width/this.frameWidth),this.image=f,this.friction=1.02,this.dtSet=!1,this.update=function(){for(0===dt||this.dtSet||(this.vx=Math.cos(d)*c*dt,this.vy=Math.sin(d)*c*dt,this.dtSet=!0),this.vx*=this.friction,this.vy*=this.friction,this.x+=this.vx,this.y+=this.vy,this.FrameNum=this.startFrame;this.FrameNum<=this.endFrame;this.FrameNum++)this.animationSequence.push(this.FrameNum);this.counter==this.frameSpeed-1&&(this.currentFrame=(this.currentFrame+1)%this.animationSequence.length),this.counter=(this.counter+1)%this.frameSpeed,this.spriteRow=Math.floor(this.animationSequence[this.currentFrame]/this.fpr),this.spriteCol=Math.floor(this.animationSequence[this.currentFrame]%this.fpr),u(this,playerShip)&&!A.gameOver&&(playerShip.hull-=this.power,playerShip.hit=!0,this.dead=!0)},this.draw=function(){this.dead||(A.contextPlayer.save(),A.contextPlayer.translate(this.lastX,this.lastY),A.contextPlayer.rotate(d-Math.PI/2),A.contextPlayer.clearRect(-this.size/2,-this.size/2,this.size,this.size),A.contextPlayer.restore(),A.contextPlayer.save(),A.contextPlayer.translate(this.x,this.y),A.contextPlayer.rotate(d-Math.PI/2),A.contextPlayer.drawImage(A.images[this.image],this.spriteCol*this.frameWidth,this.spriteRow*this.frameHeight,this.frameWidth,this.frameHeight,-this.size/2,-this.size/2,this.size,this.size),A.contextPlayer.restore())}}function h(a,b){particle.call(this,a,b),this.speed=250,this.direction=Math.PI/2,this.size=45*dtSize,this.dead=!1,this.drops=["health","laser","missile"];var c=Math.floor(Math.random()*this.drops.length);switch(this.type=this.drops[c],this.type){case"health":this.image=0;break;case"laser":this.image=2;break;case"missile":this.image=20}this.update=function(){if(this.vx=Math.cos(this.direction)*this.speed*dt,this.vy=Math.sin(this.direction)*this.speed*dt,this.handleSprings(),this.handleGravitations(),this.vx*=this.friction,this.vy*=this.friction,this.vy+=this.gravity,this.x+=this.vx,this.y+=this.vy,u(playerShip,this)&&!this.dead&&!A.gameOver){switch(this.type){case"health":playerShip.hull+=250;break;case"laser":playerShip.laserLevel+=1;break;case"missile":playerShip.missileLevel+=1}this.dead=!0}},this.draw=function(){A.contextEnemies.clearRect(this.x-this.vx,this.y-this.vy,this.size,this.size),this.dead||A.contextEnemies.drawImage(A.images[this.image],this.x,this.y,this.size,this.size)}}function j(){this.width=A.width,this.height=.025*A.height,this.textColor="#FFD455",this.font="px helvetica",this.fontSize=15*dtSize,this.hangarShipSize=.03*A.height,this.update=function(){for(this.level=A.level,this.score=A.score,this.soundFx=A.sound?"ON":"OFF",this.hangar=playerShip.lives,this.hull=playerShip.hull,A.contextText.fillStyle=this.textColor,A.contextText.font=this.fontSize+this.font,A.contextText.clearRect(0,0,this.width,1.5*this.height),A.contextText.fillText("Level: "+this.level,.02*this.width,this.height),A.contextText.fillText("Score: "+this.score,.15*this.width,this.height),navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)||A.contextText.fillText("Sound(F8): "+this.soundFx,.35*this.width,this.height),A.contextText.fillText("Hull: "+this.hull,.6*this.width,this.height),A.contextText.fillText("Hangar: ",.8*this.width,this.height),i=0;i<this.hangar;i++)A.contextText.drawImage(A.images[0],.9*this.width+.03*this.width*i,.3*this.height,this.hangarShipSize,this.hangarShipSize)}}function k(){!A.keys[13]&&!P||!A.start||A.gameOver||A.gameWon||(A.paused=!1,A.start=!1,P=0),A.keys[27]&&(A.lives=0,t()),A.keys[119]&&(A.sound=A.sound?!1:!0,A.keys[119]=!1),!A.keys[80]||A.gameWon||A.gameOver||(A.paused=A.paused?!1:!0,A.keys[80]=!1),(A.keys[27]||(A.keys[13]||P)&&A.paused&&!A.start&&A.gameOver&&!A.gameWon||(A.keys[13]||P)&&A.paused&&!A.start&&A.level>=7)&&((A.lives<1||A.level>=7)&&(A.level=X_Level,A.score=0,playerShip.lives=X_Lives),t()),(A.keys[13]||P)&&!A.gameOver&&!A.start&&A.gameWon&&A.level<=6&&(A.downDivision=Math.floor(300*A.level),t()),A.gameWon&&A.level>1&&A.level<=6&&(w("Battle Won!","Helvetica",.08*A.height,"#FFD455","bold"),w(A.levelScore+" enemy ships destroyed","Helvetica",.06*A.height,"#FFD455","bold"),navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?w("Tap screen to continue","Helvetica",.04*A.height,"#FFD455","bold"):w("Press ENTER or LMB to continue","Helvetica",.04*A.height,"#FFD455","bold"),A.levelScore=0),A.gameWon&&A.level>=7&&(A.contextPlayer.font="bold "+.08*A.width+"px "+A.font,A.contextPlayer.fillStyle="#CC99FF",A.contextPlayer.fillText("Victory!",.35*A.width,.42*A.height),A.contextPlayer.font="bold "+.06*A.width+"px "+A.font,A.contextPlayer.fillText(A.score+" enemy ships destroyed",.17*A.width,.52*A.height),A.contextPlayer.font="bold "+.04*A.width+"px "+A.font,A.contextPlayer.fillStyle="white",navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?A.contextPlayer.fillText("Tap screen to restart",.3*A.width,.62*A.height):A.contextPlayer.fillText("Press Enter or LMB to restart",.24*A.width,.62*A.height),A.levelScore=0)}function l(){A.timer++,A.seconds=A.timer/60||0,console.log(A.seconds),gameUI.update(),playerShip.update(),A.contextPlayer.clearRect(0,0,A.width,A.height),playerShip.draw(),A.contextBackground.clearRect(0,0,A.width,A.height),level1Bg.length<1&&level1Bg.push(new b(150,21,0));for(var a in level1Bg)level1Bg[a].y>.02*-A.height&&level1Bg.length<2&&level1Bg.push(new b(150,21,1)),level1Bg[a].y>A.height&&level1Bg.splice(a,1),level1Bg[a].update(),level1Bg[a].draw();if(A.seconds>1&&H.update(),A.seconds>5&&I.update(),18==A.seconds&&(A.enemyBases.push(new f(.3*A.width,.1*-A.height,155,Math.PI/2,1e3,22)),A.enemyBases[0].size=170*dtSize),A.seconds>20&&J.update(),30==A.seconds&&(A.enemyBases.push(new f(.3*A.width,.1*-A.height,155,Math.PI/2,1e3,23)),A.enemyBases[0].size=170*dtSize),A.seconds>40&&L.update(),A.seconds>50&&M.update(),A.seconds>90&&J.update(),A.enemyBases.length>0)for(var c in A.enemyBases){for(var d in playerShip.bullets)u(A.enemyBases[c],playerShip.bullets[d])&&!A.enemyBases[c].dead&&(A.enemyBases[c].hit=!0,A.enemyBases[c].hull-=playerShip.bullets[d].power,playerShip.bullets[d].dead=!0,playerShip.bullets.splice(d,1));A.enemyBases[c].update(),A.enemyBases[c].draw(),(A.enemyBases[c].dead||A.enemyBases[c].y>A.height+A.enemyBases[c].size||A.enemyBases[c].x<.3*-A.width||A.enemyBases[c].x>1.3*A.width)&&(A.enemyBases[c].dead&&(A.contextEnemies.clearRect(A.enemyBases[c].x,A.enemyBases[c].y,A.enemyBases[c].size,A.enemyBases[c].size),lootchance=Math.random(),lootchance<.05&&this.loot.push(new h(A.enemyBases[c].x,A.enemyBases[c].y))),A.enemyBases.splice(c,1))}if(A.explosions.length>0){for(var e in A.explosions)A.explosions[e].update(),A.explosions[e].draw();for(var g in A.explosions)19==A.explosions[g].currentFrame&&A.explosions.splice(g,1)}}function m(){N=document.getElementById("playerCanvas"),O=N.getContext("2d"),N.addEventListener("mousedown",p,!1),N.addEventListener("mouseup",n,!1),N.addEventListener("mousemove",r,!1),N.addEventListener("touchstart",q,!1),N.addEventListener("touchend",o,!1),N.addEventListener("touchcancel",o,!1),N.addEventListener("touchleave",o,!1),N.addEventListener("touchmove",s,!1)}function n(){P=0,r()}function o(){P=0}function p(){P=1,r()}function q(){P=1,s()}function r(a){a&&(a.preventDefault(),canvasX=a.pageX-N.offsetLeft,canvasY=a.pageY-N.offsetTop)}function s(a){a&&(a.preventDefault(),canvasX=a.targetTouches[0].pageX-N.offsetLeft,canvasY=a.targetTouches[0].pageY-N.offsetTop)}function t(){P=0,A.gameOver=!1,A.gameWon=!1,A.contextBackground.clearRect(1,1,A.width,A.height),A.contextPlayer.clearRect(1,1,A.width,A.height),A.contextEnemies.clearRect(1,1,A.width,A.height),A.contextText.clearRect(1,1,A.width,A.height),playerShip.reset(),H.reset(),I.reset(),J.reset(),K.reset(),L.reset(),M.reset(),A.paused=!1}function u(a,b){return!(a.x>b.x+b.size||a.x+a.size<b.x||a.y>b.y+b.size||a.y+a.size<b.y)}function v(){A.gameOver=!0,A.lives--,A.score=A.score-A.levelScore,setTimeout(function(){A.paused=!0,P=0,A.gameOver&&A.paused&&A.lives<1&&(w("Game Over",1,"Helvetica",.06*A.width,"#FFD455","bold"),w(A.score+" enemy ships destroyed",2,"Helvetica",.05*A.width,"#FFD455","bold"),navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?w("Tap screen to restart",3,"Helvetica",.04*A.width,"white","bold"):w("Press ENTER or LMB to restart",3,"Helvetica",.04*A.width,"white","bold"),"ON"==A.soundStatus&&A.deathSound.play(),A.levelScore=0),A.gameOver&&A.paused&&A.lives>=1&&(w("Your ship has been destroyed!",1,"Helvetica",.06*A.width,"#FFD455","bold"),w(A.lives+" ships left",2,"Helvetica",.05*A.width,"#FFD455","bold"),navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?w("Tap screen to continue",3,"Helvetica",.04*A.width,"white","bold"):w("Press ENTER or LMB to continue",3,"Helvetica",.04*A.width,"white","bold"),A.levelScore=0)},1e3)}function w(a,b,c,d,e,f){var g=a,h=g.length,i=h*d/2,j=.1*A.height,k=.5*(A.width-i),l=A.height/3.5+j*b;A.contextPlayer.font=f+" "+d+"px "+c,A.contextPlayer.fillStyle=e,A.contextPlayer.fillText(g,k,l)}function x(){requestAnimFrame(x);var a=(new Date).getTime();dt=(a-(Q||a))/1e3,Q=a,k(),A.paused||l()}function y(a){A.requiredImages=a.length;for(var b in a){var c=new Image;c.src=a[b],A.images[b]=c,A.images[b].onload=function(){A.doneImages++}}}function z(){A.doneImages>=A.requiredImages?(A.contextBackground.clearRect(0,0,A.width,A.height),A.contextBackground.font="bold "+.11*A.width+"px "+A.font,A.contextBackground.fillStyle="purple",A.contextBackground.fillText(X_Title,.2*A.width,.4*A.height),A.contextBackground.font="bold "+.04*A.width+"px "+A.font,A.contextBackground.fillStyle="#FFD455",A.contextBackground.fillText(X_Subtitle,.1*A.width,.55*A.height),A.contextBackground.fillStyle="white",navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?A.contextBackground.fillText(X_mb_Start,.25*A.width,.65*A.height):A.contextBackground.fillText(X_dt_Start,.1*A.width,.7*A.height),x()):setTimeout(function(){z()},1)}window.addEventListener("load",function(){window.applicationCache.addEventListener("updateready",function(){window.applicationCache.status==window.applicationCache.UPDATEREADY&&confirm("A new version of InVaDeRs is available. Load it?")&&window.location.reload()},!1)},!1),window.addEventListener("load",m,!1),$.ajax({type:"GET",url:"game.xml",dataType:"xml",async:!1,success:function(a){$(a).find("data").each(function(){X_Sound=parseInt($(this).find("sound").text()),X_Level=parseInt($(this).find("level").text()),X_Lives=parseInt($(this).find("player-lives").text()),X_PlayerSpeed=parseInt($(this).find("player-speed").text()),X_EnemySpeed=parseInt($(this).find("enemy-speed").text()),X_GunSpeed=parseInt($(this).find("reload-time").text()),X_EnGunSpeed=parseInt($(this).find("enreload-time").text()),X_BulletSpeed=parseInt($(this).find("bullet-speed").text()),X_EnBulletSpeed=parseInt($(this).find("enbullet-speed").text()),X_Title=$(this).find("title").text(),X_Subtitle=$(this).find("subtitle").text(),X_dt_Start=$(this).find("dt-start").text(),X_mb_Start=$(this).find("mb-start").text()})},error:function(){alert("The XML File could not be processed correctly.")}});var A={};A.stars=[],A.score=0,A.levelScore=0,A.level=X_Level,A.lives=X_Lives,A.keys=[],A.playerBullets=[],A.enemyBullets=[],A.enemies=[],A.enemyBases=[],A.explosions=[],dt=0,A.start=!0,A.paused=!0,A.gameWon=!1,A.gameOver=!1,A.delayTimer=0,A.timer=0,A.sound=X_Sound,A.enemyexplodeSound=new Audio("_sounds/explosion.wav"),A.playerexplodeSound=new Audio("_sounds/blast.mp3"),A.shootSound=new Audio("_sounds/laser.wav"),A.deathSound=new Audio("_sounds/death.mp3"),A.winSound=new Audio("_sounds/victory.mp3"),A.images=[],A.doneImages=0,A.requiredImages=0,A.contextBackground=document.getElementById("backgroundCanvas").getContext("2d"),A.contextEnemies=document.getElementById("enemiesCanvas").getContext("2d"),A.contextPlayer=document.getElementById("playerCanvas").getContext("2d"),A.contextText=document.getElementById("textCanvas").getContext("2d");var B=$("#backgroundCanvas"),C=$("#enemiesCanvas"),D=$("#playerCanvas"),E=$("#textCanvas"),F=(B.get(0).getContext("2d"),$(B).parent());$(window).resize(a),a(),b.prototype=Object.create(particle.prototype),b.prototype.constructor=b,level1Bg=[],c.prototype=Object.create(particle.prototype),c.prototype.constructor=c,d.prototype=Object.create(particle.prototype),d.prototype.constructor=d,playerShip=new d(1e3,15),e.prototype=Object.create(particle.prototype),e.prototype.constructor=e,f.prototype=Object.create(particle.prototype),f.prototype.constructor=f,g.prototype=Object.create(particle.prototype),g.prototype.constructor=g,h.prototype=Object.create(particle.prototype),h.prototype.constructor=h;var G=function(a,b,c,d,e,i,j){this.spawnedShips=0,this.race=a,this.fleetSize=b,this.speed=c,this.hull=d,this.interval=1,this.intervalDivision=i,this.spawnTimer=1,this.spawnDivisionSet=!1,this.waveCount=0,this.nWaves=e,this.started=!1,this.finished=!1,this.xVal=[Math.random()*(.85*A.width-.15*A.width+1)+.15*A.width,Math.random()*(.1*-A.width-.3*-A.width+1)-.3*A.width,Math.random()*(1.3*A.width-1.1*A.width+1)+1.3*A.width],this.randomX=Math.floor(Math.random()*this.xVal.length),this.x=this.xVal[this.randomX],this.x<0||this.x>A.width?(this.y=Math.random()*(.5*A.height-.15*A.height+1)+.15*A.height,this.x<0?this.direction=0:this.x>A.width&&(this.direction=Math.PI)):(this.y=.1*-A.height,this.direction=Math.PI/2),this.units=[],this.bullets=[],this.bulletTimer=1,this.bulletDivision=j||99999,this.loot=[],this.update=function(){if(0===dt||this.spawnDivisionSet||(this.spawnDivision=Math.round(700*dt),this.spawnDivisionSet=!0),!this.finished&&(this.interval++,this.interval%this.intervalDivision==1&&(this.started=!0),this.started)){this.spawnTimer++,this.spawnedShips<=this.fleetSize&&this.spawnTimer%this.spawnDivision==1&!this.finished&&(this.spawnTimer=1,this.units.push(new f(this.x,this.y,this.speed,this.direction,this.hull,this.race)),this.spawnedShips++),remainingEnemies=this.units.length,remainingBullets=this.bullets.length,this.units.length>=1&&this.bulletTimer++,pEn=remainingEnemies<2?0:Math.floor(Math.random()*(remainingEnemies-1+1)),this.bulletTimer%this.bulletDivision==1&&remainingEnemies>=1&&this.units[pEn].y<A.height-this.units[pEn].size&&this.units[pEn].y>0+this.units[pEn].size&&(this.bulletTimer=1,bulletX=this.units[pEn].x+.42*this.units[pEn].size,bulletY=this.units[pEn].y+this.units[pEn].size,bulletDirection=this.units[pEn].angleTo(playerShip),this.bullets.push(new g(bulletX,bulletY,50,bulletDirection,100,20)));for(var a in this.units){this.units[a].update(),this.units[a].draw();for(var b in playerShip.bullets)u(this.units[a],playerShip.bullets[b])&&!this.units[a].dead&&(this.units[a].hit=!0,this.units[a].hull-=playerShip.bullets[b].power,playerShip.bullets[b].dead=!0,playerShip.bullets.splice(b,1));(!this.finished&&this.units[a].dead||this.units[a].y>A.height+this.units[a].size||this.units[a].x<.3*-A.width||this.units[a].x>1.3*A.width)&&(this.units[a].dead&&(A.contextEnemies.clearRect(this.units[a].x,this.units[a].y,this.units[a].size,this.units[a].size),lootchance=Math.random(),lootchance<.05&&this.loot.push(new h(this.units[a].x,this.units[a].y))),this.units.splice(a,1))}this.spawnedShips>=this.fleetSize&&0===remainingEnemies&&(this.waveCount++,this.started=!1,this.interval=1,this.spawnedShips=0,this.randomX=Math.floor(Math.random()*this.xVal.length),this.x=this.xVal[this.randomX],this.x<0||this.x>A.width?(this.y=Math.random()*(.5*A.height-.15*A.height+1)+.15*A.height,this.x<0?this.direction=0:this.x>A.width&&(this.direction=Math.PI)):(this.y=.1*-A.height,this.direction=Math.PI/2)),this.waveCount>=this.nWaves&&(this.finished=!0)}if(this.bullets.length>=1)for(var c in this.bullets)this.bullets[c].update(),this.bullets[c].draw(),(this.bullets[c].dead||this.bullets[c].x>A.width+this.bullets[c].size||this.bullets[c].x<0-this.bullets[c].size||this.bullets[c].y>A.height+this.bullets[c].size||this.bullets[c].y<-30)&&this.bullets.splice(c,1);if(this.loot.length>=1)for(var d in this.loot)this.loot[d].update(),this.loot[d].draw(),(this.loot[d].x>A.width+this.loot[d].size||this.loot[d].x<0-this.loot[d].size||this.loot[d].y>A.height+this.loot[d].size||this.loot[d].y<-30)&&this.loot.splice(d,1)
},this.reset=function(){this.spawnedShips=0,this.waveCount=0,this.started=!1,this.finished=!1,this.randomX=Math.floor(Math.random()*this.xVal.length),this.x=this.xVal[this.randomX],this.x<0||this.x>A.width?(this.y=Math.random()*(.5*A.height-.15*A.height+1)+.15*A.height,this.x<0?this.direction=0:this.x>A.width&&(this.direction=Math.PI)):(this.y=.1*-A.height,this.direction=Math.PI/2),this.units=[],this.bullets=[],this.bulletTimer=1,this.loot=[]}},H=new G(1,7,250,100,10,300),I=new G(1,4,300,100,1,300),J=new G(1,3,275,200,10,300),K=new G(1,6,300,200,10,300,150),L=new G(1,5,275,300,10,300,150),M=new G(1,8,250,300,10,300,150);gameUI=new j,$(document).keydown(function(a){A.keys[a.keyCode?a.keyCode:a.which]=!0}),$(document).keyup(function(a){delete A.keys[a.keyCode?a.keyCode:a.which]});var N,O;canvasX=playerShip.x,canvasY=playerShip.y;var P=0;moveX=canvasX,moveY=canvasY;var Q;y(["_img/_dist/fighter/fighter.png","_img/_dist/enemies/sectoid.png","_img/_dist/laser.png","_img/_dist/explosion.png","_img/_dist/fighter/fighter_right1.png","_img/_dist/fighter/fighter_right2.png","_img/_dist/fighter/fighter_right3.png","_img/_dist/fighter/fighter_right4.png","_img/_dist/fighter/fighter_right5.png","_img/_dist/fighter/fighter_left1.png","_img/_dist/fighter/fighter_left2.png","_img/_dist/fighter/fighter_left3.png","_img/_dist/fighter/fighter_left4.png","_img/_dist/fighter/fighter_left5.png","_img/_dist/stars/star1.png","_img/_dist/stars/star2.png","_img/_dist/stars/star3.png","_img/_dist/stars/star4.png","_img/_dist/stars/star5.png","_img/_dist/stars/star6.png","_img/_dist/missile.png","_img/_dist/background/level_1.jpg","_img/_dist/enemies/_alienbase/alienbase1.png","_img/_dist/enemies/_alienbase/alienbase2.png"]),z()})}(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();