var vector={_x:1,_y:0,create:function(a,b){var c=Object.create(this);return c.setX(a),c.setY(b),c},setX:function(a){this._x=a},getX:function(){return this._x},setY:function(a){this._y=a},getY:function(){return this._y},setAngle:function(a){var b=this.getLength();this._x=Math.cos(a)*b,this._y=Math.sin(a)*b},getAngle:function(){return Math.atan2(this._y,this._x)},setLength:function(a){var b=this.getAngle();this._x=Math.cos(b)*a,this._y=Math.sin(b)*a},getLength:function(){return Math.sqrt(this._x*this._x+this._y*this._y)},add:function(a){return vector.create(this._x+a.getX(),this._y+a.getY())},subtract:function(a){return vector.create(this._x-a.getX(),this._y-a.getY())},multiply:function(a){return vector.create(this._x*a,this._y*a)},divide:function(a){return vector.create(this._x/a,this._y/a)},addTo:function(a){this._x+=a.getX(),this._y+=a.getY()},subtractFrom:function(a){this._x-=a.getX(),this._y-=a.getY()},multiplyBy:function(a){this._x*=a,this._y*=a},divideBy:function(a){this._x/=a,this._y/=a}},utils={norm:function(a,b,c){return(a-b)/(c-b)},lerp:function(a,b,c){return(c-b)*a+b},map:function(a,b,c,d,e){return utils.lerp(utils.norm(a,b,c),d,e)},clamp:function(a,b,c){return Math.min(Math.max(a,Math.min(b,c)),Math.max(b,c))},distance:function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)},distanceXY:function(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(e*e+f*f)},circleCollision:function(a,b){return utils.distance(a,b)<=a.radius+b.radius},circlePointCollision:function(a,b,c){return utils.distanceXY(a,b,c.x,c.y)<c.radius},pointInRect:function(a,b,c){return utils.inRange(a,c.x,c.x+c.width)&&utils.inRange(b,c.y,c.y+c.height)},inRange:function(a,b,c){return a>=Math.min(b,c)&&a<=Math.max(b,c)},rangeIntersect:function(a,b,c,d){return Math.max(a,b)>=Math.min(c,d)&&Math.min(a,b)<=Math.max(c,d)},rectIntersect:function(a,b){return utils.rangeIntersect(a.x,a.x+a.width,b.x,b.x+b.width)&&utils.rangeIntersect(a.y,a.y+a.height,b.y,b.y+b.height)},degreesToRads:function(a){return a/180*Math.PI},radsToDegrees:function(a){return 180*a/Math.PI},randomRange:function(a,b){return a+Math.random()*(b-a)},randomInt:function(a,b){return Math.floor(a+Math.random()*(b-a+1))},roundToPlaces:function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},roundNearest:function(a,b){return Math.round(a/b)*b},quadraticBezier:function(a,b,c,d,e){return e=e||{},e.x=Math.pow(1-d,2)*a.x+2*(1-d)*d*b.x+d*d*c.x,e.y=Math.pow(1-d,2)*a.y+2*(1-d)*d*b.y+d*d*c.y,e},cubicBezier:function(a,b,c,d,e,f){return f=f||{},f.x=Math.pow(1-e,3)*a.x+3*Math.pow(1-e,2)*e*b.x+3*(1-e)*e*e*c.x+e*e*e*d.x,f.y=Math.pow(1-e,3)*a.y+3*Math.pow(1-e,2)*e*b.y+3*(1-e)*e*e*c.y+e*e*e*d.y,f},multicurve:function(a,b){var c,d,e,f;b.moveTo(a[0].x,a[0].y);for(var g=1;g<a.length-2;g+=1)c=a[g],d=a[g+1],e=(c.x+d.x)/2,f=(c.y+d.y)/2,b.quadraticCurveTo(c.x,c.y,e,f);c=a[a.length-2],d=a[a.length-1],b.quadraticCurveTo(c.x,c.y,d.x,d.y)}},particle=function(a,b,c,d,e){this.x=a,this.y=b,this.vx=Math.cos(d)*c*dt,this.vy=Math.sin(d)*c*dt,this.mass=1,this.radius=0,this.bounce=-1,this.friction=1,this.gravity=e||0,this.springs=[],this.gravitations=[],this.addGravitation=function(a){this.removeGravitation(a),this.gravitations.push(a)},this.removeGravitation=function(a){for(var b=0;b<this.gravitations.length;b+=1)if(a===this.gravitations[b])return void this.gravitations.splice(b,1)},this.addSpring=function(a,b,c){this.removeSpring(a),this.springs.push({point:a,k:b,length:c||0})},this.removeSpring=function(a){for(var b=0;b<this.springs.length;b+=1)if(a===this.springs[b].point)return void this.springs.splice(b,1)},this.getSpeed=function(){return Math.sqrt(this.vx*this.vx+this.vy*this.vy)},this.setSpeed=function(a){var b=this.getHeading();this.vx=Math.cos(b)*a,this.vy=Math.sin(b)*a},this.getHeading=function(){return Math.atan2(this.vy,this.vx)},this.setHeading=function(a){var b=this.getSpeed();this.vx=Math.cos(a)*b,this.vy=Math.sin(a)*b},this.accelerate=function(a,b){this.vx+=a,this.vy+=b},this.update=function(){0===dt&&(this.vx=Math.cos(d)*c*dt,this.vy=Math.sin(d)*c*dt),this.handleSprings(),this.handleGravitations(),this.vx*=this.friction,this.vy*=this.friction,this.vy+=this.gravity,this.x+=this.vx,this.y+=this.vy},this.handleGravitations=function(){for(var a=0;a<this.gravitations.length;a+=1)this.gravitateTo(this.gravitations[a])},this.handleSprings=function(){for(var a=0;a<this.springs.length;a+=1){var b=this.springs[a];this.springTo(b.point,b.k,b.length)}},this.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)},this.distanceTo=function(a){var b=a.x-this.x,c=a.y-this.y;return Math.sqrt(b*b+c*c)},this.gravitateTo=function(a){var b=a.x-this.x,c=a.y-this.y,d=b*b+c*c,e=Math.sqrt(d),f=a.mass/d,g=b/e*f,h=c/e*f;this.vx+=g,this.vy+=h},this.springTo=function(a,b,c){var d=a.x-this.x,e=a.y-this.y,f=Math.sqrt(d*d+e*e),g=(f-c||0)*b;this.vx+=d/f*g,this.vy+=e/f*g}};!function(){$(document).ready(function(){function a(){if(L.attr("height",$(P).height()),M.attr("height",$(P).height()),N.attr("height",$(P).height()),O.attr("height",$(P).height()),K.isMobile)L.attr("width",$(P).width()),M.attr("width",$(P).width()),N.attr("width",$(P).width()),O.attr("width",$(P).width()),K.width=Math.round($(P).width());else{var a=$(P).height()*(9/16);L.attr("width",a),M.attr("width",a),N.attr("width",a),O.attr("width",a),L.css({left:.5*($(P).width()-a)}),M.css({left:.5*($(P).width()-a)}),N.css({left:.5*($(P).width()-a)}),O.css({left:.5*($(P).width()-a)}),K.width=Math.round(a)}K.height=Math.round($(P).height())}function b(a,b,c,d,e,f,g,h){this.image=a,this.imageSize=b,this.frameWidth=c,this.frameHeight=d,this.startFrame=e,this.endFrame=f,this.frameSpeed=g,this.ctx=h,this.animationSequence=[],this.currentFrame=0,this.counter=0,this.fpr=Math.floor(K.images[this.image].width/this.frameWidth),this.draw=function(a,b){for(this.FrameNum=this.startFrame;this.FrameNum<=this.endFrame;this.FrameNum++)this.animationSequence.push(this.FrameNum);this.counter==this.frameSpeed-1&&(this.currentFrame=(this.currentFrame+1)%this.animationSequence.length),this.counter=(this.counter+1)%this.frameSpeed,this.spriteRow=Math.floor(this.animationSequence[this.currentFrame]/this.fpr),this.spriteCol=Math.floor(this.animationSequence[this.currentFrame]%this.fpr),this.ctx.drawImage(K.images[this.image],this.spriteCol*this.frameWidth,this.spriteRow*this.frameHeight,this.frameWidth,this.frameHeight,a,b,this.imageSize,this.imageSize)}}function c(a){this.speed=Math.round(180*dt),this.section=a,this.width=K.width,this.height=Math.round(K.width*(16/9)*4),this.x=0,this.y=0===this.section?-Math.round(this.height-K.height):-this.height,this.image="level"+K.level+".jpg",this.limits=.02*-K.height,this.update=function(){this.y+=this.speed,K.contextBackground.drawImage(K.images[this.image],this.x,this.y,this.width,this.height)},this.load=function(){K.background.length<1&&K.background.push(new c(0));for(var a in K.background)K.background[a].y>this.limits&&K.background.length<2&&K.background.push(new c(1)),K.background[a].y>K.height&&K.background.splice(a,1),K.background[a].update()}}function d(a,c,d,e,f){particle.call(this,a,c,d,e),this.x=Math.round(a-.2*f),this.y=Math.round(c-.2*f),this.speed=d,this.size=Math.round(1.5*f),this.hitTimer=0,this.dead=!1,this.deadTime=60,this.image="explosion.png",this.ctx=K.contextPlayer,this.sprite=new b(this.image,this.size,96,96,0,19,2,this.ctx),this.update=function(){this.vx=Math.cos(e)*this.speed*dt,this.vy=Math.sin(e)*this.speed*dt,this.x+=this.vx,this.y+=this.vy},this.draw=function(){this.sprite.draw(this.x,this.y)}}function e(a,b){this.x=Math.round(.46*K.width),this.y=Math.round(.9*K.height),this.speed=0,this.maxSpeed=400,this.size=Math.round(100*Q),this.hull=a,this.bulletspeed=Math.round(X_BulletSpeed*K.height/1e3),this.image="fighter.png",this.audioFire="laser.mp3",this.audioExplode="blast.mp3",this.rendered=!1,this.hit=!1,this.hitTimer=0,this.imune=!1,this.imuneTimer=0,this.dead=!1,this.deadTimer=0,this.bullets=[],this.bulletTimer=1,this.bulletDivision=b,this.laserLevel=1,this.missileLevel=0,this.lives=X_Lives,this.ctx=K.contextPlayer,this.speedX=0,this.speedY=0,this.limitX1=.5*-this.size,this.limitX2=K.width-.5*this.size,this.limitY1=.5*-this.size,this.limitY2=K.height-.5*this.size,this.movement=Math.round(.007*K.height),this.canVibrate="vibrate"in navigator||"mozVibrate"in navigator,!this.canVibrate||"vibrate"in navigator||(navigator.vibrate=navigator.mozVibrate),this.update=function(){if(this.playerImage=K.images[this.image],this.speedX=Math.round(.1*(W-T)),this.speedY=Math.round(.1*(X-U)),!V||K.levelComplete||K.paused||K.gameOver||K.gameWon?(this.image="fighter.png",document.getElementById("textCanvas").style.cursor="crosshair"):(document.getElementById("textCanvas").style.cursor="none",moveRight1=this.speedX<-2&&this.speedX>=-4?!0:!1,moveRight2=this.speedX<-4&&this.speedX>=-6?!0:!1,moveRight3=this.speedX<-6&&this.speedX>=-8?!0:!1,moveRight4=this.speedX<-8&&this.speedX>=-10?!0:!1,moveRight5=this.speedX<-10?!0:!1,moveLeft1=this.speedX>2&&this.speedX<=4?!0:!1,moveLeft2=this.speedX>4&&this.speedX<=6?!0:!1,moveLeft3=this.speedX>6&&this.speedX<=8?!0:!1,moveLeft4=this.speedX>8&&this.speedX<=10?!0:!1,moveLeft5=this.speedX>10?!0:!1,this.speedX=this.speedX<this.movement?this.speedX:this.movement,this.speedY=this.speedY<this.movement?this.speedY:this.movement,this.speedX=this.speedX>-this.movement?this.speedX:-this.movement,this.speedY=this.speedY>-this.movement?this.speedY:-this.movement,(0!==this.speedX||0!==this.speedY)&&(this.x>=this.limitX1&&this.x<=this.limitX2&&this.y>=this.limitY1&&this.y<=this.limitY2?(this.x=this.x-this.speedX,this.y=this.y-this.speedY):this.x<this.limitX1?this.x=this.limitX2:this.x>this.limitX2?this.x=this.limitX1:this.y<this.limitY1?this.y=this.limitY2:this.y>this.limitY2&&(this.y=this.limitY1)),this.speedX=0,this.speedY=0,moveRight1?this.image="fighter_right1.png":moveRight2?this.image="fighter_right2.png":moveRight3?this.image="fighter_right3.png":moveRight4?this.image="fighter_right4.png":moveRight5?this.image="fighter_right5.png":moveLeft1?this.image="fighter_left1.png":moveLeft2?this.image="fighter_left2.png":moveLeft3?this.image="fighter_left3.png":moveLeft4?this.image="fighter_left4.png":moveLeft5&&(this.image="fighter_left5.png"),this.rendered=!1),K.isMobile||((K.keys[37]||K.keys[65]&&!K.gameOver&&!K.gameWon)&&this.x>0&&(this.speed=this.maxSpeed,this.image="fighter_left5.png",this.rendered=!1,this.x-=Math.round(this.speed*dt)),(K.keys[39]||K.keys[68]&&!K.gameOver&&!K.gameWon)&&this.x<=K.width-this.size&&(this.speed=this.maxSpeed,this.image="fighter_right5.png",this.rendered=!1,this.x+=Math.round(this.speed*dt)),!K.keys[38]&&!K.keys[87]||K.gameOver||K.gameWon||this.y>0&&(this.speed=this.maxSpeed,this.rendered=!1,this.y-=Math.round(this.speed*dt)),(K.keys[40]||K.keys[83]&&!K.gameOver&&!K.gameWon)&&this.y<=K.height-this.size&&(this.speed=this.maxSpeed,this.rendered=!1,this.y+=Math.round(this.speed*dt))),K.levelComplete&&(this.speed=this.maxSpeed,this.rendered=!1,this.y-=Math.round(this.speed*dt)),this.midLaserX=Math.round(this.x+.5*this.size),this.leftlaserX=Math.round(this.x+.25*this.size),this.rightlaserX=Math.round(this.x+.75*this.size),this.LaserY=Math.round(this.y-.2*this.size),this.midMissileX=Math.round(this.x+.5*this.size),this.leftMissileX=this.x,this.rightMissileX=this.x+this.size,this.missileY=this.y+this.size,!K.keys[32]&&!V||this.dead||K.gameOver)this.bulletTimer=1;else if(this.bulletTimer++,this.bulletTimer%this.bulletDivision===0){switch(this.laserLevel){case 1:K.playerBullets.push(new f(this.midLaserX,this.LaserY,600,-Math.PI/2,45,1,1,"laser.png",48,11)),K.sound&&K.sounds.push(K.sfx[this.audioFire]);break;case 2:K.playerBullets.push(new f(this.leftlaserX,this.LaserY,600,-Math.PI/2,45,1,1,"laser.png",48,11)),K.playerBullets.push(new f(this.rightlaserX,this.LaserY,600,-Math.PI/2,45,1,1,"laser.png",48,11)),K.sound&&K.sounds.push(K.sfx[this.audioFire]);break;default:K.playerBullets.push(new f(this.leftlaserX,this.LaserY,600,-Math.PI/2,45,1,1,"laser.png",48,11)),K.playerBullets.push(new f(this.midLaserX,this.LaserY,600,-Math.PI/2,45,1,1,"laser.png",48,11)),K.playerBullets.push(new f(this.rightlaserX,this.LaserY,600,-Math.PI/2,45,1,1,"laser.png",48,11)),K.sound&&K.sounds.push(K.sfx[this.audioFire])}switch(this.missileLevel){case 0:break;case 1:K.playerBullets.push(new f(this.midMissileX,this.missileY,100,-Math.PI/2,45,2,1.03,"missile.png",64,2));break;case 2:K.playerBullets.push(new f(this.leftMissileX,this.missileY,100,-Math.PI/2,45,2,1.03,"missile.png",64,2)),K.playerBullets.push(new f(this.rightMissileX,this.missileY,100,-Math.PI/2,45,2,1.03,"missile.png",64,2));break;default:K.playerBullets.push(new f(this.leftMissileX,this.missileY,100,-Math.PI/2,45,2,1.03,"missile.png",64,2)),K.playerBullets.push(new f(this.rightMissileX,this.missileY,100,-Math.PI/2,45,2,1.03,"missile.png",64,2)),K.playerBullets.push(new f(this.midMissileX,this.missileY,100,-Math.PI/2,45,2,1.03,"missile.png",64,2))}}this.hull<=0&&!this.dead&&(this.dead=!0,this.lives-=1,K.explosions.push(new d(this.x,this.y,this.speed,0,this.size)),K.sound&&K.sounds.push(K.sfx[this.audioExplode]),gameUI.updateHangar()),this.dead&&this.deadTimer<=100&&K.lives>0&&(this.deadTimer++,this.deadTimer>100&&this.lives>0?(V=0,this.hull=a,this.dead=!1,this.x=Math.round(.46*K.width),this.y=Math.round(.9*K.height),this.image="fighter.png",this.rendered=!1,this.hit=!1,this.hitTimer=0,this.friction=0,this.laserLevel=1,this.missileLevel=0,gameUI.updateEnergy(),this.deadTimer=0,this.imune=!0,this.imuneTimer=0):this.deadTimer>100&&0===this.lives?(V=0,K.keys[13]=!1,this.deadTimer=0,K.gameOver=!0):(this.x=Math.round(.5*K.width),this.y=Math.round(1.5*K.height))),this.imune&&(this.imuneTimer++,this.imuneTimer>250&&(this.imune=!1,this.imuneTimer=0))},this.draw=function(){this.dead||(!this.imune||K.faded||K.starting||K.levelComplete||(this.ctx.globalAlpha=.8,(this.imuneTimer>=0&&this.imuneTimer<15||this.imuneTimer>=20&&this.imuneTimer<35||this.imuneTimer>=40&&this.imuneTimer<55||this.imuneTimer>=70&&this.imuneTimer<75||this.imuneTimer>=90&&this.imuneTimer<95||this.imuneTimer>=110&&this.imuneTimer<115||this.imuneTimer>=130&&this.imuneTimer<135||this.imuneTimer>=150&&this.imuneTimer<155||this.imuneTimer>=160&&this.imuneTimer<175||this.imuneTimer>180)&&this.ctx.drawImage(this.playerImage,this.x,this.y,this.size,this.size)),this.imune||(this.ctx.globalAlpha<1&&!K.faded&&!K.levelComplete&&(this.ctx.globalAlpha+=.1),this.ctx.drawImage(this.playerImage,this.x,this.y,this.size,this.size)),this.hit&&!this.imune&&(this.canVibrate&&navigator.vibrate(30),this.hit=!1))},this.load=function(){this.update(),this.draw()},this.reset=function(){this.dead=!1,this.x=Math.round(.46*K.width),this.y=Math.round(.9*K.height),this.image="fighter.png",this.hull=a,this.rendered=!1,this.hit=!1,this.hitTimer=0,this.dead=!1,K.gameOver=!1,this.friction=0,this.bullets=[],this.laserLevel=1,this.missileLevel=0,this.lives=X_Lives}}function f(a,c,d,e,f,g,h,i,j,k){particle.call(this,a,c,d,e),this.size=Math.round(f*Q),this.spriteX=-Math.round(.5*this.size),this.spriteY=-Math.round(.5*this.size),this.power=g,this.image=i,this.dead=!1,this.deadTime=60,this.friction=h,this.dtSet=!1,this.ctx=K.contextEnemies,this.sprite=new b(this.image,this.size,j,j,0,k,4,this.ctx),this.update=function(){0===dt||this.dtSet||(this.vx=Math.cos(e)*d*dt,this.vy=Math.sin(e)*d*dt,this.dtSet=!0),this.vx*=this.friction,this.vy*=this.friction,this.x+=this.vx,this.y+=this.vy},this.draw=function(){this.dead||(this.ctx.save(),this.ctx.translate(this.x,this.y),this.ctx.rotate(e-Math.PI/2),this.sprite.draw(this.spriteX,this.spriteY),this.ctx.restore())}}function g(a,b,c,e,f,g,h,i,k){switch(particle.call(this,a,b,c,e),this.type=g,this.type){case"pawn":this.size=Math.round(65*Q);break;case"miniboss":this.size=Math.round(120*Q);break;case"base":this.size=Math.round(170*Q),this.rotation=0}this.spritePos=Math.round(.5*this.size),this.hull=f,this.image=K.images[h],this.audioHit="hit.mp3",this.audioDead="explosion.mp3",this.hit=!1,this.hitTimer=0,this.dead=!1,this.bulletTimer=1,this.sheep=k||!1,this.fireRate=60*i,this.bulletDivision=this.sheep?2*this.fireRate-Math.floor(Math.random()*this.fireRate)||99999:this.bulletDivision=this.fireRate||99999,this.ctx=K.contextEnemies,this.inCanvas=!1,this.speed=c,this.direction=e,this.collided=!1,this.update=function(){this.vx=Math.cos(this.direction)*this.speed*dt,this.vy=Math.sin(this.direction)*this.speed*dt,this.x+=this.vx,this.y+=this.vy,this.spriteX=this.x+this.spritePos,this.spriteY=this.y+this.spritePos,this.hit&&this.hull>0&&(K.sound&&K.sounds.push(K.sfx[this.audioHit]),this.hit=!1),this.hull<=0&&(this.dead=!0,K.explosions.push(new d(this.x,this.y,this.speed,this.direction,this.size)),K.sound&&K.sounds.push(K.sfx[this.audioDead]),playerShip.crashed||(K.score++,K.levelScore++,gameUI.updateScore())),0!==this.fireRate&&(this.bulletTimer++,this.bulletTimer%this.bulletDivision==1&&(this.bulletTimer=1,bulletX=Math.round(this.x+.42*this.size),bulletY=Math.round(this.y+this.size),bulletDirection=this.angleTo(playerShip),K.enemyBullets.push(new j(bulletX,bulletY,50,bulletDirection,1,"missile.png")))),"base"!=this.type&&(this.direction-=utils.randomRange(-.05,.05))},this.draw=function(){"base"==this.type?this.dead||(this.rotation+=.01,this.ctx.save(),this.ctx.translate(this.spriteX,this.spriteY),this.ctx.rotate(this.rotation),this.ctx.drawImage(this.image,-this.spritePos,-this.spritePos,this.size,this.size),this.ctx.restore()):this.dead||this.ctx.drawImage(this.image,this.x,this.y,this.size,this.size)}}function h(a,b,c,e,f,g){particle.call(this,a,b,c,e),this.hull=f,this.image=K.images[g],this.size=Math.round(200*Q),this.hit=!1,this.audioHit="hit.mp3",this.audioDead="blast.mp3",this.hitTimer=0,this.dead=!1,this.deadTimer=0,this.bulletTimer1=1,this.bulletTimer2=1,this.bulletDivision1=50,this.bulletDivision2=30,this.fireRate=0,this.yStop=Math.round(.1*K.height),this.xBondary=Math.round(K.width-this.size/4),this.context=K.contextEnemies,this.update=function(){this.bulletDirection=this.angleTo(playerShip),this.vx=Math.cos(e)*c*dt,this.vy=Math.sin(e)*c*dt,this.x+=this.vx,this.y+=this.vy,this.hit&&this.hull>0&&(K.sound&&K.sounds.push(K.sfx[this.audioHit]),this.hit=!1),!B(playerShip,this)||this.dead||K.gameOver||(playerShip.hull-=this.hull,playerShip.hit=!0,this.hit=!0,this.hull-=playerShip.hull),this.hull<=0&&(K.explosions.push(new d(this.x,this.y,c,e,this.size)),K.sound&&K.sounds.push(K.sfx[this.audioDead]),playerShip.crashed||(K.score++,K.levelScore++,K.bossDead=!0,this.dead=!0)),this.bulletTimer1++,this.bulletTimer2++,this.bulletTimer1%this.bulletDivision1==1&&(this.bulletTimer1=1,mBulletX1=Math.round(this.x),mBulletX2=Math.round(this.x+this.size),mBulletY=Math.round(this.y+.6*this.size),K.enemyBullets.push(new j(mBulletX1,mBulletY,50,this.bulletDirection,1,"missile.png")),K.enemyBullets.push(new j(mBulletX2,mBulletY,50,this.bulletDirection,1,"missile.png"))),this.bulletTimer2%this.bulletDivision2==1&&(this.bulletTimer2=1,lBulletX=Math.round(this.x+.48*this.size),lBulletY=Math.round(this.y+this.size),K.enemyBullets.push(new j(lBulletX,lBulletY,250,Math.PI/2,1.5,"laser.png")),K.enemyBullets.push(new j(lBulletX,lBulletY,250,Math.PI/2,1.5,"laser.png"))),this.y>this.yStop&&(c=0,this.x>0&&this.x<=this.xBondary&&(this.x<playerShip.x&&this.x<=this.xBondary-1?this.x+=1:this.x>playerShip.x&&this.x>1&&(this.x-=1)))},this.draw=function(){this.dead||K.contextEnemies.drawImage(this.image,this.x,this.y,this.size,this.size)}}function j(a,c,d,e,f,g){particle.call(this,a,c,d,e),this.size=Math.round(30*Q),this.spriteX=-Math.round(.5*this.size),this.spriteY=-Math.round(.5*this.size),this.power=f,this.image=g,this.dead=!1,this.deadTime=60,this.friction=1.02,this.dtSet=!1,this.ctx=K.contextEnemies,this.sprite=new b(this.image,this.size,64,64,0,2,5,this.ctx),this.update=function(){0===dt||this.dtSet||(this.vx=Math.cos(e)*d*dt,this.vy=Math.sin(e)*d*dt,this.dtSet=!0),this.vx*=this.friction,this.vy*=this.friction,this.x+=this.vx,this.y+=this.vy},this.draw=function(){this.dead||(this.ctx.save(),this.ctx.translate(this.x,this.y),this.ctx.rotate(e-Math.PI/2),this.sprite.draw(this.spriteX,this.spriteY),this.ctx.restore())}}function k(a,b){particle.call(this,a,b),this.speed=250,this.direction=Math.PI/2,this.size=Math.round(45*Q),this.dead=!1,this.drops=["health","laser","missile"];var c=Math.floor(Math.random()*this.drops.length);switch(this.type=this.drops[c],this.type){case"health":this.image="fighter.png";break;case"laser":this.image="laser.png";break;case"missile":this.image="missile.png"}this.sfx="loot_powerUp.mp3",this.context=K.contextPlayer,this.update=function(){if(this.vx=Math.cos(this.direction)*this.speed*dt,this.vy=Math.sin(this.direction)*this.speed*dt,this.x+=this.vx,this.y+=this.vy,B(this,playerShip)&&!this.dead&&!K.gameOver){switch(this.type){case"health":this.hull<=7.5?playerShip.hull+=2.5:playerShip.hull=10,gameUI.updateEnergy();break;case"laser":playerShip.laserLevel+=1;break;case"missile":playerShip.missileLevel+=1}K.sound&&K.sounds.push(K.sfx[this.sfx]),this.dead=!0}},this.draw=function(){this.dead||K.contextPlayer.drawImage(K.images[this.image],this.x,this.y,this.size,this.size)}}function l(){this.width=K.width,this.height=.04*K.height,this.enContainerWidth=.3*K.width,this.enContainerHeight=.04*K.height,this.enBarHeight=.019*K.height,this.enBarVol=.2*K.width,this.hangarShipSize=.03*K.height,this.level=K.level,this.hangarImg="fighter.png",this.enPointImg="energypoint.png",this.enContainerImg="energybar.png",this.scoreX=Math.round(.1*this.width),this.scoreY=Math.round(.6*this.height),this.energyX=Math.round(.55*this.width),this.energyY=Math.round(.18*this.height),this.updateLevel=function(){this.level=K.level,K.contextText.fillStyle="#FFD455",K.contextText.font=15*Q+"px helvetica",K.contextText.clearRect(.02*this.width,.3*this.height,.05*this.width,.35*this.height),K.contextText.fillText("S"+this.level,.02*this.width,.6*this.height)},this.updateScore=function(){this.score=K.score,K.contextText.fillStyle="#FFD455",K.contextText.font=15*Q+"px helvetica",K.contextText.clearRect(this.scoreX,.3*this.height,.14*this.width,.35*this.height),K.contextText.fillText("Score: "+this.score,this.scoreX,this.scoreY)},this.updateSound=function(){this.soundFx=K.sound?"ON":"OFF",K.isMobile||(K.contextText.fillStyle="#FFD455",K.contextText.font=15*Q+"px helvetica",K.contextText.clearRect(.25*this.width,.3*this.height,.2*this.width,.35*this.height),K.contextText.fillText("Sound(F8): "+this.soundFx,.25*this.width,.6*this.height))},this.updateEnergy=function(){this.hull=playerShip.hull>0?playerShip.hull*K.width*.02:0,K.contextText.clearRect(.55*this.width,.2*this.height,this.enBarVol,this.enBarHeight),K.contextText.drawImage(K.images[this.enPointImg],this.energyX,this.energyY,this.hull,this.enBarHeight)},this.updateHangar=function(){for(this.hangar=playerShip.lives,K.contextText.clearRect(.83*this.width,.2*this.height,3*this.hangarShipSize,this.hangarShipSize),i=0;i<this.hangar;i++)K.contextText.drawImage(K.images[this.hangarImg],.82*this.width+.05*this.width*i,.2*this.height,this.hangarShipSize,this.hangarShipSize)},this.updateAll=function(){K.contextText.clearRect(0,0,this.width,1.5*this.height),K.contextText.drawImage(K.images[this.enContainerImg],.5*this.width,.1*-this.height,this.enContainerWidth,this.enContainerHeight),this.updateLevel(),this.updateScore(),this.updateSound(),this.updateEnergy(),this.updateHangar()}}function m(){this.backgroundAlpha=0,this.enemiesAlpha=0,this.playerAlpha=0,this.textAlpha=0,this.alphaDelta=.01,this.on=function(a){switch(a=a){case"all":K.contextText.globalAlpha=1,K.contextBackground.globalAlpha=1,K.contextEnemies.globalAlpha=1,K.contextPlayer.globalAlpha=1,K.textFaded=!1,K.backgroundFaded=!1,K.enemiesFaded=!1,K.playerFaded=!1,K.faded=!1;break;case"text":K.contextText.globalAlpha=1,K.textFaded=!1;break;case"background":K.contextBackground.globalAlpha=1,K.backgroundFaded=!1;break;case"enemies":K.contextEnemies.globalAlpha=1,K.enemiesFaded=!1;break;case"player":K.contextPlayer.globalAlpha=1,K.playerFaded=!1}},this.off=function(a){switch(a=a){case"all":K.contextText.globalAlpha=0,K.contextBackground.globalAlpha=0,K.contextEnemies.globalAlpha=0,K.contextPlayer.globalAlpha=0,K.textFaded=!0,K.backgroundFaded=!0,K.enemiesFaded=!0,K.playerFaded=!0,K.faded=!0;break;case"text":K.contextText.globalAlpha=0,K.textFaded=!0;break;case"background":K.contextBackground.globalAlpha=0,K.backgroundFaded=!0;break;case"enemies":K.contextEnemies.globalAlpha=0,K.enemiesFaded=!0;break;case"player":K.contextPlayer.globalAlpha=0,K.playerFaded=!0}},this.fadeIn=function(a){switch(a=a){case"all":this.backgroundAlpha<1||this.enemiesAlpha<1||this.playerAlpha<1||this.textAlpha<1?(this.backgroundAlpha+=this.alphaDelta,this.enemiesAlpha+=this.alphaDelta,this.playerAlpha+=this.alphaDelta,this.textAlpha+=this.alphaDelta):this.backgroundAlpha>=1&&this.enemiesAlpha>=1&&this.playerAlpha>=1&&this.textAlpha>=1&&(K.contextBackground.globalAlpha=1,K.contextEnemies.globalAlpha=1,K.contextPlayer.globalAlpha=1,K.contextText.globalAlpha=1,K.backgroundFaded=!1,K.enemiesFaded=!1,K.playerFaded=!1,K.textFaded=!1,K.faded=!1),K.contextBackground.globalAlpha=this.backgroundAlpha,K.contextEnemies.globalAlpha=this.enemiesAlpha,K.contextPlayer.globalAlpha=this.playerAlpha,K.contextText.globalAlpha=this.textAlpha;break;case"text":this.textAlpha<1?this.textAlpha+=this.alphaDelta:this.textAlpha>=1&&(K.contextText.globalAlpha=1,K.textFaded=!1),K.contextText.globalAlpha=this.textAlpha;break;case"background":this.backgroundAlpha<1?this.backgroundAlpha+=this.alphaDelta:this.backgroundAlpha>=1&&(K.contextBackground.globalAlpha=1,K.backgroundFaded=!1),K.contextBackground.globalAlpha=this.backgroundAlpha;break;case"enemies":this.enemiesAlpha<1?this.enemiesAlpha+=this.alphaDelta:K.enemiesApha>=1&&(K.contextEnemies.globalAlpha=1,K.enemiesFaded=!1),K.contextEnemies.globalAlpha=this.enemiesAlpha;break;case"player":this.playerAlpha<1?this.playerAlpha+=this.alphaDelta:this.playerAlpha>=1&&(K.contextPlayer.globalAlpha=1,K.playerFaded=!1),K.contextPlayer.globalAlpha=this.playerAlpha}},this.fadeOut=function(a){switch(a=a){case"all":this.backgroundAlpha>0||this.enemiesAlpha>0||this.playerAlpha>0||this.textAlpha>0?(this.backgroundAlpha-=this.alphaDelta,this.enemiesAlpha-=this.alphaDelta,this.playerAlpha-=this.alphaDelta,this.textAlpha-=this.alphaDelta):this.backgroundAlpha<=0&&this.enemiesAlpha<=0&&this.playerAlpha<=0&&this.textAlpha<=0&&(K.contextBackground.globalAlpha=0,K.contextEnemies.globalAlpha=0,K.contextPlayer.globalAlpha=0,K.contextText.globalAlpha=0,K.backgroundFaded=!0,K.enemiesFaded=!0,K.playerFaded=!0,K.textFaded=!0,K.faded=!0),K.contextBackground.globalAlpha=this.backgroundAlpha,K.contextEnemies.globalAlpha=this.enemiesAlpha,K.contextPlayer.globalAlpha=this.playerAlpha,K.contextText.globalAlpha=this.textAlpha;break;case"text":this.textAlpha>0?this.textAlpha-=this.alphaDelta:this.textAlpha<=0&&(K.contextText.globalAlpha=0,K.textFaded=!0),K.contextText.globalAlpha=this.textAlpha;break;case"background":this.backgroundAlpha>0?this.backgroundAlpha-=this.alphaDelta:this.backgroundAlpha<=0&&(K.contextBackground.globalAlpha=0,K.backgroundFaded=!0),K.contextBackground.globalAlpha=this.backgroundAlpha;break;case"enemies":this.enemiesAlpha>0?this.enemiesAlpha-=this.alphaDelta:K.enemiesApha<=0&&(K.contextEnemies.globalAlpha=0,K.enemiesFaded=!0),K.contextEnemies.globalAlpha=this.enemiesAlpha;break;case"player":this.playerAlpha>0?this.playerAlpha-=this.alphaDelta:this.playerAlpha<=0&&(K.contextPlayer.globalAlpha=0,K.playerFaded=!0),K.contextPlayer.globalAlpha=this.playerAlpha}}}function n(){this.font="Helvetica",this.fontWeight="bold",this.fontColor0="purple",this.fontColor1="#FFC619",this.fontColor2="#FFFFFF",this.introFontSize0=Math.round(.09*K.width),this.introFontSize1=Math.round(.07*K.width),this.introFontSize2=Math.round(.06*K.width),this.fontSize0=Math.round(.06*K.width),this.fontSize1=Math.round(.05*K.width),this.fontSize2=Math.round(.04*K.width),this.levelBriefing=["Outside the galaxy","The outer space","AlphaPI 2034"],this.introBackground="intro_bg.jpg",this.gameIntro=function(){K.contextText.clearRect(0,0,K.width,K.height),K.contextText.drawImage(K.images[this.introBackground],0,0,K.width,K.height),C("Space Prawns 2039",1,this.font,this.introFontSize0,this.fontColor0,this.fontWeight),C("We invited, they came...",2,this.font,this.introFontSize1,this.fontColor1,this.fontWeight),K.isMobile?C("Tap screen to start",3,this.font,this.introFontSize2,this.fontColor2,this.fontWeight):C("Press ENTER or LMB to start",3,this.font,this.introFontSize2,this.fontColor2,this.fontWeight)},this.lvlIntro=function(){K.contextText.clearRect(0,0,K.width,K.height),C("Stage "+K.level,1,this.font,this.fontSize0,this.fontColor1,this.fontWeight),C(this.levelBriefing[K.level-1],2,this.font,this.fontSize1,this.fontColor1,this.fontWeight),K.isMobile?C("Tap screen to continue",3,this.font,this.fontSize2,this.fontColor2,this.fontWeight):C("Press ENTER or LMB to continue",3,this.font,this.fontSize2,this.fontColor2,this.fontWeight)},this.lvlComplete=function(){K.contextText.clearRect(0,0,K.width,K.height),C("Stage Complete!",1,this.font,this.fontSize0,this.fontColor1,this.fontWeight),C(K.score+" enemy ships destroyed",2,this.font,this.fontSize1,this.fontColor1,this.fontWeight),K.isMobile?C("Tap screen to continue",3,this.font,this.fontSize2,this.fontColor2,this.fontWeight):C("Press ENTER or LMB to continue",3,this.font,this.fontSize2,this.fontColor2,this.fontWeight)},this.gameOver=function(){K.contextText.clearRect(0,0,K.width,K.height),C("Game Over",1,this.font,this.fontSize0,this.fontColor1,this.fontWeight),C(K.score+" enemy ships destroyed",2,this.font,this.fontSize1,this.fontColor1,this.fontWeight),K.isMobile?C("Tap screen to restart",3,this.font,this.fontSize2,this.fontColor2,this.fontWeight):C("Press ENTER or LMB to restart",3,this.font,this.fontSize2,this.fontColor2,this.fontWeight)}}function o(){this.keyframe0=!0,this.keyframe1=!1,this.keyframe2=!1,this.lvlIntro=function(){gameText.lvlIntro(),this.keyframe0?(gameLights.fadeIn("text"),(!K.textFaded||K.keys[13]||V)&&(V=0,K.keys[13]=!1,K.textFaded||(this.keyframe0=!1,this.keyframe1=!0),gameLights.on("text"))):this.keyframe1?(K.keys[13]||V)&&(V=0,K.keys[13]=!1,this.keyframe1=!1,this.keyframe2=!0):this.keyframe2&&(gameLights.fadeOut("text"),(K.textFaded||K.keys[13]||V)&&(V=0,K.keys[13]=!1,K.textFaded&&(this.keyframe2=!1,this.keyframe0=!0,K.contextText.clearRect(0,0,K.width,K.height),A(),K.lvlIntro=!1,K.lvlStart=!0),gameLights.off("text")))},this.lvlStart=function(){gameLights.fadeIn("all"),K.faded||(gameUI.updateAll(),K.lvlStart=!1)},this.lvlComplete=function(){gameText.lvlComplete(),this.keyframe0?(K.keys[13]||V)&&(V=0,K.keys[13]=!1,this.keyframe0=!1,this.keyframe1=!0):this.keyframe1&&(gameLights.fadeOut("all"),(K.faded||K.keys[13]||V)&&(V=0,K.keys[13]=!1,K.faded&&(K.lvlIntro=!0,this.keyframe0=!0,this.keyframe1=!1,K.levelComplete=!1,K.level++),gameLights.off("all")))},this.gameOver=function(){gameText.gameOver(),this.keyframe0?(K.keys[13]||V)&&(V=0,K.keys[13]=!1,this.keyframe0=!1,this.keyframe1=!0):this.keyframe1&&(gameLights.fadeOut("all"),(K.faded||K.keys[13]||V)&&(V=0,K.keys[13]=0,K.faded&&(this.keyframe0=!0,this.keyframe1=!1,K.start=!0,gameLights.on("text"),gameText.gameIntro(),K.gameOver=!1,K.paused=!0),gameLights.off("all")))},this.load=function(){K.lvlIntro?gameTransition.lvlIntro():K.lvlStart?gameTransition.lvlStart():K.levelComplete?gameTransition.lvlComplete():K.gameOver&&gameTransition.gameOver()},this.reset=function(){this.keyframe0=!0,this.keyframe1=!1,this.keyframe2=!1}}function p(){if(!K.keys[13]&&!V||!K.start||K.gameOver||K.gameWon||(A(),V=0,K.keys[13]=!1,K.music&&K.tracks.length<1&&(K.tracks.push(K.soundTracks["tune1.mp3"]),K.tracks[0].play(),K.tracks[0].loop=!0),gameLights.off("all"),K.start=!1,K.paused=!1,gameUI.updateAll()),K.keys[27]&&(V=0,K.keys[27]=!1,playerShip.hull=0,playerShip.lives=0,K.gameOver=!0),K.keys[119]&&(K.sound=K.sound?!1:!0,gameUI.updateSound(),K.keys[119]=!1),K.keys[120])if(K.music=K.music?!1:!0,gameUI.updateSound(),K.keys[120]=!1,K.tracks.length>0){for(var a in K.tracks)K.tracks[a].pause();
K.tracks=[]}else if(K.tracks.length<1){K.tracks.push(K.soundTracks["tune1.mp3"]);for(var b in K.tracks)K.tracks[b].play(),K.tracks[b].loop=!0}!K.keys[80]||K.gameWon||K.gameOver||(K.paused=K.paused?!1:!0,K.keys[80]=!1),(K.keys[27]||(K.keys[13]||V)&&K.paused&&!K.start&&K.gameOver&&!K.gameWon||(K.keys[13]||V)&&K.paused&&!K.start&&K.level>=7)&&((K.lives<1||K.level>=7)&&(K.level=X_Level,K.score=0,playerShip.lives=X_Lives),A())}function q(){if(z(),dtTimer<=30){var a=(new Date).getTime(),b=a-timeThen;dtArray.push(b),timeThen=a,dtTimer++}if(30==dtTimer){for(var c=0,e=0;e<dtArray.length-2;e++)c+=dtArray[e+2];dt=Math.round(c/dtArray.length)/1e3}if(K.timer++,K.seconds=K.timer/60||0,playerShip.load(),gameBackground.load(),1==K.level?r():2==K.level?r():3==K.level&&lvl3(),K.bossDead&&K.levelUpTimer<=100&&(K.levelUpTimer++,100==K.levelUpTimer&&(K.levelComplete=!0,V=0)),gameTransition.load(),K.playerBullets.length>=1){for(var f in K.playerBullets)K.playerBullets[f].dead||(K.playerBullets[f].update(),K.playerBullets[f].draw());for(var g in K.playerBullets)(K.playerBullets[g].dead||K.playerBullets[g].x>K.width+K.playerBullets[g].size||K.playerBullets[g].x<0-K.playerBullets[g].size||K.playerBullets[g].y>K.height+K.playerBullets[g].size||K.playerBullets[g].y<-30)&&K.playerBullets.splice(g,1)}if(K.enemies.length>0){for(var h in K.enemies)K.enemies[h].update(),K.enemies[h].draw();if(K.playerBullets.length>=1)for(var i in K.enemies)for(var j in K.playerBullets)B(K.enemies[i],K.playerBullets[j])&&!K.enemies[i].dead&&(K.enemies[i].hit=!0,K.enemies[i].hull-=K.playerBullets[j].power,K.enemies[i].hull>0&&K.explosions.push(new d(K.enemies[i].x+.5*K.enemies[i].size,K.enemies[i].y+.5*K.enemies[i].size,0,1,.25*K.enemies[i].size)),K.playerBullets[j].dead=!0);for(var l in K.enemies)!B(K.enemies[l],playerShip)||K.enemies[l].dead||playerShip.imune||K.gameOver||(playerShip.hull-=K.enemies[l].hull,gameUI.updateEnergy(),playerShip.hit=!0,K.enemies[l].hit=!0,K.enemies[l].hull-=playerShip.hull);for(var m in K.enemies)(K.enemies[m].dead||K.enemies[m].y>K.height+K.enemies[m].size||K.enemies[m].x<.3*-K.width||K.enemies[m].x>1.3*K.width)&&(K.enemies[m].dead&&(lootchance=Math.random(),lootchance<.3&&K.loot.push(new k(K.enemies[m].x,K.enemies[m].y))),K.enemies.splice(m,1))}if(K.waves.length>0)for(var n in K.waves)K.waves[n].update(),K.waves[n].over&&K.waves.splice(n,1);if(K.loot.length>=1){for(var o in K.loot)K.loot[o].update(),K.loot[o].draw();for(var p in K.loot)(K.loot[p].dead||K.loot[p].x>K.width+K.loot[p].size||K.loot[p].x<0-K.loot[p].size||K.loot[p].y>K.height+K.loot[p].size||K.loot[p].y<-30)&&K.loot.splice(p,1)}if(K.enemyBullets.length>=1){for(var q in K.enemyBullets)K.enemyBullets[q].update(),K.enemyBullets[q].draw();for(var s in K.enemyBullets)!B(K.enemyBullets[s],playerShip)||playerShip.imune||K.gameOver||(playerShip.hull-=K.enemyBullets[s].power,gameUI.updateEnergy(),playerShip.hit=!0,K.enemyBullets[s].dead=!0);for(var t in K.enemyBullets)(K.enemyBullets[t].dead||K.enemyBullets[t].x>K.width+K.enemyBullets[t].size||K.enemyBullets[t].x<0-K.enemyBullets[t].size||K.enemyBullets[t].y>K.height+K.enemyBullets[t].size||K.enemyBullets[t].y<-30)&&K.enemyBullets.splice(t,1)}if(K.explosions.length>0){for(var u in K.explosions)K.explosions[u].update(),K.explosions[u].draw();for(var v in K.explosions)K.explosions[v].sprite.currentFrame>=K.explosions[v].sprite.endFrame&&K.explosions.splice(v,1)}if(K.sounds.length>0)for(var w in K.sounds)K.sounds[w].cloneNode(!0).play(),K.sounds[w].addEventListener("ended",K.sounds.splice(w,1))}function r(){1==K.seconds&&K.waves.push(new R("left",.3*K.width,"sectoid.png","pawn",1,300,1,0)),1==K.seconds&&K.waves.push(new R("right",.3*K.width,"sectoid.png","pawn",1,250,1,0)),3==K.seconds&&K.waves.push(new R("left",.5*K.height,"sectoid.png","pawn",1,250,1,0)),3==K.seconds&&K.waves.push(new R("right",.5*K.height,"sectoid.png","pawn",1,300,1,0)),5==K.seconds&&K.enemies.push(new g(.7*K.width,.1*-K.height,80,Math.PI/2,10,"miniboss","floater.png",2)),7==K.seconds&&K.enemies.push(new g(.3*K.width,.1*-K.height,155,Math.PI/2,10,"base","alienbase1.png",1)),8==K.seconds&&K.waves.push(new R("left",.3*K.height,"sectoid.png","pawn",4,250,1,2)),9==K.seconds&&K.waves.push(new R("right",.2*K.height,"sectoid.png","pawn",3,300,1,2)),10==K.seconds&&K.waves.push(new R("top",.5*K.width,"sectoid.png","pawn",6,300,1,2)),11==K.seconds&&K.waves.push(new R("top",.7*K.width,"sectoid.png","pawn",4,300,1,2)),12==K.seconds&&K.waves.push(new R("left",.2*K.height,"sectoid.png","pawn",3,300,1,2)),13==K.seconds&&K.enemies.push(new g(.3*K.width,.1*-K.height,155,Math.PI/2,10,"base","alienbase2.png",1)),K.seconds>13&&K.tracks.length<2&&K.enemies.length>0&&!K.bossDead&&K.music&&(K.tracks.push(K.soundTracks["tune2.mp3"]),K.tracks[1].play(),K.tracks[1].loop=!0),15==K.seconds&&K.waves.push(new R("top",.2*K.width,"sectoid.png","pawn",2,300,1,2)),16==K.seconds&&K.waves.push(new R("top",.4*K.width,"sectoid.png","pawn",3,300,1,2)),17==K.seconds&&K.waves.push(new R("top",.6*K.width,"sectoid.png","pawn",4,300,1,2)),18==K.seconds&&K.waves.push(new R("top",.8*K.width,"sectoid.png","pawn",5,300,1,2)),22==K.seconds&&K.waves.push(new R("top",.3*K.width,"sectoid.png","pawn",4,300,1,2)),25==K.seconds&&K.waves.push(new R("left",.4*K.width,"sectoid.png","pawn",4,300,1,2)),27==K.seconds&&K.waves.push(new R("right",.3*K.width,"sectoid.png","pawn",4,300,1,2)),30==K.seconds&&K.waves.push(new R("top",.3*K.width,"sectoid.png","pawn",4,300,1,2)),33==K.seconds&&K.waves.push(new R("top",.6*K.width,"sectoid.png","pawn",4,300,1,2)),35==K.seconds&&K.waves.push(new R("right",.2*K.width,"sectoid.png","pawn",4,300,1,2)),37==K.seconds&&K.enemies.push(new g(.2*K.width,.1*-K.height,80,Math.PI/2,10,"miniboss","floater.png",2)),38==K.seconds&&K.enemies.push(new g(.4*K.width,.1*-K.height,80,Math.PI/2,10,"miniboss","floater.png",2)),39==K.seconds&&K.enemies.push(new g(.6*K.width,.1*-K.height,80,Math.PI/2,10,"miniboss","floater.png",2)),40==K.seconds&&K.enemies.push(new g(.8*K.width,.1*-K.height,80,Math.PI/2,10,"miniboss","floater.png",2)),41==K.seconds&&K.enemies.push(new g(.5*K.width,.1*-K.height,80,Math.PI/2,10,"miniboss","floater.png",2)),42==K.seconds&&K.enemies.push(new g(.2*K.width,.1*-K.height,80,Math.PI/2,10,"miniboss","floater.png",2)),43==K.seconds&&K.enemies.push(new g(.4*K.width,.1*-K.height,80,Math.PI/2,10,"miniboss","floater.png",2)),44==K.seconds&&K.enemies.push(new g(.6*K.width,.1*-K.height,80,Math.PI/2,10,"miniboss","floater.png",2)),45==K.seconds&&K.enemies.push(new g(.8*K.width,.1*-K.height,80,Math.PI/2,10,"miniboss","floater.png",2)),K.seconds>50&&0===K.enemies.length&&!K.bossDead&&(K.music&&(K.tracks.push(K.soundTracks["boss.mp3"]),K.tracks[2].play()),K.enemies.push(new h(.3*K.width,.1*-K.height,150,Math.PI/2,100,"sectoidBoss.png"))),K.seconds>55&&0===K.enemies.length&&K.bossDead&&3==K.tracks.length&&(K.tracks[0].pause(),K.tracks[1].pause(),K.tracks[2].pause(),K.tracks=[],K.music&&0===K.tracks.length&&K.tracks.push(K.soundTracks["victory.mp3"]),K.tracks[0].play())}function s(){S=document.getElementById("textCanvas"),S.addEventListener("mousedown",v,!1),S.addEventListener("mouseup",t,!1),S.addEventListener("mousemove",x,!1),S.addEventListener("touchstart",w,!1),S.addEventListener("touchend",u,!1),S.addEventListener("touchcancel",u,!1),S.addEventListener("touchleave",u,!1),S.addEventListener("touchmove",y,!1)}function t(a){a.preventDefault(),V=0}function u(a){a.preventDefault(),V=0}function v(a){a.preventDefault(),V=1,W=a.pageX-S.offsetLeft,X=a.pageY-S.offsetTop}function w(a){a.preventDefault(),V=1;var b=a.targetTouches[0];W=b.pageX-b.target.offsetLeft,X=b.pageY-b.target.offsetTop}function x(a){a.preventDefault(),T=a.pageX-S.offsetLeft,U=a.pageY-S.offsetTop}function y(a){a.preventDefault();var b=a.targetTouches[0];T=b.pageX-S.offsetLeft,U=b.pageY-S.offsetTop}function z(){K.contextBackground.clearRect(0,0,K.width,K.height),K.contextPlayer.clearRect(0,0,K.width,K.height),K.contextEnemies.clearRect(0,0,K.width,K.height)}function A(){gameLights.off("all"),gameTransition.reset(),V=0,K.gameOver=!1,K.gameWon=!1,K.level=K.lvlIntro?K.level:1,K.bossDead=!1,K.levelComplete=!1,K.lvlStart=!1,K.lvlIntro=!0,K.levelUpTimer=0,z(),playerShip.reset(),gameUI.updateAll(),K.background=[],K.enemies=[],K.waves=[],K.enemyBullets=[],K.loot=[],K.delayTimer=0,K.timer=0,K.sounds=[];for(var a in K.tracks)K.tracks[a].pause();K.tracks=[],K.music&&(K.tracks.push(K.soundTracks["tune1.mp3"]),K.tracks[0].play(),K.tracks[0].loop=!0),K.paused=!1}function B(a,b){return!(a.x>b.x+b.size||a.x+a.size<b.x||a.y>b.y+b.size||a.y+a.size<b.y)}function C(a,b,c,d,e,f){var g=a,h=g.length,i=Math.round(h*(d/2)),j=Math.round(.1*K.height),k=Math.round(.5*(K.width-i)),l=Math.round(K.height/3.5+j*b);K.contextText.font=f+" "+d+"px "+c,K.contextText.fillStyle=e,K.contextText.fillText(g,k,l)}function D(){requestAnimFrame(D),p(),K.paused||q()}function E(a){K.requiredImages=a.length;for(var b in a){var c=new Image;c.src=a[b];var d=c.src.split("/").pop();K.images[d]=c,K.images[d].onload=function(){K.doneImages++},1>b&&(K.contextText.font="bold "+.06*K.width+"px "+K.font,K.contextText.fillStyle="white",K.contextText.fillText("Loading Images...",.22*K.width,.47*K.height)),console.log("reqImages: "+K.requiredImages)}}function F(a){K.requiredSfx=a.length;for(var b in a){var c=new Audio;c.src=a[b];var d=c.src.split("/").pop();K.sfx[d]=c,K.sfx[d].oncanplaythrough=function(){K.doneSfx++},1>b&&(K.contextText.font="bold "+.06*K.width+"px "+K.font,K.contextText.fillStyle="white",K.contextText.fillText("Loading Sfx...",.23*K.width,.47*K.height)),console.log("reqSfx: "+K.requiredSfx)}}function G(a){K.requiredSoundTracks=a.length;for(var b in a){var c=new Audio;c.src=a[b];var d=c.src.split("/").pop();console.log(d),K.soundTracks[d]=c,K.soundTracks[d].oncanplaythrough=function(){K.doneSoundTracks++},1>b&&(K.contextText.font="bold "+.06*K.width+"px "+K.font,K.contextText.fillStyle="white",K.contextText.fillText("Loading Sound Tracks...",.15*K.width,.47*K.height)),console.log("requiredSoundTracks: "+K.requiredSoundTracks)}}function H(){K.doneImages>=K.requiredImages?(K.contextText.clearRect(0,0,K.width,K.height),F(["_sounds/_sfx/laser.mp3","_sounds/_sfx/hit.mp3","_sounds/_sfx/loot_powerUp.mp3","_sounds/_sfx/explosion.mp3","_sounds/_sfx/blast.mp3"]),I()):(K.contextText.fillText("|",.15*K.width+(K.doneImages+1),.55*K.height),console.log("doneImages: "+K.doneImages),setTimeout(function(){H()},1))}function I(){K.doneSfx>=K.requiredSfx?(K.contextText.clearRect(0,0,K.width,K.height),G(["_sounds/_soundTracks/_lvl1/tune1.mp3","_sounds/_soundTracks/_lvl1/tune2.mp3","_sounds/_soundTracks/_lvl1/victory.mp3","_sounds/_soundTracks/_lvl1/boss.mp3"]),J()):(K.contextText.fillText("|",.2*K.width+(K.doneSfx+1),.55*K.height),console.log("doneSfx: "+K.doneSfx),setTimeout(function(){I()},1))}function J(){K.doneSoundTracks>=K.requiredSoundTracks?(gameText.gameIntro(),D(),document.getElementById("textCanvas").style.cursor="corsair"):(K.contextText.fillText("|",.2*K.width+(K.doneSoundTracks+1),.55*K.height),console.log("doneSoundTracks: "+K.doneSoundTracks),setTimeout(function(){J()},1))}document.getElementById("textCanvas").style.cursor="wait",$.ajax({type:"GET",url:"game.xml",contentType:"text/xml",dataType:"text",async:!1,success:function(a){$(a).find("data").each(function(){X_Sound=parseInt($(this).find("sound").text()),X_Music=parseInt($(this).find("music").text()),X_Level=parseInt($(this).find("level").text()),X_Lives=parseInt($(this).find("player-lives").text()),X_PlayerSpeed=parseInt($(this).find("player-speed").text()),X_EnemySpeed=parseInt($(this).find("enemy-speed").text()),X_GunSpeed=parseInt($(this).find("reload-time").text()),X_EnGunSpeed=parseInt($(this).find("enreload-time").text()),X_BulletSpeed=parseInt($(this).find("bullet-speed").text()),X_EnBulletSpeed=parseInt($(this).find("enbullet-speed").text()),X_Title=$(this).find("title").text(),X_Subtitle=$(this).find("subtitle").text(),X_dt_Start=$(this).find("dt-start").text(),X_mb_Start=$(this).find("mb-start").text()})},error:function(){alert("The XML File could not be processed correctly.")}});var K={};K.isMobile=/iPhone|iPod|iPad|Android|BlackBerry/.test(navigator.userAgent),K.stars=[],K.faded=!0,K.backgroundFaded=!0,K.enemiesFaded=!0,K.playerFaded=!0,K.textFaded=!0,K.background=[],K.score=0,K.levelScore=0,K.level=X_Level,K.bossDead=!1,K.levelComplete=!1,K.levelUpTimer=0,K.lives=X_Lives,K.keys=[],K.playerBullets=[],K.enemyBullets=[],K.enemies=[],K.waves=[],K.loot=[],K.explosions=[],dt=0,dtTimer=0,dtArray=[],timeThen=(new Date).getTime(),K.start=!0,K.lvlIntro=!0,K.lvlStart=!1,K.paused=!0,K.escaped=!1,K.gameWon=!1,K.gameOver=!1,K.delayTimer=0,K.timer=0,K.sound=X_Sound,K.music=X_Music,K.sfx=[],K.doneSfx=0,K.requiredSfx=0,K.soundTracks=[],K.doneSoundTracks=0,K.requiredSoundTracks=0,K.sounds=[],K.tracks=[],K.images=[],K.doneImages=0,K.requiredImages=0,K.font=K.isMobile?"Helvetica":"Monaco",K.contextBackground=document.getElementById("backgroundCanvas").getContext("2d"),K.contextEnemies=document.getElementById("enemiesCanvas").getContext("2d"),K.contextPlayer=document.getElementById("playerCanvas").getContext("2d"),K.contextText=document.getElementById("textCanvas").getContext("2d");var L=$("#backgroundCanvas"),M=$("#enemiesCanvas"),N=$("#playerCanvas"),O=$("#textCanvas"),P=$(L).parent();$(window).resize(a),a();var Q=.001*K.height;gameBackground=new c,d.prototype=Object.create(particle.prototype),d.prototype.constructor=d,playerShip=new e(10,15),f.prototype=Object.create(particle.prototype),f.prototype.constructor=f,g.prototype=Object.create(particle.prototype),g.prototype.constructor=g,h.prototype=Object.create(particle.prototype),h.prototype.constructor=h,j.prototype=Object.create(particle.prototype),j.prototype.constructor=j,k.prototype=Object.create(particle.prototype),k.prototype.constructor=k;var R=function(a,b,c,d,e,f,h,i){switch(this.side=a,this.spawnedShips=0,this.race=c,this.type=d,this.fleetSize=e,this.speed=f,this.hull=h,this.fireRate=i||0,this.spawnTimer=1,this.spawnDivision=Math.round(1500*dt),this.side){case"top":this.x=b,this.y=-Math.round(.1*K.height),this.direction=Math.PI/2;break;case"left":this.x=-Math.round(.2*K.width),this.y=b,this.direction=0;break;case"right":this.x=Math.round(1.2*K.width),this.y=b,this.direction=Math.PI}this.over=!1,this.update=function(){this.spawnTimer++,this.spawnedShips<=this.fleetSize&&this.spawnTimer%this.spawnDivision==1&&(this.spawnTimer=1,K.enemies.push(new g(this.x,this.y,this.speed,this.direction,this.hull,this.type,this.race,this.fireRate,!0)),this.spawnedShips++),this.spawnedShips==this.fleetSize&&(this.over=!0)}};gameUI=new l,gameLights=new m,gameText=new n,gameTransition=new o,$(document).keydown(function(a){K.keys[a.keyCode?a.keyCode:a.which]=!0}),$(document).keyup(function(a){delete K.keys[a.keyCode?a.keyCode:a.which]});var S,T=playerShip.x,U=playerShip.y,V=0,W=0,X=0;E(["_img/_dist/background/intro_bg.jpg","_img/_dist/background/level1.jpg","_img/_dist/ui/energybar.png","_img/_dist/ui/energypoint.png","_img/_dist/fighter/fighter.png","_img/_dist/fighter/fighter_right1.png","_img/_dist/fighter/fighter_right2.png","_img/_dist/fighter/fighter_right3.png","_img/_dist/fighter/fighter_right4.png","_img/_dist/fighter/fighter_right5.png","_img/_dist/fighter/fighter_left1.png","_img/_dist/fighter/fighter_left2.png","_img/_dist/fighter/fighter_left3.png","_img/_dist/fighter/fighter_left4.png","_img/_dist/fighter/fighter_left5.png","_img/_dist/enemies/sectoid.png","_img/_dist/enemies/_miniboss/floater.png","_img/_dist/enemies/_alienbase/alienbase1.png","_img/_dist/enemies/_alienbase/alienbase2.png","_img/_dist/enemies/_bigboss/sectoidBoss.png","_img/_dist/laser.png","_img/_dist/missile.png","_img/_dist/explosion.png"]),window.addEventListener("load",function Y(){window.removeEventListener("load",Y,!1),window.applicationCache.addEventListener("updateready",function(){window.applicationCache.status==window.applicationCache.UPDATEREADY&&confirm("A new version of InVaDeRs is available. Load it?")&&window.location.reload()},!1),s()},!1),H()})}(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();